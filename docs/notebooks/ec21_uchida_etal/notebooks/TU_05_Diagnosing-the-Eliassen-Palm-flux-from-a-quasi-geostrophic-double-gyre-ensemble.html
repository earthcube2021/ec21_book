
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Diagnosing the Eliassen-Palm flux from a quasi-geostrophic double gyre ensemble &#8212; EarthCube 2021 Call for Notebooks</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="EZ-FeatureTrack" href="../../ec21_zheng_etal/README.html" />
    <link rel="prev" title="Automated Machine Learning for Earth Science via AutoGluon" href="../../ec21_shi_etal/Xingjian_Shi_01_Automated_Machine_Learning_for_Earth_Science_via_AutoGluon.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
      <img src="../../../_static/logo.webp" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">EarthCube 2021 Call for Notebooks</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../docs/about.html">
   Call for Notebooks
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../index.html">
   2021 Notebooks
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../ec21_anil_etal/README.html">
     ec21_binder_anil
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../ec21_anil_etal/SA_01_Argo_Data_Exploration.html">
       Interactive Jupyter notebook for hydrographic ocean data exploration, retrieval and visualization via the Argovis API
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../ec21_balwada_etal/README.html">
     ec2021_balwada_etal
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../ec21_balwada_etal/DB_01_Glider_Viz_Panel.html">
       Glider Viz Panel
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../ec21_beckley_etal/README.html">
     Programmatic Access to OpenTopography’s Cloud Optimized Geotiff (COG) Global Datasets
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../ec21_beckley_etal/OT_01_BulkAccessCOGs.html">
       Programmatic Access to OpenTopography’s Cloud Optimized GeoTIFF (COG) Global Datasets
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../ec21_bourgault_etal/README.html">
     xclim : Software ecosystem for climate services
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../ec21_bourgault_etal/PB_02_xclim_Software_ecosystem_for_climate_services.html">
       xclim: Software ecosystem for climate services
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ec21_cherian_etal/DC_01_cf-xarray.html">
     cf-xarray: Scale your analysis across datasets with less data wrangling and more metadata handling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ec21_cych_etal/BC_01%20Bias%20Corrected%20Estimation%20of%20Paleointensity.html">
     BC_01 Bias Corrected Estimation of Paleointensity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ec21_dye_etal/README.html">
     Toward autonomous detection of anomalous GNSS data via applied unsupervised artificial intelligence
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../ec21_garzon_etal/README.html">
     Exploring Research Data Repositories with geoextent.
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../ec21_garzon_etal/showcase/SG_01_Exploring_Research_Data_Repositories_with_geoextent.html">
       Exploring Research Data Repositories with geoextent
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../ec21_gray_etal/README.html">
     Leveraging satellite data and pangeo to investigate the role of Gulf Stream frontal dynamics in ocean productivity
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../ec21_gray_etal/PG_01_gulf_stream_dynamics_role_in_productivity.html">
       Leveraging satellite data and pangeo to investigate the role of Gulf Stream frontal dynamics in ocean productivity
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../ec21_hu_etal/README.html">
     Machine Learning Guided Weather Analogs
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../ec21_hu_etal/WH_01_Spatio-Temporal_Deep_Analogs_2021.html">
       WH_01_Spatio-Temporal_Deep_Analogs_2021
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../ec21_lopez_etal/README.html">
     ITS_LIVE Explorer
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../ec21_lopez_etal/notebooks/itslive-notebook-rendered.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../ec21_lopez_etal/notebooks/itslive-notebook.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../ec21_lopez_etal/notebooks/LL_01_ITS_LIVE_global_glacier_velocity_exploration_and_analysis.html">
       <strong>
        ITS_LIVE
       </strong>
       Global Glacier Velocity Exploration and Analysis
       <a class="anchor" id="chapter_1">
       </a>
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../ec21_martin_etal/README.html">
     Frequency-domain analysis of large datasets
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../ec21_martin_etal/PM_01_Frequency-Domain_Analysis_of_Large_Datasets.html">
       Frequency-Domain Analysis of Large Datasets
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../ec21_maussion_etal/README.html">
     OGGM-edu EarthCube notebook
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
    <label for="toctree-checkbox-11">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../ec21_maussion_etal/FM_01_OGGM-Edu_learn_and_teach_about_glaciers.html">
       OGGM-Edu - Jupyter notebooks to learn and teach about glaciers
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../ec21_potnis_etal/README.html">
     JP_01_Real_Time_Alignment_and_Distribution_of_Weather_Radar_Data_with_Rain_Gauge_Data_for_Deep_Learn
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../ec21_potnis_etal/JP_01_Real_Time_Alignment_and_Distribution_of_Weather_Radar_Data_with_Rain_Gauge_Data_for_Deep_Learning_using_CHORDS.html">
       Real Time Alignment and Distribution of Weather Radar Data with Rain Gauge Data for Deep Learning using CHORDS
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ec21_seijo_etal/README.html">
     click Binder badge to launch notebook on Binder (no need to install environment):
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../ec21_shi_etal/README.html">
     EC2021: Automated Machine Learning for Earth Science via AutoGluon
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
    <label for="toctree-checkbox-13">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../ec21_shi_etal/Xingjian_Shi_01_Automated_Machine_Learning_for_Earth_Science_via_AutoGluon.html">
       Automated Machine Learning for Earth Science via AutoGluon
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Diagnosing the Eliassen-Palm flux from a quasi-geostrophic double gyre ensemble
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../ec21_zheng_etal/README.html">
     EZ-FeatureTrack
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
    <label for="toctree-checkbox-14">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../ec21_zheng_etal/notebooks/WZ_01_mapping_ice_flow_velocity.html">
       Mapping ice flow velocity using an easy and interactive feature tracking workflow
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/notebooks/ec21_uchida_etal/notebooks/TU_05_Diagnosing-the-Eliassen-Palm-flux-from-a-quasi-geostrophic-double-gyre-ensemble.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/earthcube2021/ec21_book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/earthcube2021/ec21_book/issues/new?title=Issue%20on%20page%20%2Fnotebooks/ec21_uchida_etal/notebooks/TU_05_Diagnosing-the-Eliassen-Palm-flux-from-a-quasi-geostrophic-double-gyre-ensemble.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/earthcube2021/ec21_book/master?urlpath=lab/tree/book/notebooks/ec21_uchida_etal/notebooks/TU_05_Diagnosing-the-Eliassen-Palm-flux-from-a-quasi-geostrophic-double-gyre-ensemble.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/earthcube2021/ec21_book/blob/master/book/notebooks/ec21_uchida_etal/notebooks/TU_05_Diagnosing-the-Eliassen-Palm-flux-from-a-quasi-geostrophic-double-gyre-ensemble.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Diagnosing the Eliassen-Palm flux from a quasi-geostrophic double gyre ensemble
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#author-s">
     Author(s)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#purpose">
     Purpose
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#technical-contributions">
     Technical contributions
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#methodology">
     Methodology
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#results">
     Results
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#theory">
       Theory
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#diagnostics-from-qg-ensemble">
       Diagnostics from QG ensemble
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#funding">
     Funding
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#keywords">
     Keywords
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#work-in-progress-improvements">
     Work In Progress - improvements
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#acknowledgements">
     Acknowledgements
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#library-import">
     Library import
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#parameter-definitions">
   Parameter definitions
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-import">
   Data import
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-a-xgcm-grid-object">
     Define a
     <code class="docutils literal notranslate">
      <span class="pre">
       xgcm.grid
      </span>
     </code>
     object
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-processing-and-analysis">
   Data processing and analysis
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-the-mean-and-eddy-stream-function-overline-psi-psi">
     Define the mean and eddy stream function (
     <span class="math notranslate nohighlight">
      \(\overline{\psi}, \psi'\)
     </span>
     ).
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-a-function-to-pad-the-stream-function-to-satisfy-the-lateral-no-flux-boundary-condition-viz-psi-0-at-the-boundaries">
     Define a function to pad the stream function to satisfy the lateral no-flux boundary condition (viz.
     <span class="math notranslate nohighlight">
      \(\psi=0\)
     </span>
     at the boundaries).
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compute-the-horizontal-velocities-and-buoyancy-at-the-interfaces">
     Compute the horizontal velocities and buoyancy at the interfaces
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compute-each-term-appearing-in-the-e-p-flux-tensor">
     Compute each term appearing in the E-P flux tensor
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compute-the-eliassen-palm-flux-in-the-formalism-of-2">
     Compute the Eliassen-Palm flux in the formalism of (2)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compute-the-eliassen-palm-flux-in-the-formalism-of-7">
     Compute the Eliassen-Palm flux in the formalism of (7)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compute-the-e-p-flux-divergence-based-on-the-formalism-of-2">
     Compute the E-P flux divergence based on the formalism of (2)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compute-the-e-p-flux-divergence-based-on-the-formalism-of-7">
     Compute the E-P flux divergence based on the formalism of (7)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#examine-that-the-two-formalisms-converge">
     Examine that the two formalisms converge
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="diagnosing-the-eliassen-palm-flux-from-a-quasi-geostrophic-double-gyre-ensemble">
<h1>Diagnosing the Eliassen-Palm flux from a quasi-geostrophic double gyre ensemble<a class="headerlink" href="#diagnosing-the-eliassen-palm-flux-from-a-quasi-geostrophic-double-gyre-ensemble" title="Permalink to this headline">¶</a></h1>
<div class="section" id="author-s">
<h2>Author(s)<a class="headerlink" href="#author-s" title="Permalink to this headline">¶</a></h2>
<p>List authors, their current affiliations,  up-to-date contact information, and ORCID if available. Add as many author lines as you need.</p>
<ul class="simple">
<li><p>Author1 = {“name”: “Takaya Uchida”, “affiliation”: “Institut des Geosciences de l’Environnement, Centre National de la Recherche Scientifique”, “email”: “<a class="reference external" href="mailto:takaya&#46;uchida&#37;&#52;&#48;univ-grenoble-alpes&#46;fr">takaya<span>&#46;</span>uchida<span>&#64;</span>univ-grenoble-alpes<span>&#46;</span>fr</a>”, “orcid”: “0000-0002-8654-6009”};</p></li>
<li><p>Author2 = {“name”: “Bruno Deremble”, “affiliation”: “Institut des Geosciences de l’Environnement, Centre National de la Recherche Scientifique”, “email”: “<a class="reference external" href="mailto:bruno&#46;deremble&#37;&#52;&#48;univ-grenoble-alpes&#46;fr">bruno<span>&#46;</span>deremble<span>&#64;</span>univ-grenoble-alpes<span>&#46;</span>fr</a>”, “orcid”: “0000-0002-5875-5014”};</p></li>
<li><p>Author3 = {“name”: “William K. Dewar”, “affiliation”: “Institut des Geosciences de l’Environnement, Centre National de la Recherche Scientifique; Department of Earth, Ocean and Atmospheric Science, Florida State University”, “email”: “<a class="reference external" href="mailto:wdewar&#37;&#52;&#48;fsu&#46;edu">wdewar<span>&#64;</span>fsu<span>&#46;</span>edu</a>”, “orcid”: “0000-0002-5803-5535”};</p></li>
<li><p>Author4 = {“name”: “Thierry Penduff”, “affiliation”: “Institut des Geosciences de l’Environnement, Centre National de la Recherche Scientifique”, “email”: “<a class="reference external" href="mailto:thierry&#46;penduff&#37;&#52;&#48;univ-grenoble-alpes&#46;fr">thierry<span>&#46;</span>penduff<span>&#64;</span>univ-grenoble-alpes<span>&#46;</span>fr</a>”, “orcid”: “0000-0002-0407-8564”}.</p></li>
</ul>
</div>
<div class="section" id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<p>The oceanographic and atmospheric science community has had a long standing interest in the Eliassen-Palm (E-P) flux divergence, which encapsulates the net eddy feedback onto the mean flow. Nevertheless, a comprehensive understanding of it has remained illusive. This has partially been due to the fact that the E-P flux divergence and not the flux itself appears in the momentum equations. In other words, a rotational (non-divergent) factor allows for the multiple expressions of the E-P flux. Here, we provide a brief overview on how each expression is related to one another within the quasi-geostrophic (QG) framework and diagnose them from a 101-member, seasonally-forced, three-layer, QG double-gyre ensemble simulation. In deriving the E-P flux, we define the mean as the ensemble mean and eddies as fluctuations about the ensemble mean. The ensemble dimension: i) allows us to negate the ergodic assumption where one treats a temporal mean equivalent to an ensemble mean, ii) is consistent with the definition of Reynold’s decomposition, and iii) removes the arbitrary temporal and/or spatial scale in defining the mean.</p>
</div>
<div class="section" id="technical-contributions">
<h2>Technical contributions<a class="headerlink" href="#technical-contributions" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>A theoretical overview on how each expression of E-P flux developed by individual authors is related to one another following the work by <a class="reference external" href="https://doi.org/10.1017/jfm.2013.259">Maddison and Marshall (2013)</a> but within the QG framework;</p></li>
<li><p>Example diagnostics of the E-P flux and its divergence in each expression.</p></li>
</ul>
</div>
<div class="section" id="methodology">
<h2>Methodology<a class="headerlink" href="#methodology" title="Permalink to this headline">¶</a></h2>
<p>We solve prognostically for the non-dimensionalized QG potential vorticity (PV) (<a class="reference external" href="https://doi.org/10.5281/zenodo.4669909">Deremble and Martinez, 2020</a>), based on the Basilisk language (<a class="reference external" href="https://doi.org/10.1016/j.jcp.2015.09.009">Popinet, 2015</a>):</p>
<div class="math notranslate nohighlight">
\[
\frac{D\hat{q}}{D\hat{t}} = \widehat{\mathcal{F}} + \widehat{\mathcal{D}}, 
\]</div>
<p>where <span class="math notranslate nohighlight">\(q = \zeta + \beta y + f_0 (\frac{b}{N^2})_z\)</span> is the QGPV and the <span class="math notranslate nohighlight">\(\beta\)</span>-plane approximation is applied (<span class="math notranslate nohighlight">\(f = f_0 + \beta y\)</span>; <a class="reference external" href="https://books.google.fr/books?hl=fr&amp;lr=&amp;id=BTgoDwAAQBAJ&amp;oi=fnd&amp;pg=PR13&amp;dq=Vallis+atmospheric&amp;ots=wgYr69QZ2o&amp;sig=mRDounQdCScxJ9D1VBg4GRGbLUQ&amp;redir_esc=y#v=onepage&amp;q=Vallis%20atmospheric&amp;f=false">Vallis, 2017</a>). <span class="math notranslate nohighlight">\(\mathcal{F}\)</span> and <span class="math notranslate nohighlight">\(\mathcal{D}\)</span> are the forcing and dissipative terms, and <span class="math notranslate nohighlight">\(\widehat{(\cdot)}\)</span> are non-dimensionalized variables.
The forcing term is the wind stress curl without any buoyancy forcing at the surface, and is kept stationary with the formulation:</p>
<div class="math notranslate nohighlight">
\[
\widehat{\mathcal{F}} = \widehat{\boldsymbol{\nabla}}_\text{h}\times\hat{\boldsymbol{\tau}}(\hat{y}) = -\frac{\hat{f}_0 \hat{\tau}_0}{\hat{H}_1} 
    \sin{\big(\frac{2\pi}{N}\hat{y}\big)} 
    \sin{\big(\frac{\pi}{N} \hat{y}\big)},
\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{\nabla}_\text{h}\)</span> is the horizontal gradient operator, and <span class="math notranslate nohighlight">\(\hat{y}\ (\in [0.5,N-0.5])\)</span> is the non-dimensionalized meridional extent of the domain (Table 1). Only the wind stress curl is prescribed in the model and not the wind stress itself (<span class="math notranslate nohighlight">\(\boldsymbol{\tau}\)</span>) but we denote it for clarity in notation.
The dissipation term is implemented via a biharmonic viscosity:</p>
<div class="math notranslate nohighlight">
\[
\widehat{\mathcal{D}} = -{Re_4}^{-1} \widehat{\boldsymbol{\nabla}}_\text{h}^4\hat{q}.
\]</div>
<p>The background stratification is defined at each layer interface via the Froude number where we enforce the seasonality by varying it in time according to:</p>
<div class="math notranslate nohighlight">
\[
Fr_i = \frac{U}{N_i H^\dagger_i} = Fr^m_i \big[1 + \hat{A}_{Fr_i} \sin{(2\pi \hat{f}_{Fr_i} \hat{t})}\big]^{-1/2},
\]</div>
<p>where <span class="math notranslate nohighlight">\(H^\dagger_i = (H_i + H_{i+1})/2\)</span>, <span class="math notranslate nohighlight">\(N_i\)</span> is the buoyancy frequency, and subscript <span class="math notranslate nohighlight">\(i\)</span> is the layer index (Figure 1). We vary <span class="math notranslate nohighlight">\(Fr_1\)</span> in time but keep <span class="math notranslate nohighlight">\(Fr_2\)</span> stationary (<span class="math notranslate nohighlight">\(\hat{A}_{Fr_2} = 0\)</span>; Table 1). The configuration is similar to <a class="reference external" href="https://doi.org/10.3390/fluids6060206">Uchida et al. (2021)</a>.</p>
<div align="center">
    <img src="../Eta_schematic.png" style="width:400px;">
</div>
<p><strong>Figure 1.</strong> Vertical structure of the three-layer QG model with a rigid lid and flat bottom. The layer interface displacement (<span class="math notranslate nohighlight">\(\eta_i\)</span>) is shown in the thin curvy lines and net layer thickness is <span class="math notranslate nohighlight">\(h_i = H_i + \eta_{i-1} - \eta_i\)</span>. The stream functions (<span class="math notranslate nohighlight">\(\psi_i\)</span>) are defined within each layer.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Notation</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Unit</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><img width=200/></p></td>
<td><p><img width=200/></p></td>
<td><p><img width=200/></p></td>
<td><p><img width=200/></p></td>
</tr>
<tr class="row-odd"><td><p>Number of horizontal grids</p></td>
<td><p><span class="math notranslate nohighlight">\(N\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(256\)</span></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>Number of vertical layers</p></td>
<td><p><span class="math notranslate nohighlight">\(n_l\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(3\)</span></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>Non-dim. horizontal domain size</p></td>
<td><p><span class="math notranslate nohighlight">\(\hat{L}_0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(80\)</span></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>Non-dim. horizontal resolution</p></td>
<td><p><span class="math notranslate nohighlight">\(\delta_\hat{x}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(N^{-1}\hat{L}_0\)</span></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>Background Rossby number</p></td>
<td><p><span class="math notranslate nohighlight">\(Ro^m\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0.025\)</span></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>Non-dim. Coriolis parameter</p></td>
<td><p><span class="math notranslate nohighlight">\(\hat{f}_0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\({Ro^m}^{-1}\)</span></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>Bottom Ekman number</p></td>
<td><p><span class="math notranslate nohighlight">\(Ek^{b}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0.004\)</span></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>Non-dim. surface Ekman pumping</p></td>
<td><p><span class="math notranslate nohighlight">\(\hat{\tau}_0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0.0001\)</span></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>Biharmonic Reynolds number</p></td>
<td><p><span class="math notranslate nohighlight">\(Re_4\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1563\)</span></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>Non-dim. beta</p></td>
<td><p><span class="math notranslate nohighlight">\(\hat{\beta}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0.5\)</span></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>Background Froude number</p></td>
<td><p><span class="math notranslate nohighlight">\(Fr^m_1; Fr^m_2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0.00409959; 0.01319355\)</span></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>Amplitude of <span class="math notranslate nohighlight">\(Fr_i\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\hat{A}_{Fr_1}; \hat{A}_{Fr_2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0.1; 0\)</span></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>Non-dim. frequency of <span class="math notranslate nohighlight">\(Fr_i\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\hat{f}_{Fr_1}; \hat{f}_{Fr_2}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(62.2^{-1}; 62.2^{-1}\)</span></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>Non-dim. layer thickness</p></td>
<td><p><span class="math notranslate nohighlight">\(\widehat{H}_1; \widehat{H}_2; \widehat{H}_3\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0.06; 0.14; 0.8\)</span></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>Non-dim. buoyancy frequency</p></td>
<td><p><span class="math notranslate nohighlight">\(\widehat{N}_i\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\({Fr_i}^{-1}\)</span></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>Non-dim. maximum time stepping</p></td>
<td><p><span class="math notranslate nohighlight">\({\delta_\hat{t}}^{\text{max}}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(5\times 10^{-2}\)</span></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>CFL condition</p></td>
<td><p>-</p></td>
<td><p><span class="math notranslate nohighlight">\(0.5\)</span></p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>Horizontal velocity</p></td>
<td><p><span class="math notranslate nohighlight">\(U\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0.1\)</span></p></td>
<td><p>[m s<span class="math notranslate nohighlight">\(^{-1}\)</span>]</p></td>
</tr>
<tr class="row-odd"><td><p>Length scale</p></td>
<td><p><span class="math notranslate nohighlight">\(L\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(50\)</span></p></td>
<td><p>[km]</p></td>
</tr>
<tr class="row-even"><td><p>Total layer thickness</p></td>
<td><p><span class="math notranslate nohighlight">\(H\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(5000\)</span></p></td>
<td><p>[m]</p></td>
</tr>
</tbody>
</table>
<p><strong>Table 1.</strong> Parameters used to configure the three-layer QG simulation and dimensionalized characteristic scales. The bottom Ekman number is the ratio between the bottom Ekman-layer thickness and <span class="math notranslate nohighlight">\(\widehat{H}_3\)</span> and bottom friction is <span class="math notranslate nohighlight">\(\epsilon = Ek^b/(2Ro^m \widehat{H}_3)\)</span>. Beta is dimensionalized as <span class="math notranslate nohighlight">\(\beta = \hat{\beta}U/L^2\)</span> and the dimensionalized domain size is <span class="math notranslate nohighlight">\(4000~\text{km}\ (=L_0 L)\)</span>. The frequency of <span class="math notranslate nohighlight">\(Fr\)</span> translates approximately to a 360-day year (<span class="math notranslate nohighlight">\(=f_{Fr}^{-1} L/U\)</span>). The prognostic time stepping is determined via the CFL condition within values smaller than <span class="math notranslate nohighlight">\({\delta_\hat{t}}^{\text{max}}\)</span>.</p>
<p>The characteristic length scale of the first Rossby radius of deformation (viz. radii of mesoscale eddies) is prescribed as <span class="math notranslate nohighlight">\(L\ (= 50~\text{km})\)</span> and horizontal resolution is <span class="math notranslate nohighlight">\(\sim 15~\text{km}\ (=\delta_{\hat{x}} L)\)</span> and so we have roughly 5 grid points per radius; our simulation can be considered mesoscale permitting.</p>
<p>We spin up the model for 10 years from a spun-up run with stationary forcing and then perturb the first-layer stream function at a single, random grid point with a perturbation on the order of a floating point error (<span class="math notranslate nohighlight">\(O(10^{-31})\)</span>) to generate 100 slightly perturbed stream function fields. We use the perturbed fields as the initial conditions to generate 100 ensemble members. The surface wind stress and temporally varying background stratification are kept identical during the spin up and amongst ensemble members after the spin up. Here, we provide an example analysis using the last step from the ensemble output in addition to a CTRL run without any perturbations in its initial condition.</p>
</div>
<div class="section" id="results">
<h2>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h2>
<div class="section" id="theory">
<h3>Theory<a class="headerlink" href="#theory" title="Permalink to this headline">¶</a></h3>
<p>Although the quasi-geostrophic (QG) E-P flux has been derived numerous times (<a class="reference external" href="https://books.google.fr/books?hl=fr&amp;lr=&amp;id=BTgoDwAAQBAJ&amp;oi=fnd&amp;pg=PR13&amp;dq=Vallis+atmospheric&amp;ots=wgYr69QZ2o&amp;sig=mRDounQdCScxJ9D1VBg4GRGbLUQ&amp;redir_esc=y#v=onepage&amp;q=Vallis%20atmospheric&amp;f=false">Vallis, 2017</a>), we briefly discuss it here in order to highlight the relation with its primitive equation form. The QG potential vorticity (PV) equation, neglecting the forcing and dissipative terms is:</p>
<div class="math notranslate nohighlight">
\[\frac{Dq}{Dt} + \beta \psi_x = 0, \tag{1}\]</div>
<p>where the subscript denotes the derivatives with respect to <span class="math notranslate nohighlight">\((t,z,y,x)\)</span>. Taking the ensemble average of equation (1) gives:</p>
<div class="math notranslate nohighlight">
\[\frac{D^\#\overline{q}} {Dt} + \beta \overline{\psi}_x = -\nabla_\text{h}\cdot\overline{\boldsymbol{u}' q'}, \tag{2}\]</div>
<p>where <span class="math notranslate nohighlight">\(\frac{D^\#}{Dt} = \frac{\partial}{\partial t} + \overline{\boldsymbol{u}} \cdot \nabla_\text{h}\)</span> and <span class="math notranslate nohighlight">\(\nabla_\text{h} = (\frac{\partial}{\partial x}, \frac{\partial}{\partial y})\)</span> is the horizontal gradient operator. The ensemble-mean operator commutes with derivative with respect to <span class="math notranslate nohighlight">\((t,z,y,x)\)</span> and primes are defined as the fluctuations about the ensemble mean (<span class="math notranslate nohighlight">\((\cdot)' = (\cdot) - \overline{(\cdot)}\)</span>). We see the commonly known feature of eddies feeding back onto the mean flow via the eddy QGPV flux.
An eddy flux tensor can be defined as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
{\bf T} = \left(\begin{array}{ccc} 
\overline{u'v'} &amp; \frac{1}{2} (\overline{v'v'} - \overline{u'u'}) - \frac{1}{2N^2}\overline{b'b'} &amp; 0\\
\frac{1}{2} (\overline{v'v'} - \overline{u'u'}) + \frac{1}{2N^2}\overline{b'b'} &amp; -\overline{v'u'} &amp; 0\\
\frac{f_0}{N^2} \overline{u'b'} &amp; \frac{f_0}{N^2} \overline{v'b'} &amp; 0
\end{array}\right),
\end{split}\]</div>
<p>which satisfies <span class="math notranslate nohighlight">\(\overline{\boldsymbol{u}' q'} = \nabla\cdot{\bf T}\)</span> (<a class="reference external" href="https://books.google.fr/books?hl=fr&amp;lr=&amp;id=BTgoDwAAQBAJ&amp;oi=fnd&amp;pg=PR13&amp;dq=Vallis+atmospheric&amp;ots=wgYr69QZ2o&amp;sig=mRDounQdCScxJ9D1VBg4GRGbLUQ&amp;redir_esc=y#v=onepage&amp;q=Vallis%20atmospheric&amp;f=false">Vallis, 2017</a>). Now, taking into consideration that the relative vorticity is derived by taking the cross product of the momentum equation, the E-P flux tensor can be defined as (<a class="reference external" href="https://doi.org/10.1175/1520-0469(1986)043%3C1657:TDPOTQ%3E2.0.CO;2">Plumb, 1986</a>; <a class="reference external" href="https://doi.org/10.1017/jfm.2013.259">Maddison and Marshall, 2013</a>):</p>
<div class="math notranslate nohighlight">
\[\begin{split}{\bf E}^P = \left(\begin{array}{ccc} 
\frac{1}{2} (\overline{u'u'} - \overline{v'v'}) + \frac{1}{2N^2} \overline{b'b'} &amp; \overline{v'u'} &amp; 0\\
\overline{u'v'} &amp; \frac{1}{2} (\overline{v'v'} - \overline{u'u'}) + \frac{1}{2N^2} \overline{b'b'} &amp; 0\\
-\frac{f_0}{N^2} \overline{v'b'} &amp; \frac{f_0}{N^2} \overline{u'b'} &amp; 0
\end{array}\right), \tag{3}
\end{split}\]</div>
<p>which satisfies <span class="math notranslate nohighlight">\(\boldsymbol{k}\times\overline{\boldsymbol{u}' q'} = \nabla\cdot{\bf E}^P\)</span> where <span class="math notranslate nohighlight">\(\boldsymbol{k}\)</span> is the vertical unit vector.
It can be further shown that:</p>
<div class="math notranslate nohighlight">
\[
-\boldsymbol{i}\cdot(\nabla\cdot{\bf E}^P) = -(\overline{u'u'_x} + \overline{v'u'_y}) + \Big(\frac{\overline{u'u'} + \overline{v'v'}}{2} - \frac{\overline{b'b'}}{2N^2}\Big)_x + f_0\Big(\frac{\overline{v'b'}}{N^2}\Big)_z,
\]</div>
<div class="math notranslate nohighlight">
\[
-\boldsymbol{j}\cdot(\nabla\cdot{\bf E}^P) = -(\overline{u'v'_x} + \overline{v'v'_y}) + \Big(\frac{\overline{u'u'} + \overline{v'v'}}{2} - \frac{\overline{b'b'}}{2N^2}\Big)_y - f_0\Big(\frac{\overline{u'b'}}{N^2}\Big)_z.
\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{i}\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{j}\)</span> are the zonal and meridional unit vectors.
The first terms on the right-hand side are the eddy momentum fluxes so using the E-P flux tensor expression (3), the order-Rossby number momentum equations in their residual-mean form become (<a class="reference external" href="https://doi.org/10.1175/JPO-D-11-048.1">Marshall et al., 2012</a>):</p>
<div class="math notranslate nohighlight">
\[
\frac{D^\#\overline{u}}{Dt} - \beta y \overline{v} - f_0(\overline{v^a+v^*}) + \Big(\overline{\phi^a} + \frac{\overline{u'u'} + \overline{v'v'}}{2} - \frac{\overline{b'b'}}{2N^2}\Big)_x = - \boldsymbol{i}\cdot(\nabla\cdot{\bf E}^P), \tag{4}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{D^\#\overline{v}}{Dt} + \beta y \overline{u} + f_0(\overline{u^a+u^*}) + \Big(\overline{\phi^a} + \frac{\overline{u'u'} + \overline{v'v'}}{2} - \frac{\overline{b'b'}}{2N^2}\Big)_y = - \boldsymbol{j}\cdot(\nabla\cdot{\bf E}^P), \tag{5}
\]</div>
<p>where the superscript <span class="math notranslate nohighlight">\(a\)</span> denotes the ageostrophic component and <span class="math notranslate nohighlight">\(\boldsymbol{u}^* = -(\frac{1}{N^2} \overline{\boldsymbol{u}'b'})_z\)</span> is the eddy-induced velocity (<a class="reference external" href="https://doi.org/10.1175/1520-0485(1990)020%3C0150:IMIOCM%3E2.0.CO;2">Gent and McWilliams, 1990</a>; <a class="reference external" href="https://doi.org/10.1175/1520-0485(2001)031%3C1222:TTRMVP%3E2.0.CO;2">McDougall and McIntosh, 2001</a>).
The residual-mean buoyancy equation on the other hand, is:</p>
<div class="math notranslate nohighlight">
\[
\frac{D^\#}{Dt}\Big(\frac{\overline{b}}{N^2}\Big) + (w^a + w^*) = 0
\]</div>
<p>where <span class="math notranslate nohighlight">\(w^* = \boldsymbol{\nabla}_\text{h}\cdot(\frac{1}{N^2} \overline{\boldsymbol{u}'b'})\)</span>.
One may further manipulate equations (4) and (5) where the eddy kinetic energy is incorporated into the E-P flux, giving:</p>
<div class="math notranslate nohighlight">
\[
\frac{D^\#\overline{u}}{Dt} - \beta y \overline{v} - f_0(\overline{v^a+v^*}) + \Big(\overline{\phi^a} - \frac{\overline{b'b'}}{2N^2}\Big)_x = - \boldsymbol{i}\cdot(\nabla\cdot{\bf E}^Y), \tag{6}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{D^\#\overline{v}}{Dt} + \beta y \overline{u} + f_0(\overline{u^a+u^*}) + \Big(\overline{\phi^a} - \frac{\overline{b'b'}}{2N^2}\Big)_y = - \boldsymbol{j}\cdot(\nabla\cdot{\bf E}^Y), \tag{7}
\]</div>
<p>where the E-P flux tensor is now defined as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
{\bf E}^Y = \left(\begin{array}{ccc} 
\overline{u'u'} + \frac{1}{2N^2} \overline{b'b'} &amp; \overline{v'u'} &amp; 0 \\
\overline{u'v'} &amp; \overline{v'v'} + \frac{1}{2N^2} \overline{b'b'} &amp; 0 \\
-\frac{f_0}{N^2} \overline{v'b'} &amp; \frac{f_0}{N^2} \overline{u'b'} &amp; 0
\end{array}\right). \tag{8}
\end{split}\]</div>
<p>Since it is the divergence of the E-P flux tensor that appears in the momentum equations and not the flux itself, the manipulation between <span class="math notranslate nohighlight">\({\bf E}^P\)</span> and <span class="math notranslate nohighlight">\({\bf E}^Y\)</span> is equivalent to adding a rotational (non-divergent) component to E-P flux (<a class="reference external" href="https://doi.org/10.1017/jfm.2013.259">Maddison and Marshall, 2013</a>).
(We note that unlike <span class="math notranslate nohighlight">\({\bf E}^P\)</span>, the divergence of <span class="math notranslate nohighlight">\({\bf E}^Y\)</span> is not the eddy PV flux, viz. <span class="math notranslate nohighlight">\(\boldsymbol{\nabla}_\text{h}\cdot{\bf E}^Y \neq \boldsymbol{k}\times\overline{\boldsymbol{u}' q'}\)</span>.)
The modified pressure in equations (6) and (7) is the QG approximation to the residual-mean pressure anomaly (<span class="math notranslate nohighlight">\(\phi^\#\)</span>) in relation to the thickness-weighted averaged (TWA) framework in primitive equations (<a class="reference external" href="https://doi.org/10.1175/JPO-D-11-0102.1">Young, 2012</a>):</p>
<div class="math notranslate nohighlight">
\[
\phi^\#_x = \overline{m^a_x} + \overline{z}\overline{b}_x \nonumber = \overline{\phi^a_x} - \overline{zb_x} + \overline{z}\overline{b}_x \nonumber = \overline{\phi^a_x} - \overline{z'b'_x} \nonumber \sim \Big(\overline{\phi^a} - \frac{\overline{b'b'}}{2N^2}\Big)_x,
\]</div>
<div class="math notranslate nohighlight">
\[
\phi^\#_y = \overline{m^a_y} + \overline{z}\overline{b}_y \nonumber = \overline{\phi^a_y} - \overline{zb_y} + \overline{z}\overline{b}_y \nonumber = \overline{\phi^a_y} - \overline{z'b'_y} \nonumber \sim \Big(\overline{\phi^a} - \frac{\overline{b'b'}}{2N^2}\Big)_y,
\]</div>
<p>where <span class="math notranslate nohighlight">\(m\ (=\phi - bz)\)</span> is the Montgomery potential and we have used the relation <span class="math notranslate nohighlight">\(z' \sim N^{-2}b'\)</span>.
Although equations (6)–(8) resemble more closely the momentum equations in the TWA framework, it is perhaps interesting to note that taking the cross product of equations (4) and (5), and (6) and (7) both give the mean relative vorticity equation:</p>
<div class="math notranslate nohighlight">
\[
\frac{D^\#\overline{\zeta}}{Dt} + \beta\overline{v} - f_0(w^a + w^*)_z = - \boldsymbol{j}\cdot(\nabla\cdot{\bf E}^P)_x + \boldsymbol{i}\cdot(\nabla\cdot{\bf E}^P)_y = - \boldsymbol{j}\cdot(\nabla\cdot{\bf E}^Y)_x + \boldsymbol{i}\cdot(\nabla\cdot{\bf E}^Y)_y, \tag{9}
\]</div>
<p>which leads to the relation:</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{j}\cdot(\nabla\cdot{\bf E}^P)_x - \boldsymbol{i}\cdot(\nabla\cdot{\bf E}^P)_y = \boldsymbol{\nabla}_\text{h} \cdot \overline{\boldsymbol{u}'q'} = \boldsymbol{j}\cdot(\nabla\cdot{\bf E}^Y)_x - \boldsymbol{i}\cdot(\nabla\cdot{\bf E}^Y)_y. \tag{10}
\]</div>
<p>We retain from equation (10) that the eddy PV flux <em>divergence</em> is insensitive to the rotational (gauge) component.</p>
</div>
<div class="section" id="diagnostics-from-qg-ensemble">
<h3>Diagnostics from QG ensemble<a class="headerlink" href="#diagnostics-from-qg-ensemble" title="Permalink to this headline">¶</a></h3>
<p>The two formalisms (3) and (8) both show that the E-P flux convergence (i.e. negative divergence), which encapsulated the eddy feedback onto the mean momentum, tends to sharpen the separated jet but differ slightly in magnitude in their eddy momentum contribution, namely the diagonal components in each tensor.
In the PV equation (2), since it is the <em>divergence</em> of eddy PV flux and not the flux itself, we have shown that the net eddy feedback on the mean PV is insensitive to the formalism chosen. This allows to rephrase the sharpening of the jet as eddies acting as a source for the mean QGPV on the southern flank of the jet and sink on the northern flank of the jet.</p>
</div>
</div>
<div class="section" id="funding">
<h2>Funding<a class="headerlink" href="#funding" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Award1 = {“agency”: “Agence Nationale de la Recherche”, “award_code”: “ANR-18-MPGA-0002”, “award_URL”: “<a class="reference external" href="https://anr.fr/ProjetIA-18-MPGA-0002">https://anr.fr/ProjetIA-18-MPGA-0002</a> “}</p></li>
</ul>
</div>
<div class="section" id="keywords">
<h2>Keywords<a class="headerlink" href="#keywords" title="Permalink to this headline">¶</a></h2>
<p>keywords=[“Quasi-geostrophy”, “Eliassen-Palm flux”, “Ensemble modelling”]</p>
</div>
<div class="section" id="work-in-progress-improvements">
<h2>Work In Progress - improvements<a class="headerlink" href="#work-in-progress-improvements" title="Permalink to this headline">¶</a></h2>
<p>Notable TODOs:</p>
<ul class="simple">
<li><p>Examine the seasonal variability of the E-P flux divergence;</p></li>
<li><p>Currently in the process of generating an ensemble with increased spatial resolution (~4 km) for better resolved mesoscale eddies;</p></li>
<li><p>Further investigate the relation of the E-P flux divergence between QG and primitive equations.</p></li>
</ul>
</div>
<div class="section" id="acknowledgements">
<h2>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Permalink to this headline">¶</a></h2>
<p>Uchida acknowledges the fruitful discussions he had with Ryan P. Abernathey and Dhruv Balwada in the eddy parametrization reading group towards the end of his Ph.D. where he was first introduced to the TWA framework.</p>
</div>
</div>
<div class="section" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<div class="section" id="library-import">
<h2>Library import<a class="headerlink" href="#library-import" title="Permalink to this headline">¶</a></h2>
<p>Import all the required Python libraries.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data manipulation</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">from</span> <span class="nn">xgcm.grid</span> <span class="kn">import</span> <span class="n">Grid</span>

<span class="c1"># Parallelization</span>
<span class="kn">from</span> <span class="nn">dask.diagnostics</span> <span class="kn">import</span> <span class="n">ProgressBar</span>

<span class="c1"># Visualizations</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">clr</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;pcolor.shading&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="parameter-definitions">
<h1>Parameter definitions<a class="headerlink" href="#parameter-definitions" title="Permalink to this headline">¶</a></h1>
<p>We set all relevant parameters for our notebook described in Table 1. By convention, parameters are uppercase, while all the
other variables follow Python’s guidelines.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">U</span>    <span class="o">=</span> <span class="o">.</span><span class="mi">1</span>                                 <span class="c1"># Characteristic velocity scale (Rossby radius; 0.1 m s-1)</span>
<span class="n">L</span>    <span class="o">=</span> <span class="mf">5e4</span>                                <span class="c1"># Characteristic length scale (Rossby radius; 50 km)</span>
<span class="n">T</span>    <span class="o">=</span> <span class="n">L</span><span class="o">/</span><span class="n">U</span>                                <span class="c1"># Characteristic time scale (5e5 seconds ~ 5.8 days)</span>
<span class="n">H</span>    <span class="o">=</span> <span class="mf">5e3</span>                                <span class="c1"># Dimensionalized depth (5000 m)</span>
<span class="n">TAU0</span> <span class="o">=</span> <span class="o">.</span><span class="mi">0001</span>                              <span class="c1"># Non-dimensionalized wind stress amplitude</span>
<span class="n">RE4</span>  <span class="o">=</span> <span class="mf">1563.</span>                              <span class="c1"># Biharmonic Reynolds number</span>
<span class="n">BETA</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span>                                 <span class="c1"># Non-dimensionalized beta</span>
<span class="n">N</span>    <span class="o">=</span> <span class="mi">256</span>                                <span class="c1"># Number of horizontal grids</span>
<span class="n">L0</span>   <span class="o">=</span> <span class="mi">80</span>                                 <span class="c1"># Non-dimensionalized horizontal domain size</span>
<span class="n">DX</span>   <span class="o">=</span> <span class="n">L0</span><span class="o">/</span><span class="n">N</span>                               <span class="c1"># Non-dimensionalized horizontal resolution (corresponds to a resolution of ~15 km)</span>
<span class="n">RO</span>   <span class="o">=</span> <span class="o">.</span><span class="mi">025</span>                               <span class="c1"># Rossby number</span>
<span class="n">F0</span>   <span class="o">=</span> <span class="n">RO</span><span class="o">**-</span><span class="mi">1</span>                             <span class="c1"># Non-dimensionalized Coriolis parameter</span>
<span class="n">EKB</span>  <span class="o">=</span> <span class="o">.</span><span class="mi">004</span>                               <span class="c1"># Bottom Ekman number</span>
<span class="n">FR</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.00409959</span><span class="p">,</span><span class="mf">0.01319355</span><span class="p">])</span>  <span class="c1"># Mean Froude number defined at the layer interfaces</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="data-import">
<h1>Data import<a class="headerlink" href="#data-import" title="Permalink to this headline">¶</a></h1>
<p>We import the three-layer stream function from the last time step of the 101-member ensemble.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;../psi000_10percent_lasttimestep.nc&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">ds</span><span class="p">[</span><span class="s1">&#39;N2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span> <span class="n">FR</span><span class="o">**-</span><span class="mi">2</span><span class="p">)</span>                <span class="c1"># Non-dimensionalized background stratification defined at the layer interface</span>
<span class="n">ds</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:  (XC: 256, XG: 256, YC: 256, YG: 256, Z: 3, Zp1: 2, nmemb: 101)
Coordinates:
  * YC       (YC) float64 0.1562 0.4688 0.7812 1.094 ... 78.91 79.22 79.53 79.84
  * XC       (XC) float64 0.1562 0.4688 0.7812 1.094 ... 78.91 79.22 79.53 79.84
  * Z        (Z) float64 0.03 0.13 0.6
    t        float32 622.0
  * nmemb    (nmemb) int64 0 1 2 3 4 5 6 7 8 9 ... 92 93 94 95 96 97 98 99 100
  * YG       (YG) float64 0.0 0.3125 0.625 0.9375 ... 78.75 79.06 79.38 79.69
  * XG       (XG) float64 0.0 0.3125 0.625 0.9375 ... 78.75 79.06 79.38 79.69
  * Zp1      (Zp1) float64 0.06 0.2
    drF      (Z) float64 0.06 0.14 0.8
    drC      (Zp1) float64 0.1 0.47
Data variables:
    psi      (nmemb, Z, YC, XC) float32 ...
    N2       (Zp1) float64 5.95e+04 5.745e+03</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-b49d57e1-af2a-4524-bcba-7250ad3944e5' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-b49d57e1-af2a-4524-bcba-7250ad3944e5' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>XC</span>: 256</li><li><span class='xr-has-index'>XG</span>: 256</li><li><span class='xr-has-index'>YC</span>: 256</li><li><span class='xr-has-index'>YG</span>: 256</li><li><span class='xr-has-index'>Z</span>: 3</li><li><span class='xr-has-index'>Zp1</span>: 2</li><li><span class='xr-has-index'>nmemb</span>: 101</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-b06980bf-cf5a-4ed1-a146-34e4a85ce562' class='xr-section-summary-in' type='checkbox'  checked><label for='section-b06980bf-cf5a-4ed1-a146-34e4a85ce562' class='xr-section-summary' >Coordinates: <span>(10)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>YC</span></div><div class='xr-var-dims'>(YC)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.1562 0.4688 ... 79.53 79.84</div><input id='attrs-9e4651e0-c222-4aea-b9aa-30907897fbf9' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9e4651e0-c222-4aea-b9aa-30907897fbf9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-247dfd0c-972a-41d8-8dc6-c010adb3d793' class='xr-var-data-in' type='checkbox'><label for='data-247dfd0c-972a-41d8-8dc6-c010adb3d793' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0.15625,  0.46875,  0.78125, ..., 79.21875, 79.53125, 79.84375])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>XC</span></div><div class='xr-var-dims'>(XC)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.1562 0.4688 ... 79.53 79.84</div><input id='attrs-fe473607-38b1-4df6-ab60-f9203cc81c8d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-fe473607-38b1-4df6-ab60-f9203cc81c8d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9ee67827-c044-4c26-9229-5263e9a790e8' class='xr-var-data-in' type='checkbox'><label for='data-9ee67827-c044-4c26-9229-5263e9a790e8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0.15625,  0.46875,  0.78125, ..., 79.21875, 79.53125, 79.84375])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>Z</span></div><div class='xr-var-dims'>(Z)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.03 0.13 0.6</div><input id='attrs-eca60ed8-1f6a-4a99-99ef-267a4f089885' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-eca60ed8-1f6a-4a99-99ef-267a4f089885' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ceb6a1df-2702-4843-94d5-81dc578f6427' class='xr-var-data-in' type='checkbox'><label for='data-ceb6a1df-2702-4843-94d5-81dc578f6427' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0.03, 0.13, 0.6 ])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-97fea8f8-910d-49cf-87ed-845a1ad79759' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-97fea8f8-910d-49cf-87ed-845a1ad79759' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-380bacfe-aa4b-4bfb-b023-df4f81c7308a' class='xr-var-data-in' type='checkbox'><label for='data-380bacfe-aa4b-4bfb-b023-df4f81c7308a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(622., dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>nmemb</span></div><div class='xr-var-dims'>(nmemb)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 ... 95 96 97 98 99 100</div><input id='attrs-2952ef56-bf8c-4dfa-9407-18eb1d5150df' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2952ef56-bf8c-4dfa-9407-18eb1d5150df' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-01af83a2-c33c-4144-80eb-8d1b30a662b5' class='xr-var-data-in' type='checkbox'><label for='data-01af83a2-c33c-4144-80eb-8d1b30a662b5' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([  0,   1,   2,   3,   4,   5,   6,   7,   8,   9,  10,  11,  12,  13,
        14,  15,  16,  17,  18,  19,  20,  21,  22,  23,  24,  25,  26,  27,
        28,  29,  30,  31,  32,  33,  34,  35,  36,  37,  38,  39,  40,  41,
        42,  43,  44,  45,  46,  47,  48,  49,  50,  51,  52,  53,  54,  55,
        56,  57,  58,  59,  60,  61,  62,  63,  64,  65,  66,  67,  68,  69,
        70,  71,  72,  73,  74,  75,  76,  77,  78,  79,  80,  81,  82,  83,
        84,  85,  86,  87,  88,  89,  90,  91,  92,  93,  94,  95,  96,  97,
        98,  99, 100])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>YG</span></div><div class='xr-var-dims'>(YG)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.0 0.3125 0.625 ... 79.38 79.69</div><input id='attrs-e1768525-7e4a-43cc-82d2-2b0468e2f5e9' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e1768525-7e4a-43cc-82d2-2b0468e2f5e9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ab9b67ee-cb8e-44f3-9781-676ab1a36791' class='xr-var-data-in' type='checkbox'><label for='data-ab9b67ee-cb8e-44f3-9781-676ab1a36791' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0.    ,  0.3125,  0.625 , ..., 79.0625, 79.375 , 79.6875])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>XG</span></div><div class='xr-var-dims'>(XG)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.0 0.3125 0.625 ... 79.38 79.69</div><input id='attrs-671d7694-1322-472e-8cf6-33429422b946' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-671d7694-1322-472e-8cf6-33429422b946' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-eb2d1d90-9033-41f5-9a06-823bb9748ba6' class='xr-var-data-in' type='checkbox'><label for='data-eb2d1d90-9033-41f5-9a06-823bb9748ba6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0.    ,  0.3125,  0.625 , ..., 79.0625, 79.375 , 79.6875])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>Zp1</span></div><div class='xr-var-dims'>(Zp1)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.06 0.2</div><input id='attrs-a57a6369-a1fe-4b65-9e66-b021bc61a9aa' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-a57a6369-a1fe-4b65-9e66-b021bc61a9aa' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-822629dd-7644-4f84-9ec4-46b10aca8bd2' class='xr-var-data-in' type='checkbox'><label for='data-822629dd-7644-4f84-9ec4-46b10aca8bd2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0.06, 0.2 ])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>drF</span></div><div class='xr-var-dims'>(Z)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-8274c1a8-68a8-4369-96fb-ace9e8137d54' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-8274c1a8-68a8-4369-96fb-ace9e8137d54' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b87d3298-3d6a-4e42-be66-9d38a2cd241c' class='xr-var-data-in' type='checkbox'><label for='data-b87d3298-3d6a-4e42-be66-9d38a2cd241c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0.06, 0.14, 0.8 ])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>drC</span></div><div class='xr-var-dims'>(Zp1)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-bb3393ff-1d3a-4e32-b2b6-5e54a6a68fb5' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-bb3393ff-1d3a-4e32-b2b6-5e54a6a68fb5' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-77e15063-c7b1-462d-9287-8e161d0ab4d9' class='xr-var-data-in' type='checkbox'><label for='data-77e15063-c7b1-462d-9287-8e161d0ab4d9' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0.1 , 0.47])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-1face7ae-ffd7-46a8-b774-16c816d66f6d' class='xr-section-summary-in' type='checkbox'  checked><label for='section-1face7ae-ffd7-46a8-b774-16c816d66f6d' class='xr-section-summary' >Data variables: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>psi</span></div><div class='xr-var-dims'>(nmemb, Z, YC, XC)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-3b00b82d-171d-425c-976c-d517892e9b0d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3b00b82d-171d-425c-976c-d517892e9b0d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-cadef011-d0a2-4dcf-b83a-cfb740624a42' class='xr-var-data-in' type='checkbox'><label for='data-cadef011-d0a2-4dcf-b83a-cfb740624a42' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[19857408 values with dtype=float32]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>N2</span></div><div class='xr-var-dims'>(Zp1)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>5.95e+04 5.745e+03</div><input id='attrs-0fe84276-4584-4777-b28c-4315c5510a17' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-0fe84276-4584-4777-b28c-4315c5510a17' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0e505d96-b6f3-4065-a1b8-ad62f1a8f396' class='xr-var-data-in' type='checkbox'><label for='data-0e505d96-b6f3-4065-a1b8-ad62f1a8f396' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([59500.29922689,  5744.82317201])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-44b792fc-db0f-425c-bb67-848d17e36d0d' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-44b792fc-db0f-425c-bb67-848d17e36d0d' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div></div>
</div>
<div class="section" id="define-a-xgcm-grid-object">
<h2>Define a <a class="reference external" href="https://doi.org/10.5281/zenodo.4056867"><code class="docutils literal notranslate"><span class="pre">xgcm.grid</span></code></a> object<a class="headerlink" href="#define-a-xgcm-grid-object" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">Grid</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">periodic</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Z&#39;</span><span class="p">:{</span><span class="s1">&#39;center&#39;</span><span class="p">:</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;inner&#39;</span><span class="p">:</span><span class="s1">&#39;Zp1&#39;</span><span class="p">}}</span>
           <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="data-processing-and-analysis">
<h1>Data processing and analysis<a class="headerlink" href="#data-processing-and-analysis" title="Permalink to this headline">¶</a></h1>
<div class="section" id="define-the-mean-and-eddy-stream-function-overline-psi-psi">
<h2>Define the mean and eddy stream function (<span class="math notranslate nohighlight">\(\overline{\psi}, \psi'\)</span>).<a class="headerlink" href="#define-the-mean-and-eddy-stream-function-overline-psi-psi" title="Permalink to this headline">¶</a></h2>
<p>The interfacial stream function is calculated as (<a class="reference external" href="https://doi.org/10.1175/1520-0485(1978)008%3C0363:TROMEI%3E2.0.CO;2">Holland, 1978</a>):</p>
<div class="math notranslate nohighlight">
\[
\psi^\dagger_i = \frac{H_{i+1}\psi_i + H_i\psi_{i+1}}{H_i + H_{i+1}} 
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psib</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">psi</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;nmemb&#39;</span><span class="p">)</span>      <span class="c1"># Mean stream function</span>
<span class="n">psip</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">psi</span> <span class="o">-</span> <span class="n">psib</span>             <span class="c1"># Eddy stream function</span>

<span class="c1"># Inter-facial stream function</span>
<span class="n">psip1</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">drF</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Z</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> 
                       <span class="o">*</span> <span class="n">ds</span><span class="o">.</span><span class="n">psi</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Z</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">values</span>
                       <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">drF</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Z</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> 
                       <span class="o">*</span> <span class="n">ds</span><span class="o">.</span><span class="n">psi</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Z</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">values</span>
                      <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">drF</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Z</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">drF</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Z</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">values</span>
                          <span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
                     <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nmemb&#39;</span><span class="p">,</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span><span class="s1">&#39;YC&#39;</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">],</span>
                     <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;nmemb&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">nmemb</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;Zp1&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">Zp1</span><span class="p">,</span>
                             <span class="s1">&#39;YC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;XC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>
                    <span class="p">)</span>
<span class="n">psip1b</span> <span class="o">=</span> <span class="n">psip1</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;nmemb&#39;</span><span class="p">)</span>     <span class="c1"># Mean inter-facial stream function</span>
<span class="n">psip1p</span> <span class="o">=</span> <span class="n">psip1</span> <span class="o">-</span> <span class="n">psip1b</span>          <span class="c1"># Eddy inter-facial stream function</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="define-a-function-to-pad-the-stream-function-to-satisfy-the-lateral-no-flux-boundary-condition-viz-psi-0-at-the-boundaries">
<h2>Define a function to pad the stream function to satisfy the lateral no-flux boundary condition (viz. <span class="math notranslate nohighlight">\(\psi=0\)</span> at the boundaries).<a class="headerlink" href="#define-a-function-to-pad-the-stream-function-to-satisfy-the-lateral-no-flux-boundary-condition-viz-psi-0-at-the-boundaries" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">pad_bc</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">bc</span><span class="o">=</span><span class="s1">&#39;dirichlet&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pad field psi with Dirichlet or Neumann boundary conditions</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    psi : array [nt,nz (,ny,nx)]</span>
<span class="sd">    bc   : &#39;dirichlet&#39; or &#39;neumann&#39;</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    psi_bc: array [nt,nz (,ny+2,nx+2)]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nd</span> <span class="o">=</span> <span class="n">psi</span><span class="o">.</span><span class="n">ndim</span>
    <span class="c1"># pad only horizontal dimensions</span>
    <span class="k">if</span> <span class="n">nd</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>    <span class="c1"># Three dimensional data</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">psi</span><span class="p">,((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="s1">&#39;constant&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">nd</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># Four dimensional data</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">psi</span><span class="p">,((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="s1">&#39;constant&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">bc</span> <span class="o">==</span> <span class="s1">&#39;dirichlet&#39;</span><span class="p">):</span> 
        <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,:]</span>  <span class="o">=</span> <span class="o">-</span><span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="o">-</span><span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,:]</span>
        <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,:,</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="o">-</span><span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,:,</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    
        <span class="c1"># corners</span>
        <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>   <span class="o">=</span> <span class="o">-</span><span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>   <span class="o">-</span> <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>   <span class="o">-</span> <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="o">-</span><span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>  <span class="o">-</span> <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>  <span class="o">-</span> <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="o">=</span> <span class="o">-</span><span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="o">-</span> <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>  <span class="o">-</span> <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">bc</span> <span class="o">==</span> <span class="s1">&#39;neumann&#39;</span><span class="p">):</span> 
        <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,:]</span>  <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,:]</span>
        <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,:,</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,:,</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    
        <span class="c1"># corners</span>
        <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>   <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">psi</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psip1b_padded</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">pad_bc</span><span class="p">(</span><span class="n">psip1b</span><span class="p">),</span> 
                             <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span><span class="s1">&#39;Yp1&#39;</span><span class="p">,</span><span class="s1">&#39;Xp1&#39;</span><span class="p">],</span>
                             <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Zp1&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">Zp1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                     <span class="s1">&#39;Yp1&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">DX</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">L0</span><span class="o">+</span><span class="n">DX</span><span class="p">,</span><span class="n">DX</span><span class="p">),</span>
                                     <span class="s1">&#39;Xp1&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">DX</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">L0</span><span class="o">+</span><span class="n">DX</span><span class="p">,</span><span class="n">DX</span><span class="p">)}</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="s1">&#39;Yp1&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;Xp1&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">})</span>
<span class="n">psip1p_padded</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">pad_bc</span><span class="p">(</span><span class="n">psip1p</span><span class="p">),</span> 
                             <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nmemb&#39;</span><span class="p">,</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span><span class="s1">&#39;Yp1&#39;</span><span class="p">,</span><span class="s1">&#39;Xp1&#39;</span><span class="p">],</span>
                             <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;nmemb&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">nmemb</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                     <span class="s1">&#39;Zp1&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">Zp1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                     <span class="s1">&#39;Yp1&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">DX</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">L0</span><span class="o">+</span><span class="n">DX</span><span class="p">,</span><span class="n">DX</span><span class="p">),</span>
                                     <span class="s1">&#39;Xp1&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">DX</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">L0</span><span class="o">+</span><span class="n">DX</span><span class="p">,</span><span class="n">DX</span><span class="p">)}</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="s1">&#39;nmemb&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;Yp1&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;Xp1&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="compute-the-horizontal-velocities-and-buoyancy-at-the-interfaces">
<h2>Compute the horizontal velocities and buoyancy at the interfaces<a class="headerlink" href="#compute-the-horizontal-velocities-and-buoyancy-at-the-interfaces" title="Permalink to this headline">¶</a></h2>
<div class="math notranslate nohighlight">
\[u = -\psi_y, v = \psi_x, b = f_0\psi_z\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ub</span> <span class="o">=</span> <span class="o">-</span><span class="n">psip1b_padded</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Xp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="s1">&#39;Yp1&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">DX</span>
<span class="n">vb</span> <span class="o">=</span> <span class="n">psip1b_padded</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Yp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="s1">&#39;Xp1&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">DX</span>
<span class="n">up</span> <span class="o">=</span> <span class="o">-</span><span class="n">psip1p_padded</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Xp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="s1">&#39;Yp1&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">DX</span>
<span class="n">vp</span> <span class="o">=</span> <span class="n">psip1p_padded</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Yp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="s1">&#39;Xp1&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">DX</span>
<span class="n">bb</span> <span class="o">=</span> <span class="o">-</span><span class="n">grid</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">psib</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">ds</span><span class="o">.</span><span class="n">drC</span> <span class="o">*</span> <span class="n">F0</span>
<span class="n">bp</span> <span class="o">=</span> <span class="o">-</span><span class="n">grid</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">psip</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">ds</span><span class="o">.</span><span class="n">drC</span> <span class="o">*</span> <span class="n">F0</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="compute-each-term-appearing-in-the-e-p-flux-tensor">
<h2>Compute each term appearing in the E-P flux tensor<a class="headerlink" href="#compute-each-term-appearing-in-the-e-p-flux-tensor" title="Permalink to this headline">¶</a></h2>
<div class="math notranslate nohighlight">
\[X = \overline{u'u'}, Y = \overline{v'v'}, M = \overline{u'v'}\]</div>
<div class="math notranslate nohighlight">
\[P = \frac{1}{2N^2}\overline{b'b'}, R = \frac{f_0}{2N^2}\overline{u'b'}, S = -\frac{f_0}{2N^2}\overline{v'b'}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ProgressBar</span><span class="p">():</span>
    <span class="n">X</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">((</span><span class="n">up</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;nmemb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Yp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span> 
                        <span class="o">+</span> <span class="p">(</span><span class="n">up</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;nmemb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Yp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                        <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span><span class="s1">&#39;YC&#39;</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">],</span> 
                        <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Zp1&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">Zp1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                <span class="s1">&#39;YC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>
                       <span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">((</span><span class="n">vp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;nmemb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Xp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span> 
                        <span class="o">+</span> <span class="p">(</span><span class="n">vp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;nmemb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Xp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                        <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span><span class="s1">&#39;YC&#39;</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">],</span> 
                        <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Zp1&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">Zp1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                <span class="s1">&#39;YC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>
                       <span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
    <span class="n">M</span> <span class="o">=</span> <span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">vp</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Xp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span> 
                      <span class="o">+</span> <span class="n">vp</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Xp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                      <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nmemb&#39;</span><span class="p">,</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span><span class="s1">&#39;YC&#39;</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">],</span> 
                      <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;nmemb&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">nmemb</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                              <span class="s1">&#39;Zp1&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">Zp1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                              <span class="s1">&#39;YC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">.</span><span class="n">data</span><span class="p">})</span>
         <span class="o">*</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">up</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Yp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span> 
                        <span class="o">+</span> <span class="n">up</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Yp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                        <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nmemb&#39;</span><span class="p">,</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span><span class="s1">&#39;YC&#39;</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">],</span> 
                        <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;nmemb&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">nmemb</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                <span class="s1">&#39;Zp1&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">Zp1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                <span class="s1">&#39;YC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">.</span><span class="n">data</span><span class="p">})</span>
        <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;nmemb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span> <span class="o">*</span> <span class="o">.</span><span class="mi">25</span>
    <span class="n">P</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">bp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;nmemb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span> <span class="o">/</span> <span class="n">ds</span><span class="o">.</span><span class="n">N2</span>
    <span class="n">R</span> <span class="o">=</span> <span class="p">(</span><span class="n">bp</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">up</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Yp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span> 
                              <span class="o">+</span> <span class="n">up</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Yp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                              <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nmemb&#39;</span><span class="p">,</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span><span class="s1">&#39;YC&#39;</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">],</span> 
                              <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;nmemb&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">nmemb</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                      <span class="s1">&#39;Zp1&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">Zp1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                      <span class="s1">&#39;YC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">.</span><span class="n">data</span><span class="p">})</span>
        <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;nmemb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span> <span class="o">*</span> <span class="n">F0</span> <span class="o">/</span> <span class="n">ds</span><span class="o">.</span><span class="n">N2</span>
    <span class="n">S</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">bp</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">vp</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Xp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span> 
                               <span class="o">+</span> <span class="n">vp</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Xp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                               <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nmemb&#39;</span><span class="p">,</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span><span class="s1">&#39;YC&#39;</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">],</span> 
                               <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;nmemb&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">nmemb</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                       <span class="s1">&#39;Zp1&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">Zp1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                       <span class="s1">&#39;YC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">.</span><span class="n">data</span><span class="p">})</span>
         <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;nmemb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span> <span class="o">*</span> <span class="n">F0</span> <span class="o">/</span> <span class="n">ds</span><span class="o">.</span><span class="n">N2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[########################################] | 100% Completed |  0.4s
[########################################] | 100% Completed |  0.5s
[########################################] | 100% Completed |  2.4s
[########################################] | 100% Completed |  0.9s
[########################################] | 100% Completed |  0.8s
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="compute-the-eliassen-palm-flux-in-the-formalism-of-2">
<h2>Compute the Eliassen-Palm flux in the formalism of (2)<a class="headerlink" href="#compute-the-eliassen-palm-flux-in-the-formalism-of-2" title="Permalink to this headline">¶</a></h2>
<div class="math notranslate nohighlight">
\[\begin{split}{\bf E}^P 
= \left(\begin{array}{ccc} 
\frac{1}{2} (X - Y) + P &amp; M &amp; 0\\
M &amp; \frac{1}{2} (Y - X) + P &amp; 0\\
S &amp; R &amp; 0
\end{array}\right) 
= \left(\begin{array}{ccc} 
E^P_{00} &amp; E^P_{01} &amp; 0\\
E^P_{10} &amp; E^P_{11} &amp; 0\\
E^P_{20} &amp; E^P_{21} &amp; 0
\end{array}\right).
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Ep00</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="n">Y</span><span class="p">)</span> <span class="o">+</span> <span class="n">P</span>
<span class="n">Ep01</span> <span class="o">=</span> <span class="n">M</span>
<span class="n">Ep11</span> <span class="o">=</span> <span class="o">-.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="n">Y</span><span class="p">)</span> <span class="o">+</span> <span class="n">P</span>
<span class="n">Ep20</span> <span class="o">=</span> <span class="n">S</span>
<span class="n">Ep21</span> <span class="o">=</span> <span class="n">R</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">14</span><span class="p">),</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_tight_layout</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">im0</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> 
                           <span class="n">psip1b</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="o">*</span><span class="n">L</span><span class="p">,</span> 
                           <span class="n">vmin</span><span class="o">=-</span><span class="mf">4e4</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">4e4</span><span class="p">,</span> 
                           <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">im1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span>
                           <span class="n">Ep01</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                           <span class="n">vmin</span><span class="o">=-</span><span class="mf">1e-2</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
                           <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">im2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span>
                           <span class="n">Ep00</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> 
                           <span class="n">vmin</span><span class="o">=-</span><span class="mf">2e-1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">2e-1</span><span class="p">,</span>
                           <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;seismic&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">im3</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span>
                           <span class="n">Ep11</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> 
                           <span class="n">vmin</span><span class="o">=-</span><span class="mf">2e-1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">2e-1</span><span class="p">,</span>
                           <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;seismic&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">im4</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span>
                           <span class="n">Ep20</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> 
                           <span class="n">vmin</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                           <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">im5</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> 
                           <span class="n">Ep21</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> 
                           <span class="n">vmin</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                           <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\overline{\psi^\dagger_1}$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\frac</span><span class="si">{1}{2}</span><span class="s2">(\overline{u&#39;u&#39;} - \overline{v&#39;v&#39;}) + \frac</span><span class="si">{1}</span><span class="s2">{2 N_0^2}\overline{b&#39;b&#39;}$&quot;</span><span class="p">,</span> 
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\overline{u&#39;v&#39;}$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\frac</span><span class="si">{1}{2}</span><span class="s2">(\overline{v&#39;v&#39;} - \overline{u&#39;u&#39;}) + \frac</span><span class="si">{1}</span><span class="s2">{2 N_0^2}\overline{b&#39;b&#39;}$&quot;</span><span class="p">,</span> 
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$-\frac</span><span class="si">{f_0}</span><span class="s2">{N_0^2}\overline{v&#39;b&#39;}$&quot;</span><span class="p">,</span> 
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\frac</span><span class="si">{f_0}</span><span class="s2">{N_0^2}\overline{u&#39;b&#39;}$&quot;</span><span class="p">,</span> 
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;X [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;X [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Y [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Y [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Y [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

<span class="n">cbar0</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">shrink</span><span class="o">=.</span><span class="mi">7</span><span class="p">)</span>
<span class="n">cbar0</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[m$^2$ s$^{-1}$]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">cbar1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">shrink</span><span class="o">=.</span><span class="mi">7</span><span class="p">)</span>
<span class="n">cbar1</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[m$^2$ s$^{-2}$]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">cbar2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">shrink</span><span class="o">=.</span><span class="mi">7</span><span class="p">)</span>
<span class="n">cbar2</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[m$^2$ s$^{-2}$]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">cbar3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im3</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">shrink</span><span class="o">=.</span><span class="mi">7</span><span class="p">)</span>
<span class="n">cbar3</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[m$^2$ s$^{-2}$]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">cbar4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im4</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">shrink</span><span class="o">=.</span><span class="mi">7</span><span class="p">)</span>
<span class="n">cbar4</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;($\times 10^{-3}$) [m$^2$ s$^{-2}$]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">cbar5</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">shrink</span><span class="o">=.</span><span class="mi">7</span><span class="p">)</span>
<span class="n">cbar5</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;($\times 10^{-3}$) [m$^2$ s$^{-2}$]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/TU_05_Diagnosing-the-Eliassen-Palm-flux-from-a-quasi-geostrophic-double-gyre-ensemble_22_0.png" src="../../../_images/TU_05_Diagnosing-the-Eliassen-Palm-flux-from-a-quasi-geostrophic-double-gyre-ensemble_22_0.png" />
</div>
</div>
<p>The mean stream function on the first layer interface shows a well defined separated jet extending from the western boundary.</p>
</div>
<div class="section" id="compute-the-eliassen-palm-flux-in-the-formalism-of-7">
<h2>Compute the Eliassen-Palm flux in the formalism of (7)<a class="headerlink" href="#compute-the-eliassen-palm-flux-in-the-formalism-of-7" title="Permalink to this headline">¶</a></h2>
<div class="math notranslate nohighlight">
\[\begin{split}
{\bf E}^Y = \left(\begin{array}{ccc} 
X + P &amp; N &amp; 0 \\
N &amp; Y + P &amp; 0 \\
S &amp; R &amp; 0
\end{array}\right)
= \left(\begin{array}{ccc} 
E^Y_{00} &amp; E^Y_{01} &amp; 0\\
E^Y_{10} &amp; E^Y_{11} &amp; 0\\
E^Y_{20} &amp; E^Y_{21} &amp; 0
\end{array}\right).
\end{split}\]</div>
<p>Note that only the diagonal terms are different from <span class="math notranslate nohighlight">\({\bf E}^P\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Ey00</span> <span class="o">=</span> <span class="n">X</span> <span class="o">+</span> <span class="n">P</span>
<span class="n">Ey11</span> <span class="o">=</span> <span class="n">Y</span> <span class="o">+</span> <span class="n">P</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_tight_layout</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">im2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span>
                         <span class="n">Ey00</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> 
                         <span class="n">vmin</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">2e-1</span><span class="p">,</span>
                         <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">im3</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span>
                         <span class="n">Ey11</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> 
                         <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">2e-1</span><span class="p">,</span>
                         <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\overline{u&#39;u&#39;} + \frac</span><span class="si">{1}</span><span class="s2">{2 N_0^2}\overline{b&#39;b&#39;}$&quot;</span><span class="p">,</span> 
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\overline{v&#39;v&#39;} + \frac</span><span class="si">{1}</span><span class="s2">{2 N_0^2}\overline{b&#39;b&#39;}$&quot;</span><span class="p">,</span> 
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;X [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;X [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Y [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

<span class="n">cbar2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shrink</span><span class="o">=.</span><span class="mi">7</span><span class="p">)</span>
<span class="n">cbar2</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[m$^2$ s$^{-2}$]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">cbar3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im3</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">shrink</span><span class="o">=.</span><span class="mi">7</span><span class="p">)</span>
<span class="n">cbar3</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[m$^2$ s$^{-2}$]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/TU_05_Diagnosing-the-Eliassen-Palm-flux-from-a-quasi-geostrophic-double-gyre-ensemble_26_0.png" src="../../../_images/TU_05_Diagnosing-the-Eliassen-Palm-flux-from-a-quasi-geostrophic-double-gyre-ensemble_26_0.png" />
</div>
</div>
</div>
<div class="section" id="compute-the-e-p-flux-divergence-based-on-the-formalism-of-2">
<h2>Compute the E-P flux divergence based on the formalism of (2)<a class="headerlink" href="#compute-the-e-p-flux-divergence-based-on-the-formalism-of-2" title="Permalink to this headline">¶</a></h2>
<div class="math notranslate nohighlight">
\[
-\boldsymbol{i}\cdot(\nabla\cdot{\bf E}^P) = -\Big[\frac{1}{2}\big(\overline{u'u'} - \overline{v'v'}\big) + \frac{\overline{b'b'}}{2 N_0^2}\Big]_x - \big(\overline{v'u'}\big)_y + \Big(\frac{f_0}{N_0^2}\overline{v'b'}\Big)_z\ \ (= \overline{v'q'}),
\]</div>
<div class="math notranslate nohighlight">
\[
-\boldsymbol{j}\cdot(\nabla\cdot{\bf E}^P) = -\big(\overline{u'v'}\big)_x - \Big[\frac{1}{2}\big(\overline{v'v'} - \overline{u'u'}\big) + \frac{\overline{b'b'}}{2 N_0^2}\Big]_y -\Big(\frac{f_0}{N_0^2}\overline{u'b'}\Big)_z\ \ (= -\overline{u'q'}).
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Ep00_padded</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">pad_bc</span><span class="p">(</span><span class="n">Ep00</span><span class="p">),</span> 
                           <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span><span class="s1">&#39;Yp1&#39;</span><span class="p">,</span><span class="s1">&#39;Xp1&#39;</span><span class="p">],</span>
                           <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Zp1&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">Zp1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                   <span class="s1">&#39;Yp1&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">DX</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">L0</span><span class="o">+</span><span class="n">DX</span><span class="p">,</span><span class="n">DX</span><span class="p">),</span>
                                   <span class="s1">&#39;Xp1&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">DX</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">L0</span><span class="o">+</span><span class="n">DX</span><span class="p">,</span><span class="n">DX</span><span class="p">)}</span>
                          <span class="p">)</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="s1">&#39;Yp1&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;Xp1&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">})</span>
<span class="n">Ep00_x</span> <span class="o">=</span> <span class="n">Ep00_padded</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Yp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="s1">&#39;Xp1&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">DX</span>
<span class="n">Ep00_x</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">Ep00_x</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Xp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span> 
                         <span class="o">+</span> <span class="n">Ep00_x</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Xp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                         <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span><span class="s1">&#39;YC&#39;</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">],</span> 
                         <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Zp1&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">Zp1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                 <span class="s1">&#39;YC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>
                        <span class="p">)</span>
<span class="n">M_padded</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">pad_bc</span><span class="p">(</span><span class="n">M</span><span class="p">),</span> 
                        <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span><span class="s1">&#39;Yp1&#39;</span><span class="p">,</span><span class="s1">&#39;Xp1&#39;</span><span class="p">],</span>
                        <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Zp1&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">Zp1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                <span class="s1">&#39;Yp1&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">DX</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">L0</span><span class="o">+</span><span class="n">DX</span><span class="p">,</span><span class="n">DX</span><span class="p">),</span>
                                <span class="s1">&#39;Xp1&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">DX</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">L0</span><span class="o">+</span><span class="n">DX</span><span class="p">,</span><span class="n">DX</span><span class="p">)}</span>
                       <span class="p">)</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="s1">&#39;Yp1&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;Xp1&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">})</span>
<span class="n">Ep10_y</span> <span class="o">=</span> <span class="n">M_padded</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Xp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="s1">&#39;Yp1&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">DX</span>
<span class="n">Ep10_y</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">Ep10_y</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Yp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span> 
                         <span class="o">+</span> <span class="n">Ep10_y</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Yp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                         <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span><span class="s1">&#39;YC&#39;</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">],</span> 
                         <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Zp1&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">Zp1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                 <span class="s1">&#39;YC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>
                        <span class="p">)</span>

<span class="n">Ep01_x</span> <span class="o">=</span> <span class="n">M_padded</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Yp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="s1">&#39;Xp1&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">DX</span>
<span class="n">Ep01_x</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">Ep01_x</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Xp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span> 
                         <span class="o">+</span> <span class="n">Ep01_x</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Xp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                         <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span><span class="s1">&#39;YC&#39;</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">],</span> 
                         <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Zp1&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">Zp1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                 <span class="s1">&#39;YC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>
                        <span class="p">)</span>
<span class="n">Ep11_padded</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">pad_bc</span><span class="p">(</span><span class="n">Ep11</span><span class="p">),</span> 
                           <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span><span class="s1">&#39;Yp1&#39;</span><span class="p">,</span><span class="s1">&#39;Xp1&#39;</span><span class="p">],</span>
                           <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Zp1&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">Zp1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                   <span class="s1">&#39;Yp1&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">DX</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">L0</span><span class="o">+</span><span class="n">DX</span><span class="p">,</span><span class="n">DX</span><span class="p">),</span>
                                   <span class="s1">&#39;Xp1&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">DX</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">L0</span><span class="o">+</span><span class="n">DX</span><span class="p">,</span><span class="n">DX</span><span class="p">)}</span>
                          <span class="p">)</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="s1">&#39;Yp1&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;Xp1&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">})</span>
<span class="n">Ep11_y</span> <span class="o">=</span> <span class="n">Ep11_padded</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Xp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="s1">&#39;Yp1&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">DX</span>
<span class="n">Ep11_y</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">Ep11_y</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Yp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span> 
                         <span class="o">+</span> <span class="n">Ep11_y</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Yp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                         <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span><span class="s1">&#39;YC&#39;</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">],</span> 
                         <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Zp1&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">Zp1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                 <span class="s1">&#39;YC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>
                        <span class="p">)</span>

<span class="n">Ep20_z</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">Ep20</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">boundary</span><span class="o">=</span><span class="s1">&#39;extend&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">ds</span><span class="o">.</span><span class="n">drF</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Z</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Ep21_z</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">Ep21</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">boundary</span><span class="o">=</span><span class="s1">&#39;extend&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">ds</span><span class="o">.</span><span class="n">drF</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Z</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Weighted averaging </span>
<span class="n">Ep00_xC</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span> <span class="p">((</span><span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> 
                          <span class="o">*</span> <span class="n">Ep00_x</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span>
                          <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> 
                          <span class="o">*</span> <span class="n">Ep00_x</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span>
                         <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span>
                             <span class="p">)[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                       <span class="n">dims</span><span class="o">=</span><span class="n">Ep20_z</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">Ep20_z</span><span class="o">.</span><span class="n">coords</span>
                      <span class="p">)</span>
<span class="n">Ep01_xC</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span> <span class="p">((</span><span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> 
                          <span class="o">*</span> <span class="n">Ep01_x</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span>
                          <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> 
                          <span class="o">*</span> <span class="n">Ep01_x</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span>
                         <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span>
                             <span class="p">)[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                       <span class="n">dims</span><span class="o">=</span><span class="n">Ep21_z</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">Ep21_z</span><span class="o">.</span><span class="n">coords</span>
                      <span class="p">)</span>
<span class="n">Ep10_yC</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span> <span class="p">((</span><span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> 
                          <span class="o">*</span> <span class="n">Ep10_y</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span>
                          <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> 
                          <span class="o">*</span> <span class="n">Ep10_y</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span>
                         <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span>
                             <span class="p">)[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                       <span class="n">dims</span><span class="o">=</span><span class="n">Ep20_z</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">Ep20_z</span><span class="o">.</span><span class="n">coords</span>
                      <span class="p">)</span>
<span class="n">Ep11_yC</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span> <span class="p">((</span><span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> 
                          <span class="o">*</span> <span class="n">Ep11_y</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span>
                          <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> 
                          <span class="o">*</span> <span class="n">Ep11_y</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span>
                         <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span>
                             <span class="p">)[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                       <span class="n">dims</span><span class="o">=</span><span class="n">Ep21_z</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">Ep21_z</span><span class="o">.</span><span class="n">coords</span>
                      <span class="p">)</span>
<span class="n">Epx</span> <span class="o">=</span> <span class="p">((</span><span class="n">Ep00_xC</span> <span class="o">+</span> <span class="n">Ep10_yC</span><span class="p">)</span><span class="o">/</span><span class="n">L</span> <span class="o">+</span> <span class="n">Ep20_z</span><span class="o">/</span><span class="n">H</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="o">**</span><span class="mi">2</span>
<span class="n">Epy</span> <span class="o">=</span> <span class="p">((</span><span class="n">Ep01_xC</span> <span class="o">+</span> <span class="n">Ep11_yC</span><span class="p">)</span><span class="o">/</span><span class="n">L</span> <span class="o">+</span> <span class="n">Ep21_z</span><span class="o">/</span><span class="n">H</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vmax</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># fig.set_tight_layout(True)</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span>
                          <span class="o">-</span><span class="n">Ep00_xC</span> <span class="o">*</span> <span class="n">U</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">L</span><span class="o">*</span><span class="mf">1e7</span><span class="p">,</span> 
                          <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                          <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span>
                     <span class="o">-</span><span class="n">Ep10_yC</span> <span class="o">*</span> <span class="n">U</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">L</span><span class="o">*</span><span class="mf">1e7</span><span class="p">,</span> 
                     <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                     <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span>
                     <span class="o">-</span><span class="n">Ep01_xC</span> <span class="o">*</span> <span class="n">U</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">L</span><span class="o">*</span><span class="mf">1e7</span><span class="p">,</span> 
                     <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                     <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> 
                     <span class="o">-</span><span class="n">Ep11_yC</span> <span class="o">*</span> <span class="n">U</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">L</span><span class="o">*</span><span class="mf">1e7</span><span class="p">,</span> 
                     <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                     <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> 
                     <span class="o">-</span><span class="n">Ep20_z</span> <span class="o">*</span> <span class="n">U</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">H</span><span class="o">*</span><span class="mf">1e7</span><span class="p">,</span> 
                     <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                     <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> 
                     <span class="o">-</span><span class="n">Ep21_z</span> <span class="o">*</span> <span class="n">U</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">H</span><span class="o">*</span><span class="mf">1e7</span><span class="p">,</span> 
                     <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                     <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span>
                     <span class="o">-</span><span class="n">Epx</span><span class="o">*</span><span class="mf">1e7</span><span class="p">,</span> 
                     <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                     <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> 
                     <span class="o">-</span><span class="n">Epy</span><span class="o">*</span><span class="mf">1e7</span><span class="p">,</span> 
                     <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                     <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$-[\frac</span><span class="si">{1}{2}</span><span class="s2">(\overline{u&#39;u&#39;} - \overline{v&#39;v&#39;}) + \frac</span><span class="si">{1}</span><span class="s2">{2 N_0^2}\overline{b&#39;b&#39;}]_x$&quot;</span><span class="p">,</span> 
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$-(\overline{v&#39;u&#39;})_y$&quot;</span><span class="p">,</span> 
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$-(\overline{u&#39;v&#39;})_x$&quot;</span><span class="p">,</span> 
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$-[\frac</span><span class="si">{1}{2}</span><span class="s2">(\overline{v&#39;v&#39;} - \overline{u&#39;u&#39;}) + \frac</span><span class="si">{1}</span><span class="s2">{2 N_0^2}\overline{b&#39;b&#39;}]_y$&quot;</span><span class="p">,</span> 
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$(\frac</span><span class="si">{f_0}</span><span class="s2">{N_0^2}\overline{v&#39;b&#39;})_z$&quot;</span><span class="p">,</span> 
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$-(\frac</span><span class="si">{f_0}</span><span class="s2">{N_0^2}\overline{u&#39;b&#39;})_z$&quot;</span><span class="p">,</span> 
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$-{\bf i} \cdot(\nabla\cdot{\bf E}^P)$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$-{\bf j} \cdot(\nabla\cdot{\bf E}^P)$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;X [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;X [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Y [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Y [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Y [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Y [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.86</span><span class="p">)</span>
<span class="n">cbaxes</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.88</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.018</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span> 
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbaxes</span><span class="p">,</span>
                   <span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;($\times 10^{-7}$) [m s$^{-2}$]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/TU_05_Diagnosing-the-Eliassen-Palm-flux-from-a-quasi-geostrophic-double-gyre-ensemble_30_0.png" src="../../../_images/TU_05_Diagnosing-the-Eliassen-Palm-flux-from-a-quasi-geostrophic-double-gyre-ensemble_30_0.png" />
</div>
</div>
<p>The zonal component (<span class="math notranslate nohighlight">\(-\boldsymbol{i}\cdot(\boldsymbol{\nabla}\cdot {\bf E}^P)\)</span>) shows repeating dipole-like features in the separated jet region and likely contributing to the zonal meandering of the mean jet.
The meridional component (<span class="math notranslate nohighlight">\(-\boldsymbol{j}\cdot(\boldsymbol{\nabla}\cdot {\bf E}^P)\)</span>) tends to accelerate the jet northward on the southern flank and southward on the northern flank, leading to a sharpening of the jet.</p>
</div>
<div class="section" id="compute-the-e-p-flux-divergence-based-on-the-formalism-of-7">
<h2>Compute the E-P flux divergence based on the formalism of (7)<a class="headerlink" href="#compute-the-e-p-flux-divergence-based-on-the-formalism-of-7" title="Permalink to this headline">¶</a></h2>
<div class="math notranslate nohighlight">
\[
-\boldsymbol{i}\cdot(\nabla\cdot{\bf E}^Y) = -\Big(\overline{u'u'} + \frac{\overline{b'b'}}{2 N_0^2}\Big)_x - \big(\overline{v'u'}\big)_y + \Big(\frac{f_0}{N_0^2}\overline{v'b'}\Big)_z,
\]</div>
<div class="math notranslate nohighlight">
\[
-\boldsymbol{j}\cdot(\nabla\cdot{\bf E}^Y) = -\big(\overline{u'v'}\big)_x - \Big(\overline{v'v'} + \frac{\overline{b'b'}}{2 N_0^2}\Big)_y -\Big(\frac{f_0}{N_0^2}\overline{u'b'}\Big)_z.
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Ey00_padded</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">pad_bc</span><span class="p">(</span><span class="n">Ey00</span><span class="p">),</span> 
                           <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span><span class="s1">&#39;Yp1&#39;</span><span class="p">,</span><span class="s1">&#39;Xp1&#39;</span><span class="p">],</span>
                           <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Zp1&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">Zp1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                   <span class="s1">&#39;Yp1&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">DX</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">L0</span><span class="o">+</span><span class="n">DX</span><span class="p">,</span><span class="n">DX</span><span class="p">),</span>
                                   <span class="s1">&#39;Xp1&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">DX</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">L0</span><span class="o">+</span><span class="n">DX</span><span class="p">,</span><span class="n">DX</span><span class="p">)}</span>
                          <span class="p">)</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="s1">&#39;Yp1&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;Xp1&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">})</span>
<span class="n">Ey00_x</span> <span class="o">=</span> <span class="n">Ey00_padded</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Yp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="s1">&#39;Xp1&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">DX</span>
<span class="n">Ey00_x</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">Ey00_x</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Xp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span> 
                         <span class="o">+</span> <span class="n">Ey00_x</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Xp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                         <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span><span class="s1">&#39;YC&#39;</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">],</span> 
                         <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Zp1&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">Zp1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                 <span class="s1">&#39;YC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>
                        <span class="p">)</span>

<span class="n">Ey11_padded</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">pad_bc</span><span class="p">(</span><span class="n">Ey11</span><span class="p">),</span> 
                           <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span><span class="s1">&#39;Yp1&#39;</span><span class="p">,</span><span class="s1">&#39;Xp1&#39;</span><span class="p">],</span>
                           <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Zp1&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">Zp1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                   <span class="s1">&#39;Yp1&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">DX</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">L0</span><span class="o">+</span><span class="n">DX</span><span class="p">,</span><span class="n">DX</span><span class="p">),</span>
                                   <span class="s1">&#39;Xp1&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">DX</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">L0</span><span class="o">+</span><span class="n">DX</span><span class="p">,</span><span class="n">DX</span><span class="p">)}</span>
                          <span class="p">)</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="s1">&#39;Yp1&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;Xp1&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">})</span>
<span class="n">Ey11_y</span> <span class="o">=</span> <span class="n">Ey11_padded</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Xp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="s1">&#39;Yp1&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">DX</span>
<span class="n">Ey11_y</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">Ey11_y</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Yp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span> 
                         <span class="o">+</span> <span class="n">Ey11_y</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Yp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                         <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Zp1&#39;</span><span class="p">,</span><span class="s1">&#39;YC&#39;</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">],</span> 
                         <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Zp1&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">Zp1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                 <span class="s1">&#39;YC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>
                        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Weighted averaging </span>
<span class="n">Ey00_xC</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span> <span class="p">((</span><span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> 
                          <span class="o">*</span> <span class="n">Ey00_x</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span>
                          <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> 
                          <span class="o">*</span> <span class="n">Ey00_x</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span>
                         <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span>
                             <span class="p">)[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                       <span class="n">dims</span><span class="o">=</span><span class="n">Ep20_z</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">Ep20_z</span><span class="o">.</span><span class="n">coords</span>
                      <span class="p">)</span>
<span class="n">Ey11_yC</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span> <span class="p">((</span><span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> 
                          <span class="o">*</span> <span class="n">Ey11_y</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span>
                          <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> 
                          <span class="o">*</span> <span class="n">Ey11_y</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span>
                         <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">drC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Zp1</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">data</span>
                             <span class="p">)[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                       <span class="n">dims</span><span class="o">=</span><span class="n">Ep21_z</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">Ep21_z</span><span class="o">.</span><span class="n">coords</span>
                      <span class="p">)</span>
<span class="n">Eyx</span> <span class="o">=</span> <span class="p">((</span><span class="n">Ey00_xC</span> <span class="o">+</span> <span class="n">Ep10_yC</span><span class="p">)</span><span class="o">/</span><span class="n">L</span> <span class="o">+</span> <span class="n">Ep20_z</span><span class="o">/</span><span class="n">H</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="o">**</span><span class="mi">2</span>
<span class="n">Eyy</span> <span class="o">=</span> <span class="p">((</span><span class="n">Ep01_xC</span> <span class="o">+</span> <span class="n">Ey11_yC</span><span class="p">)</span><span class="o">/</span><span class="n">L</span> <span class="o">+</span> <span class="n">Ep21_z</span><span class="o">/</span><span class="n">H</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vmax</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># fig.set_tight_layout(True)</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span>
                          <span class="o">-</span><span class="n">Ey00_xC</span> <span class="o">*</span> <span class="n">U</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">L</span><span class="o">*</span><span class="mf">1e7</span><span class="p">,</span> 
                          <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                          <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> 
                     <span class="o">-</span><span class="n">Ey11_yC</span> <span class="o">*</span> <span class="n">U</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">L</span><span class="o">*</span><span class="mf">1e7</span><span class="p">,</span> 
                     <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                     <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span>
                     <span class="o">-</span><span class="n">Eyx</span><span class="o">*</span><span class="mf">1e7</span><span class="p">,</span> 
                     <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                     <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> 
                     <span class="o">-</span><span class="n">Eyy</span><span class="o">*</span><span class="mf">1e7</span><span class="p">,</span> 
                     <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                     <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$-(\overline{u&#39;u&#39;} + \frac{\overline{b&#39;^2}}{2 N_0^2})_x$&quot;</span><span class="p">,</span> 
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$-(\overline{v&#39;v&#39;} + \frac{\overline{b&#39;^2}}{2 N_0^2})_y$&quot;</span><span class="p">,</span> 
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$-{\bf i} \cdot(\nabla\cdot{\bf E}^Y)$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$-{\bf j} \cdot(\nabla\cdot{\bf E}^Y)$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;X [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;X [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Y [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Y [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.86</span><span class="p">)</span>
<span class="n">cbaxes</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.88</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.018</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span> 
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbaxes</span><span class="p">,</span>
                   <span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;($\times 10^{-7}$) [m s$^{-2}$]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/TU_05_Diagnosing-the-Eliassen-Palm-flux-from-a-quasi-geostrophic-double-gyre-ensemble_35_0.png" src="../../../_images/TU_05_Diagnosing-the-Eliassen-Palm-flux-from-a-quasi-geostrophic-double-gyre-ensemble_35_0.png" />
</div>
</div>
</div>
<div class="section" id="examine-that-the-two-formalisms-converge">
<h2>Examine that the two formalisms converge<a class="headerlink" href="#examine-that-the-two-formalisms-converge" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vmax</span> <span class="o">=</span> <span class="mi">12</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">im2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span>
                         <span class="o">-</span><span class="p">(</span><span class="n">Epy</span><span class="o">-</span><span class="n">Epx</span><span class="p">)</span><span class="o">*</span><span class="mf">1e7</span><span class="p">,</span> 
                         <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                         <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">im3</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span>
                         <span class="o">-</span><span class="p">(</span><span class="n">Eyy</span><span class="o">-</span><span class="n">Eyx</span><span class="p">)</span><span class="o">*</span><span class="mf">1e7</span><span class="p">,</span> 
                         <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                         <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$-{\bf j}\cdot(\nabla\cdot{\bf E}^P)_x + {\bf i}\cdot(\nabla\cdot{\bf E}^P)_y$&quot;</span><span class="p">,</span> 
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$-{\bf j}\cdot(\nabla\cdot{\bf E}^Y)_x + {\bf i}\cdot(\nabla\cdot{\bf E}^Y)_y$&quot;</span><span class="p">,</span> 
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;X [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;X [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Y [km]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.86</span><span class="p">)</span>
<span class="n">cbaxes</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.88</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.018</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span> 
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbaxes</span><span class="p">,</span>
                   <span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;($\times 10^{-7}$) [m s$^{-2}$]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/TU_05_Diagnosing-the-Eliassen-Palm-flux-from-a-quasi-geostrophic-double-gyre-ensemble_37_0.png" src="../../../_images/TU_05_Diagnosing-the-Eliassen-Palm-flux-from-a-quasi-geostrophic-double-gyre-ensemble_37_0.png" />
</div>
</div>
<p>The Eliassen-Palm flux convergence (i.e. negative divergence) acts as a source for the mean QGPV on the southern flank of the jet and sink on the northern flank of the jet.</p>
</div>
</div>
<div class="section" id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="https://doi.org/10.5281/zenodo.4669909">Deremble, B. &amp; Martinez, E.M. (2020) MSOM: Multiple Scale Ocean Model. doi: 10.5281/zenodo.4669909.</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.1175/1520-0485(1990)020%3C0150:IMIOCM%3E2.0.CO;2">Gent, P.R. &amp; McWilliams, J.C. (1990) Isopycnal mixing in ocean circulation models. <em>Journal of Physical Oceanography</em>. <strong>20</strong>, 150–155. doi: 10.1175/1520-0485(1990)020&lt;0150:IMIOCM&gt;2.0.CO;2.</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.1175/1520-0485(1978)008%3C0363:TROMEI%3E2.0.CO;2">Holland, W. (1978) The role of mesoscale eddies in the general circulation of the ocean—Numerical experiments using a wind-driven quasi-geostrophic model. <em>Journal of Physical Oceanography</em>. <strong>8</strong>, 363–392. doi: 10.1175/1520-0485(1978)008&lt;0363:TROMEI&gt;2.0.CO;2.</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.1175/1520-0485(2001)031%3C1222:TTRMVP%3E2.0.CO;2">McDougall, T.J. &amp; McIntosh, P.C. (2001) The temporal-residual-mean velocity. Part II: Isopycnal interpretation and the tracer and momentum equations. <em>Journal of Physical Oceanography</em>. <strong>31</strong>, 1222–1246. doi: 10.1175/1520-0485(2001)031&lt;1222:TTRMVP&gt;2.0.CO;2.</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.1017/jfm.2013.259">Maddison, J.R. &amp; Marshall, D.P. (2013) The Eliassen–Palm flux tensor. <em>Journal of Fluid Mechanics</em>. <strong>729</strong>, 69–102. doi: 10.1017/jfm.2013.259.</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.1175/JPO-D-11-048.1">Marshall, D.P.; Maddison, J.R. &amp; Berloff, P. (2012) A Framework for Parameterizing Eddy Potential Vorticity Fluxes. <em>Journal of Physical Oceanography</em>. <strong>42</strong>, 539–557. doi: 10.1175/JPO-D-11-048.1.</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.1175/1520-0469(1986)043%3C1657:TDPOTQ%3E2.0.CO;2">Plumb, A.R. (1986) Three-dimensional propagation of transient quasi-geostrophic eddies and its relationship with the eddy forcing of the time—mean flow. <em>Journal of Atmospheric Sciences</em>. <strong>43</strong>, 1657–1678. doi: 10.1175/1520-0469(1986)043&lt;1657:TDPOTQ&gt;2.0.CO;2.</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.1016/j.jcp.2015.09.009">Popinet, S. (2015) A quadtree-adaptive multigrid solver for the Serre-Green-Naghdi equations. <em>Journal of Computational Physics</em>. <strong>302</strong>, 336–358. doi: 10.1016/j.jcp.2015.09.009.</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.3390/fluids6060206">Uchida, T.; Deremble, B. &amp; Penduff, T. (2021) The Seasonal Variability of the Ocean Energy Cycle from a Quasi-Geostrophic Double Gyre Ensemble. <em>Fluids</em>. 6(6), <strong>206</strong>. doi: 10.3390/fluids6060206</a></p></li>
<li><p><a class="reference external" href="https://books.google.fr/books?hl=fr&amp;lr=&amp;id=BTgoDwAAQBAJ&amp;oi=fnd&amp;pg=PR13&amp;dq=Vallis+atmospheric&amp;ots=wgYr69QZ2o&amp;sig=mRDounQdCScxJ9D1VBg4GRGbLUQ&amp;redir_esc=y#v=onepage&amp;q=Vallis%20atmospheric&amp;f=false">Vallis, G. (2017) <em>Atmospheric and oceanic fluid dynamics</em>. Cambridge University Press.</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.5281/zenodo.4056867">Xgcm developers. (2021) xgcm: General Circulation Model Postprocessing with xarray. doi: 10.5281/zenodo.4056867</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.1175/JPO-D-11-0102.1">Young, W.R. (2012) An Exact Thickness-Weighted Average Formulation of the Boussinesq Equations. <em>Journal of Physical Oceanography</em>. <strong>42</strong>, 692–707. doi: 10.1175/JPO-D-11-0102.1</a></p></li>
</ul>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/ec21_uchida_etal/notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="../../ec21_shi_etal/Xingjian_Shi_01_Automated_Machine_Learning_for_Earth_Science_via_AutoGluon.html" title="previous page">Automated Machine Learning for Earth Science via AutoGluon</a>
    <a class='right-next' id="next-link" href="../../ec21_zheng_etal/README.html" title="next page">EZ-FeatureTrack</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By EarthCube Office<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>