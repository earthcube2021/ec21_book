
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Frequency-Domain Analysis of Large Datasets &#8212; EarthCube 2021 Call for Notebooks</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="13. Volcanic activity detection and noise characterization using machine learning" href="../ec21_mason_etal/README.html" />
    <link rel="prev" title="12. Frequency-domain analysis of large datasets" href="README.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      <img src="../../_static/logo.webp" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">EarthCube 2021 Call for Notebooks</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  EarthCube 2021 Call
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../docs/about.html">
   Call for Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   2021 Notebooks
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Notebook Submissions
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_anil_etal/README.html">
   1. Hydrographic Ocean Data Exploration
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_anil_etal/SA_01_Argo_Data_Exploration.html">
     Interactive Jupyter notebook for hydrographic ocean data exploration, retrieval and visualization via the Argovis API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_balwada_etal/README.html">
   2. Interactive Visualization Tools for Ocean Glider Data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_balwada_etal/DB_01_Glider_Viz_Panel.html">
     Glider Viz Panel
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_beckley_etal/README.html">
   3. Programmatic Access to OpenTopography’s Cloud Optimized Geotiff (COG) Global Datasets
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_beckley_etal/OT_01_BulkAccessCOGs.html">
     Programmatic Access to OpenTopography’s Cloud Optimized GeoTIFF (COG) Global Datasets
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_bourgault_etal/README.html">
   4. xclim : Software ecosystem for climate services
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_bourgault_etal/PB_02_xclim_Software_ecosystem_for_climate_services.html">
     xclim: Software ecosystem for climate services
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_cherian_etal/README.html">
   5. cf-xarray-earthcube
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_cherian_etal/DC_01_cf-xarray.html">
     cf-xarray: Scale your analysis across datasets with less data wrangling and more metadata handling
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_cych_etal/readme.html">
   6. Reanalysis of archived paleointensity data using a new statistical method.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_cych_etal/BC_01%20Bias%20Corrected%20Estimation%20of%20Paleointensity.html">
     BC_01 Bias Corrected Estimation of Paleointensity
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_dye_etal/README.html">
   7. Toward autonomous detection of anomalous GNSS data via applied unsupervised artificial intelligence
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_dye_etal/MD_01_TZVOLCANO_Unsupervised_AI_Anomaly_Detection.html">
     Toward autonomous detection of anomalous GNSS data via applied unsupervised artificial intelligence
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_garzon_etal/README.html">
   8. Exploring Research Data Repositories with geoextent.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_garzon_etal/showcase/SG_01_Exploring_Research_Data_Repositories_with_geoextent.html">
     Exploring Research Data Repositories with geoextent
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_gray_etal/README.html">
   9. Leveraging satellite data and pangeo to investigate the role of Gulf Stream frontal dynamics in ocean productivity
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_gray_etal/PG_01_gulf_stream_dynamics_role_in_productivity.html">
     Leveraging satellite data and pangeo to investigate the role of Gulf Stream frontal dynamics in ocean productivity
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_hu_etal/README.html">
   10. Machine Learning Guided Weather Analogs
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_hu_etal/WH_01_Spatio-Temporal_Deep_Analogs_2021.html">
     WH_01_Spatio-Temporal_Deep_Analogs_2021
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_lopez_etal/README.html">
   11. ITS_LIVE Explorer
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_lopez_etal/notebooks/itslive-notebook-rendered.html">
     Introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_lopez_etal/notebooks/LL_01_ITS_LIVE_global_glacier_velocity_exploration_and_analysis.html">
     <strong>
      ITS_LIVE
     </strong>
     Global Glacier Velocity Exploration and Analysis
     <a class="anchor" id="chapter_1">
     </a>
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="README.html">
   12. Frequency-domain analysis of large datasets
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Frequency-Domain Analysis of Large Datasets
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ec21_mason_etal/README.html">
   13. Volcanic activity detection and noise characterization using machine learning
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_maussion_etal/README.html">
   15. OGGM-edu EarthCube notebook
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_maussion_etal/FM_01_OGGM-Edu_learn_and_teach_about_glaciers.html">
     OGGM-Edu - Jupyter notebooks to learn and teach about glaciers
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_potnis_etal/README.html">
   16. JP 01 Real Time Alignment and Distribution of Weather Radar Data with Rain Gauge Data for Deep Learn
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_potnis_etal/JP_01_Real_Time_Alignment_and_Distribution_of_Weather_Radar_Data_with_Rain_Gauge_Data_for_Deep_Learning_using_CHORDS.html">
     Real Time Alignment and Distribution of Weather Radar Data with Rain Gauge Data for Deep Learning using CHORDS
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_seijo_etal/README.html">
   17. Notebook: Investigating upper ocean variability during tropical cyclones and seasonal sea ice formation and melting: Argovis APIs exposed to co-locate oceanic and atmospheric datasets
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_seijo_etal/GS_02_Argovis_TropicalCyclones_SeaIce.html">
     Investigating upper ocean variability  during tropical cyclones and seasonal  sea ice formation and melting: Argovis APIs exposed to co-locate oceanic and atmospheric datasets
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_shi_etal/README.html">
   18. Automated Machine Learning for Earth Science via AutoGluon
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_shi_etal/Xingjian_Shi_01_Automated_Machine_Learning_for_Earth_Science_via_AutoGluon.html">
     Automated Machine Learning for Earth Science via AutoGluon
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_uchida_etal/README.html">
   19. QG Eliassen-Palm flux
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_uchida_etal/notebooks/TU_05_Diagnosing-the-Eliassen-Palm-flux-from-a-quasi-geostrophic-double-gyre-ensemble.html">
     Diagnosing the Eliassen-Palm flux from a quasi-geostrophic double gyre ensemble
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_zheng_etal/README.html">
   20. EZ-FeatureTrack
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
  <label for="toctree-checkbox-18">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_zheng_etal/notebooks/WZ_01_mapping_ice_flow_velocity.html">
     Mapping ice flow velocity using an easy and interactive feature tracking workflow
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/notebooks/ec21_martin_etal/PM_01_Frequency-Domain_Analysis_of_Large_Datasets.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Frequency-Domain Analysis of Large Datasets
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#author-s">
     Author(s)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#purpose">
     Purpose
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#technical-contributions">
     Technical contributions
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#methodology">
     Methodology
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#results">
     Results
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#funding">
     Funding
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#keywords">
     Keywords
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#citation">
     Citation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#acknowledgements">
     Acknowledgements
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#library-import">
     Library import
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-import-processing-and-analysis">
   Data import, processing, and analysis
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-1-open-and-rechunk-the-original-data">
     Step 1: Open and rechunk the original data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#access-the-data">
       Access the data
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rechunk-the-data">
     Rechunk the data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#set-up-dask-cluster">
       (Set up Dask cluster)
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#execute-the-rechunk-function">
         Execute the
         <code class="docutils literal notranslate">
          <span class="pre">
           rechunk()
          </span>
         </code>
         function
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-2-compute-the-power-spectrum-of-sst">
     Step 2: Compute the power spectrum of SST
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#work-with-a-10-year-subset-of-the-rechunked-data">
       Work with a 10-year subset of the rechunked data
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#define-function-to-take-power-spectrum">
       Define function to take power spectrum
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#compute-the-power-spectrum-of-sst">
       Compute the power spectrum of SST
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-some-results">
       Load Some Results
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#start-dask-cluster">
         Start Dask cluster
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#write-to-zarr">
       Write to Zarr
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-3-plot-results">
     Step 3: Plot Results
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#area-average-power-spectrum">
       Area Average Power Spectrum
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#maps-of-different-frequency-band-averages">
       Maps of different frequency band averages
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="frequency-domain-analysis-of-large-datasets">
<h1>Frequency-Domain Analysis of Large Datasets<a class="headerlink" href="#frequency-domain-analysis-of-large-datasets" title="Permalink to this headline">¶</a></h1>
<div class="section" id="author-s">
<h2>Author(s)<a class="headerlink" href="#author-s" title="Permalink to this headline">¶</a></h2>
<p><strong>Paige Martin and Ryan Abernathey</strong></p>
<ul class="simple">
<li><p>Author1 = {“name”: “Paige Martin”, “affiliation”: “Australian National University/Lamont-Doherty Earth Observatory”, “email”: “<a class="reference external" href="mailto:paigemar&#37;&#52;&#48;umich&#46;edu">paigemar<span>&#64;</span>umich<span>&#46;</span>edu</a>”, “orcid”: “0000-0003-3538-633X”}</p></li>
<li><p>Author2 = {“name”: “Ryan Abernathey”, “affiliation”: “Lamont-Doherty Earth Observatory”, “email”: “<a class="reference external" href="mailto:rpa&#37;&#52;&#48;ldeo&#46;columbia&#46;edu">rpa<span>&#64;</span>ldeo<span>&#46;</span>columbia<span>&#46;</span>edu</a>”, “orcid”: “0000-0001-5999-4917”}</p></li>
</ul>
</div>
<div class="section" id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<p>Climate model datasets are typically stored as global snapshots, i.e. chunked in time rather than space. For many workflows, this chunking works well (e.g. computations across spatial domains at every point in time). However, this storage format can create serious challenges for processing long time series at each point in space, as is the case for frequency-domain analysis. For large datasets with frequent (e.g. daily) output, it is not feasible to process each spatial point as a single time series, even with the help of distributed computing such as Dask.</p>
<p>This notebook provides an example scientific workflow for performing frequency-domain analysis on large datasets. Specifically, this notebook presents a workflow for computing the power spectrum of sea surface temperature in the <a class="reference external" href="https://www.cesm.ucar.edu">Community Earth System Model</a> (CESM). While we carry out computations on a specific model, the main goal of this notebook is not to interpret scientific results from our computations, but rather to provide a working example of frequency-domain analysis on large datasets that others could follow.</p>
<p>Because the goal of this notebook is to provide an example of a workflow that works on large datasets, we have chosen to use a large dataset (CESM) that is available on Pangeo Cloud. This notebook is therefore developed for a Jupyter Hub environment that can access data stored on the Pangeo Cloud (e.g. <a class="reference external" href="https://binder.pangeo.io">PangeoBinder</a>).</p>
</div>
<div class="section" id="technical-contributions">
<h2>Technical contributions<a class="headerlink" href="#technical-contributions" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>demonstrates how to quickly rechunk data, e.g. from chunks in time to chunks in space, using the package <a class="reference external" href="https://rechunker.readthedocs.io/en/latest/">Rechunker</a></p></li>
<li><p>demonstrates how to easily perform Fourier analysis using the package <a class="reference external" href="https://xrft.readthedocs.io/en/latest/">xrft</a></p></li>
<li><p>shows that all of these steps, with the use of <a class="reference external" href="http://xarray.pydata.org/en/stable/">Xarray</a> and <a class="reference external" href="https://dask.org">Dask</a>, can be taken with large datasets</p></li>
</ul>
</div>
<div class="section" id="methodology">
<h2>Methodology<a class="headerlink" href="#methodology" title="Permalink to this headline">¶</a></h2>
<p>The notebook follows three main steps:</p>
<ol class="simple">
<li><p>Rechunk the data. We begin by rechunking the CESM sea surface temperature (SST) output from global, daily snapshots to chunks in space and 5-year chunks in time. This step is accomplished using the package <code class="docutils literal notranslate"><span class="pre">rechunker</span></code>.</p></li>
<li><p>Fourier analysis. Next we compute the power spectrum of SST using the package <code class="docutils literal notranslate"><span class="pre">xrft</span></code>, which nicely integrates with <code class="docutils literal notranslate"><span class="pre">Xarray</span></code> and <code class="docutils literal notranslate"><span class="pre">Dask</span></code>. Within <code class="docutils literal notranslate"><span class="pre">xrft</span></code>, we are also able to easily apply detrending and windowing functions to our data, and also account for the fact that our data are real (with no imaginary components).</p></li>
<li><p>Visualize the data. Last, we average over various frequency bands to show the spatial distribution of the SST power spectrum as global maps.</p></li>
</ol>
<p>Between each of these steps, we would typically write out the intermediate data. Specifically, we would write out the rechunked data, as well as the processed power spectra. Being able to write out data at intermediate steps is crucial to this workflow. However, due to the inability to write out data from Binder, we instead import previously rechunked data and use a spatial subset to compute and plot the power spectrum in this notebook. We still include all code necessary to run every step if a user wishes to run this notebook elsewhere that allows for data to be written out.</p>
</div>
<div class="section" id="results">
<h2>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h2>
<p>This notebook presents a feasible example for performing frequency-domain analysis on large datasets. Specifically, this notebook demonstrates how to quickly rechunk ~500GB of data from chunking in time to chunking in space. It also demonstrates how to pair the <code class="docutils literal notranslate"><span class="pre">xrft</span></code> library with the <code class="docutils literal notranslate"><span class="pre">rechunker</span></code> library to perform frequency-domain spectral analysis (here power spectra) and obtain interpretable results. We finish with a few sample plots to round out the workflow. This notebook is meant to serve as an example for others who wish to perform similar types of analysis.</p>
</div>
<div class="section" id="funding">
<h2>Funding<a class="headerlink" href="#funding" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Award1 = {“agency”: “Gordon and Betty Moore Foundation”, “award_code”: “”, “award_URL”: “<a class="reference external" href="https://www.moore.org">https://www.moore.org</a>”}</p></li>
</ul>
</div>
<div class="section" id="keywords">
<h2>Keywords<a class="headerlink" href="#keywords" title="Permalink to this headline">¶</a></h2>
<p>keywords=[“frequency-domain”, “Pangeo”, “spectral analysis”, “rechunking”, “cloud computing”]</p>
</div>
<div class="section" id="citation">
<h2>Citation<a class="headerlink" href="#citation" title="Permalink to this headline">¶</a></h2>
<p>Martin and Abernathey 2021. Frequency-Domain Analysis of Large Datasets. Accessed at <a class="reference external" href="https://github.com/paigem/EC2021_Martin_and_Abernathey">https://github.com/paigem/EC2021_Martin_and_Abernathey</a>.</p>
</div>
<div class="section" id="acknowledgements">
<h2>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Permalink to this headline">¶</a></h2>
<p>We thank the Pangeo community for developing and maintaining most of the packages used in this notebook. We also acknowledge Pangeo Cloud, which provides the computing power for this analysis.</p>
</div>
</div>
<div class="section" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<div class="section" id="library-import">
<h2>Library import<a class="headerlink" href="#library-import" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reading in data</span>
<span class="kn">import</span> <span class="nn">intake</span>
<span class="kn">import</span> <span class="nn">gcsfs</span>
<span class="kn">import</span> <span class="nn">zarr</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Data manipulation</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">dask.array</span> <span class="k">as</span> <span class="nn">dsa</span>
<span class="kn">from</span> <span class="nn">rechunker</span> <span class="kn">import</span> <span class="n">rechunk</span>
<span class="kn">import</span> <span class="nn">xrft</span>

<span class="c1"># Distributed computing</span>
<span class="kn">from</span> <span class="nn">dask_gateway</span> <span class="kn">import</span> <span class="n">Gateway</span>
<span class="kn">from</span> <span class="nn">dask.distributed</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="c1"># Visualization</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="data-import-processing-and-analysis">
<h1>Data import, processing, and analysis<a class="headerlink" href="#data-import-processing-and-analysis" title="Permalink to this headline">¶</a></h1>
<div class="section" id="step-1-open-and-rechunk-the-original-data">
<h2>Step 1: Open and rechunk the original data<a class="headerlink" href="#step-1-open-and-rechunk-the-original-data" title="Permalink to this headline">¶</a></h2>
<p>This dataset is stored on the <a class="reference external" href="https://catalog.pangeo.io/">Pangeo Cloud</a> and contains daily output for 41 model years.</p>
<div class="section" id="access-the-data">
<h3>Access the data<a class="headerlink" href="#access-the-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Access CESM POP2 control output from Pangeo Cloud data catalog</span>
<span class="n">cat</span> <span class="o">=</span> <span class="n">intake</span><span class="o">.</span><span class="n">open_catalog</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/pangeo-data/pangeo-datastore/master/intake-catalogs/ocean/CESM_POP.yaml&quot;</span><span class="p">)</span>
<span class="n">item</span> <span class="o">=</span> <span class="n">cat</span><span class="p">[</span><span class="s1">&#39;CESM_POP_hires_control&#39;</span><span class="p">]</span>  <span class="c1"># Specify CESM high resolution control run</span>
<span class="n">ds_orig</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">to_dask</span><span class="p">()</span><span class="o">.</span><span class="n">reset_coords</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># drop unneeded coordinates for efficiency</span>
<span class="n">ds_orig</span>
</pre></div>
</div>
</div>
</div>
<p>We are interested in working with SST.
Let’s make a quick plot to see what the data look like.
Pre-coarsening makes the plot faster to load.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_orig</span><span class="o">.</span><span class="n">SST</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coarsen</span><span class="p">(</span><span class="n">nlat</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">nlon</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SST snapshot ($^{\circ}$C)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Note the chunk structure of the original data: contiguous in the spatial dimension and chunked in the time dimension.
This is not optimal for frequency-domain spectral analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_orig</span><span class="o">.</span><span class="n">SST</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="rechunk-the-data">
<h2>Rechunk the data<a class="headerlink" href="#rechunk-the-data" title="Permalink to this headline">¶</a></h2>
<p>Rechunker allows us to transform the chunk structure of the dataset using Dask distributed computing in order to facilitate time-domain analysis of the dataset.
Since we are only interested in specific variables, we rechunk a single variable (in this case SST) at a time.</p>
<div class="alert alert-info">
<p><strong>Note:</strong>
Rechunking requires the ability to write hundreds of GB to cloud storage.
If you are running this notebook in a binder, your environment has read access to Google Cloud Storage, but not write access.
(Providing anonymous write access would be a major security threat.)
Therefore, below we display the code needed for rechunking in a markdown cell, rather than an executable cell.
Instead, in Step 2 below we point to a rechunked dataset that has previously been written and then continue with the Fourier transform steps.</p>
</div>
<p>Users running on Pangeo Cloud should be able to run this code with no changes, since credentials are automatically populated.
Users who have their own Google Cloud account could modify this code by providing valid credentials and a path to their own storage buckets.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Open data as Zarr group</span>
<span class="n">gcs</span> <span class="o">=</span> <span class="n">gcsfs</span><span class="o">.</span><span class="n">GCSFileSystem</span><span class="p">(</span><span class="n">requester_pays</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Connect to Google Cloud Storage (GCS)</span>
<span class="n">mapper</span> <span class="o">=</span> <span class="n">gcs</span><span class="o">.</span><span class="n">get_mapper</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">urlpath</span><span class="p">)</span> <span class="c1"># gcs.get_mapper() is like getting the pathname of the data on GCS</span>
<span class="n">zgroup</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open_consolidated</span><span class="p">(</span><span class="n">mapper</span><span class="p">)</span> <span class="c1"># Open the dataset in Zarr format</span>

<span class="c1"># Select SST variable</span>
<span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;SST&#39;</span> <span class="c1"># name of variable you wish to rechunk (SST in this case)</span>
<span class="n">array</span> <span class="o">=</span> <span class="n">zgroup</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span> <span class="c1"># select only the SST variable from the Zarr group</span>

<span class="c1"># Write intermediary data to a temporary path. Items stored here get deleted every 7 days.</span>
<span class="n">scratch_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PANGEO_SCRATCH&#39;</span><span class="p">]</span>

<span class="c1"># Define options needed by the `rechunk()` function of `rechunker`.</span>
<span class="n">max_mem</span> <span class="o">=</span> <span class="s1">&#39;1GB&#39;</span> <span class="c1"># request memory for dask workers</span>
<span class="n">target_chunks</span> <span class="o">=</span> <span class="p">(</span><span class="mi">365</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span> <span class="c1"># chunk in time (5 years) and space</span>

<span class="c1"># Set paths to temporary and target storage locations and set names of output data</span>
<span class="n">tmp_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">scratch_path</span><span class="si">}</span><span class="s1">/CESM_POP_hires_control/</span><span class="si">{</span><span class="n">varname</span><span class="si">}</span><span class="s1">_tmp.zarr&#39;</span>
<span class="n">target_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;paigem-pangeo/CESM_POP_hires_control/</span><span class="si">{</span><span class="n">varname</span><span class="si">}</span><span class="s1">_target.zarr&#39;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Delete arrays of the same name that already exist at those paths</span>
<span class="k">def</span> <span class="nf">clear_targets</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">tmp_path</span><span class="p">,</span><span class="n">target_path</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">gcs</span><span class="o">.</span><span class="n">rm</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;/.zarray&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">pass</span>
<span class="n">clear_targets</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create mappings to temporary and target storage buckets</span>
<span class="n">store_tmp</span> <span class="o">=</span> <span class="n">gcs</span><span class="o">.</span><span class="n">get_mapper</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
<span class="n">store_target</span> <span class="o">=</span> <span class="n">gcs</span><span class="o">.</span><span class="n">get_mapper</span><span class="p">(</span><span class="n">target_path</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Call the `rechunk()` function. Below it shows the type of the source, intermediate, and target data.</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">rechunk</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">target_chunks</span><span class="p">,</span> <span class="n">max_mem</span><span class="p">,</span>
            <span class="n">store_target</span><span class="p">,</span> <span class="n">temp_store</span><span class="o">=</span><span class="n">store_tmp</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="s1">&#39;dask&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="set-up-dask-cluster">
<h3>(Set up Dask cluster)<a class="headerlink" href="#set-up-dask-cluster" title="Permalink to this headline">¶</a></h3>
<p>Note that to successfully run <code class="docutils literal notranslate"><span class="pre">rechunk()</span></code> it is necessary to spin up a Dask cluster. To see how we do so on Pangeo Cloud using Dask Gateway, see the following section on computing the power spectrum.</p>
<div class="section" id="execute-the-rechunk-function">
<h4>Execute the <code class="docutils literal notranslate"><span class="pre">rechunk()</span></code> function<a class="headerlink" href="#execute-the-rechunk-function" title="Permalink to this headline">¶</a></h4>
<p>Executing this function will perform the rechunking and save the rechunked SST as intermediate data in the storage bucket designated by <code class="docutils literal notranslate"><span class="pre">target_path</span></code> defined above.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">r</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">retries</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># `retries=10` sets the number of times a Dask worker will retry if computing fails (default is 0)</span>
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="step-2-compute-the-power-spectrum-of-sst">
<h2>Step 2: Compute the power spectrum of SST<a class="headerlink" href="#step-2-compute-the-power-spectrum-of-sst" title="Permalink to this headline">¶</a></h2>
<p>The power spectrum is defined as follows, where a hat denotes a Fourier transform and the star denotes a complex conjugate.</p>
<div class="math notranslate nohighlight">
\[
\widehat{SST}^* \widehat{SST}
\]</div>
<p>Here we read in a previously rechunked SST field, which was obtained by following the same steps as shown above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read previously rechunked data from my GCS storage bucket</span>
<span class="n">gcs</span> <span class="o">=</span> <span class="n">gcsfs</span><span class="o">.</span><span class="n">GCSFileSystem</span><span class="p">(</span><span class="n">requester_pays</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;SST&#39;</span> 
<span class="n">target_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;pangeo-paigem/CESM_POP_hires_control/</span><span class="si">{</span><span class="n">varname</span><span class="si">}</span><span class="s1">_target.zarr&#39;</span>
<span class="n">T_rechunked</span> <span class="o">=</span> <span class="n">dsa</span><span class="o">.</span><span class="n">from_zarr</span><span class="p">(</span><span class="n">gcs</span><span class="o">.</span><span class="n">get_mapper</span><span class="p">(</span><span class="n">target_path</span><span class="p">))</span> <span class="c1"># load as dask file</span>
<span class="n">T_rechunked</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="work-with-a-10-year-subset-of-the-rechunked-data">
<h3>Work with a 10-year subset of the rechunked data<a class="headerlink" href="#work-with-a-10-year-subset-of-the-rechunked-data" title="Permalink to this headline">¶</a></h3>
<p>Though we only show the workflow for one 10-year subset below, when running this workflow for scientific output we compute the power spectrum across several (in this case 10-year) windows. By averaging over all windows in our final plots, we are able to smooth out the naturally noisy Fourier Transform while also getting better statistics.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create 10-year subset over first 10 years of output</span>
<span class="n">yr1</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">yr2</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">T_rechunked</span> <span class="o">=</span> <span class="n">T_rechunked</span><span class="p">[</span><span class="mi">365</span><span class="o">*</span><span class="n">yr1</span><span class="p">:</span><span class="mi">365</span><span class="o">*</span><span class="n">yr2</span><span class="p">,:,:]</span>

<span class="c1"># Convert from dask to xarray DataArray</span>
<span class="n">Txr_rechunked</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">T_rechunked</span><span class="p">,</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;nlat&#39;</span><span class="p">,</span><span class="s1">&#39;nlon&#39;</span><span class="p">])</span>
<span class="n">Txr_rechunked</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="define-function-to-take-power-spectrum">
<h3>Define function to take power spectrum<a class="headerlink" href="#define-function-to-take-power-spectrum" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">take_power_spectrum</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">real_arg</span><span class="p">):</span>
    
    <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">})</span> <span class="c1"># there can be no chunking in the time dimension</span>
    <span class="n">var_filled</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># fill NaNs with zeros</span>
    
    <span class="c1"># Take power spectrum in the time domain, setting time to be a real dimension, with both a linear detrend and a windowing function</span>
    <span class="n">var_hat</span> <span class="o">=</span> <span class="n">xrft</span><span class="o">.</span><span class="n">power_spectrum</span><span class="p">(</span><span class="n">var_filled</span><span class="p">,</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">real</span><span class="o">=</span><span class="n">real_arg</span><span class="p">,</span><span class="n">detrend</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span><span class="n">window</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">var_hat</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="compute-the-power-spectrum-of-sst">
<h3>Compute the power spectrum of SST<a class="headerlink" href="#compute-the-power-spectrum-of-sst" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Call the</span>
<span class="n">T_calc_power_spectrum</span> <span class="o">=</span> <span class="n">take_power_spectrum</span><span class="p">(</span><span class="n">Txr_rechunked</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

<span class="c1"># Take only the real output, and immediately coarsen to 0.5 degree grid to reduce the memory usage</span>
<span class="n">T_power_spectrum</span> <span class="o">=</span> <span class="n">T_power_spectrum</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">coarsen</span><span class="p">(</span><span class="n">nlat</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">nlon</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">T_power_spectrum</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="load-some-results">
<h3>Load Some Results<a class="headerlink" href="#load-some-results" title="Permalink to this headline">¶</a></h3>
<p>So far, all of our calculations have been “lazy”.
No computation has actually happened yet.
In order to load some data, we will subset the data to a size that can fit into our notebook’s memory.
We select a region in the North Atlantic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">region</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">nlat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">290</span><span class="p">,</span> <span class="mi">380</span><span class="p">),</span> <span class="n">nlon</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">220</span><span class="p">))</span>
<span class="n">T_power_spectrum_NAtl</span> <span class="o">=</span> <span class="n">T_power_spectrum</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="o">**</span><span class="n">region</span><span class="p">)</span>
<span class="n">T_power_spectrum_NAtl</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="start-dask-cluster">
<h4>Start Dask cluster<a class="headerlink" href="#start-dask-cluster" title="Permalink to this headline">¶</a></h4>
<p>Now that we are ready to compute, we will start a Dask cluster.
If running this notebook on Pangeo binder, this Dask cluster will spin up on Pangeo’s Cloud allocation.
We use Dask Gateway here (as opposed to, e.g., Dask Kubernetes), as Dask Gateway provides flexibility with cluster scaling, and is the Dask library installed in the Pangeo Cloud infrastructure.
This notebook can also be run with other Dask configurations.
This Dask cluster sets each worker to use 8 GB of memory, and allows for up to 20 workers to spin up (using adaptive scaling).
Note that this may take several minutes to spin up - once you see nonzero numbers below, you are ready to continue.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dask_gateway</span> <span class="kn">import</span> <span class="n">Gateway</span>
<span class="n">gateway</span> <span class="o">=</span> <span class="n">Gateway</span><span class="p">()</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">cluster_options</span><span class="p">()</span>
<span class="n">options</span><span class="o">.</span><span class="n">worker_memory</span> <span class="o">=</span> <span class="mi">8</span> <span class="c1"># assign each worker 8 GB of memory</span>
<span class="n">cluster</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">new_cluster</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
<span class="n">cluster</span><span class="o">.</span><span class="n">adapt</span><span class="p">(</span><span class="n">minimum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="c1"># use adaptive scaling to allow up to 20 workers</span>
<span class="n">cluster</span> <span class="c1"># print out cluster information - you can use this to view when the cluster spins up</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start the client</span>
<span class="kn">from</span> <span class="nn">dask.distributed</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
<span class="n">client</span> <span class="c1"># the link below can be used to access the Dask dashboard</span>
</pre></div>
</div>
</div>
</div>
<p>Calling <code class="docutils literal notranslate"><span class="pre">load</span></code> triggers the cluster to scale up elastically and finish the computation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T_power_spectrum_NAtl</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Re-mask the data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds_orig</span><span class="o">.</span><span class="n">SST</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">coarsen</span><span class="p">(</span><span class="n">nlon</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">nlat</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.2</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="o">**</span><span class="n">region</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">T_power_spectrum_NAtl</span> <span class="o">=</span> <span class="n">T_power_spectrum_NAtl</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="write-to-zarr">
<h3>Write to Zarr<a class="headerlink" href="#write-to-zarr" title="Permalink to this headline">¶</a></h3>
<p>At this point in our workflow, to do the full globe, we would write out the power spectrum computation back to disk. However, we again include this cell as Markdown only since Binder does not have write access.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set path to save power spectrum</span>
<span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;paigem-pangeo/CESM_POP_hires_control/SST_power_spectrum_yr</span><span class="si">{</span><span class="n">yr1</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">yr2</span><span class="si">}</span><span class="s1">_earthcube_test.zarr&#39;</span>

<span class="c1"># Save to Zarr</span>
<span class="n">T_power_spectrum_reset</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;SST_power_spectrum&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_zarr</span><span class="p">(</span><span class="n">gcs</span><span class="o">.</span><span class="n">get_mapper</span><span class="p">(</span><span class="n">url</span><span class="p">))</span> <span class="c1"># need to convert xarray DataArray to Dataset first</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="step-3-plot-results">
<h2>Step 3: Plot Results<a class="headerlink" href="#step-3-plot-results" title="Permalink to this headline">¶</a></h2>
<div class="section" id="area-average-power-spectrum">
<h3>Area Average Power Spectrum<a class="headerlink" href="#area-average-power-spectrum" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T_power_spectrum_NAtl</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;nlon&#39;</span><span class="p">,</span> <span class="s1">&#39;nlat&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Power spectrum of SST in North Atlantic region&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="maps-of-different-frequency-band-averages">
<h3>Maps of different frequency band averages<a class="headerlink" href="#maps-of-different-frequency-band-averages" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bands</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&gt; 1 year&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">3650</span><span class="p">),</span> <span class="mi">1</span><span class="o">/</span><span class="mi">400</span><span class="p">),</span>
    <span class="s2">&quot;~ 1 year&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">370</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">360</span><span class="p">),</span>
    <span class="s2">&quot;100 days - 1 year&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">360</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">100</span><span class="p">),</span>
    <span class="s2">&quot;10 days - 100 days&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">10</span><span class="p">),</span>
    <span class="s2">&quot;&lt; 10 days&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">band_slice</span> <span class="ow">in</span> <span class="n">bands</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">T_power_spectrum_NAtl</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">freq_time</span><span class="o">=</span><span class="n">band_slice</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;freq_time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-notebook-py"
        },
        kernelOptions: {
            kernelName: "conda-env-notebook-py",
            path: "./notebooks/ec21_martin_etal"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-notebook-py'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="README.html" title="previous page"><span class="section-number">12. </span>Frequency-domain analysis of large datasets</a>
    <a class='right-next' id="next-link" href="../ec21_mason_etal/README.html" title="next page"><span class="section-number">13. </span>Volcanic activity detection and noise characterization using machine learning</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By EarthCube Office<br/>
        
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>