
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WH_01_Spatio-Temporal_Deep_Analogs_2021 &#8212; EarthCube 2021 Call for Notebooks</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="11. ITS_LIVE Explorer" href="../ec21_lopez_etal/README.html" />
    <link rel="prev" title="10. Machine Learning Guided Weather Analogs" href="README.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      <img src="../../_static/logo.webp" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">EarthCube 2021 Call for Notebooks</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  EarthCube 2021 Call
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../docs/about.html">
   Call for Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   2021 Notebooks
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Notebook Submissions
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_anil_etal/README.html">
   1. Hydrographic Ocean Data Exploration
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_anil_etal/SA_01_Argo_Data_Exploration.html">
     Interactive Jupyter notebook for hydrographic ocean data exploration, retrieval and visualization via the Argovis API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_balwada_etal/README.html">
   2. Interactive Visualization Tools for Ocean Glider Data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_balwada_etal/DB_01_Glider_Viz_Panel.html">
     Glider Viz Panel
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_beckley_etal/README.html">
   3. Programmatic Access to OpenTopography’s Cloud Optimized Geotiff (COG) Global Datasets
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_beckley_etal/OT_01_BulkAccessCOGs.html">
     Programmatic Access to OpenTopography’s Cloud Optimized GeoTIFF (COG) Global Datasets
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_bourgault_etal/README.html">
   4. xclim : Software ecosystem for climate services
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_bourgault_etal/PB_02_xclim_Software_ecosystem_for_climate_services.html">
     xclim: Software ecosystem for climate services
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_cherian_etal/README.html">
   5. cf-xarray-earthcube
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_cherian_etal/DC_01_cf-xarray.html">
     cf-xarray: Scale your analysis across datasets with less data wrangling and more metadata handling
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_cych_etal/readme.html">
   6. Reanalysis of archived paleointensity data using a new statistical method.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_cych_etal/BC_01%20Bias%20Corrected%20Estimation%20of%20Paleointensity.html">
     BC_01 Bias Corrected Estimation of Paleointensity
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_dye_etal/README.html">
   7. Toward autonomous detection of anomalous GNSS data via applied unsupervised artificial intelligence
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_dye_etal/MD_01_TZVOLCANO_Unsupervised_AI_Anomaly_Detection.html">
     Toward autonomous detection of anomalous GNSS data via applied unsupervised artificial intelligence
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_garzon_etal/README.html">
   8. Exploring Research Data Repositories with geoextent.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_garzon_etal/showcase/SG_01_Exploring_Research_Data_Repositories_with_geoextent.html">
     Exploring Research Data Repositories with geoextent
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_gray_etal/README.html">
   9. Leveraging satellite data and pangeo to investigate the role of Gulf Stream frontal dynamics in ocean productivity
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_gray_etal/PG_01_gulf_stream_dynamics_role_in_productivity.html">
     Leveraging satellite data and pangeo to investigate the role of Gulf Stream frontal dynamics in ocean productivity
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="README.html">
   10. Machine Learning Guided Weather Analogs
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     WH_01_Spatio-Temporal_Deep_Analogs_2021
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_lopez_etal/README.html">
   11. ITS_LIVE Explorer
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_lopez_etal/notebooks/itslive-notebook-rendered.html">
     Introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_lopez_etal/notebooks/LL_01_ITS_LIVE_global_glacier_velocity_exploration_and_analysis.html">
     <strong>
      ITS_LIVE
     </strong>
     Global Glacier Velocity Exploration and Analysis
     <a class="anchor" id="chapter_1">
     </a>
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_martin_etal/README.html">
   12. Frequency-domain analysis of large datasets
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_martin_etal/PM_01_Frequency-Domain_Analysis_of_Large_Datasets.html">
     Frequency-Domain Analysis of Large Datasets
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_mason_etal/README.html">
   13. Volcanic Activity Detection
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_mason_etal/MM_01_Volcanic_activity_detection_and_noise_characterization_using_machine_learning.html">
     EC 01 Volcanic activity detection and noise characterization using machine learning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_maussion_etal/README.html">
   14. OGGM-edu EarthCube notebook
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_maussion_etal/FM_01_OGGM-Edu_learn_and_teach_about_glaciers.html">
     OGGM-Edu - Jupyter notebooks to learn and teach about glaciers
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_potnis_etal/README.html">
   15. JP 01 Real Time Alignment and Distribution of Weather Radar Data with Rain Gauge Data for Deep Learn
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_potnis_etal/JP_01_Real_Time_Alignment_and_Distribution_of_Weather_Radar_Data_with_Rain_Gauge_Data_for_Deep_Learning_using_CHORDS.html">
     Real Time Alignment and Distribution of Weather Radar Data with Rain Gauge Data for Deep Learning using CHORDS
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_seijo_etal/README.html">
   16. Notebook: Investigating upper ocean variability during tropical cyclones and seasonal sea ice formation and melting: Argovis APIs exposed to co-locate oceanic and atmospheric datasets
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_seijo_etal/GS_02_Argovis_TropicalCyclones_SeaIce.html">
     Investigating upper ocean variability  during tropical cyclones and seasonal  sea ice formation and melting: Argovis APIs exposed to co-locate oceanic and atmospheric datasets
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_shi_etal/README.html">
   17. Automated Machine Learning for Earth Science via AutoGluon
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_shi_etal/Xingjian_Shi_01_Automated_Machine_Learning_for_Earth_Science_via_AutoGluon.html">
     Automated Machine Learning for Earth Science via AutoGluon
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_uchida_etal/README.html">
   18. QG Eliassen-Palm flux
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
  <label for="toctree-checkbox-18">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_uchida_etal/notebooks/TU_05_Diagnosing-the-Eliassen-Palm-flux-from-a-quasi-geostrophic-double-gyre-ensemble.html">
     Diagnosing the Eliassen-Palm flux from a quasi-geostrophic double gyre ensemble
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_zheng_etal/README.html">
   19. EZ-FeatureTrack
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
  <label for="toctree-checkbox-19">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_zheng_etal/notebooks/WZ_01_mapping_ice_flow_velocity.html">
     Mapping ice flow velocity using an easy and interactive feature tracking workflow
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/notebooks/ec21_hu_etal/WH_01_Spatio-Temporal_Deep_Analogs_2021.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   WH_01_Spatio-Temporal_Deep_Analogs_2021
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#authors">
     Authors
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#purpose">
     Purpose
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#technical-contributions">
     Technical Contributions
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#methodology">
     Methodology
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#analog-ensemble">
       Analog Ensemble
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#deep-analog">
       Deep Analog
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#reverse-analog-as-training">
       Reverse Analog as Training
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data">
     Data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#results">
     Results
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#funding">
     Funding
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#keywords">
     Keywords
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#citation">
     Citation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#acknowledgements">
     Acknowledgements
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#parameter-definitions">
   Parameter Definitions
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-import">
   Data Import
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-analysis">
   Data Analysis
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ensemble-visualization">
     Ensemble Visualization
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#latent-feature-visualization">
     Latent Feature Visualization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary-and-future-work">
   Summary and Future Work
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <h1>Table of Contents<span class="tocSkip"></span></h1>
<div class="toc">
  <ul class="toc-item">
    <li>
      <span><a href="#WH_01_Spatio-Temporal_Deep_Analogs_2021" data-toc-modified-id="Template-Notebook-for-EarthCube---Long-Version-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>Weiming Hu's Notebook for EarthCube 2021: Machine Learning Guided Weather Analogs</a></span>
      <ul class="toc-item">
        <li><span><a href="#Authors" data-toc-modified-id="Author(s)-1.1"><span class="toc-item-num">1.1&nbsp;&nbsp;</span>Authors</a></span></li>
        <li><span><a href="#Purpose" data-toc-modified-id="Purpose-1.2"><span class="toc-item-num">1.2&nbsp;&nbsp;</span>Purpose</a></span></li>
        <li><span><a href="#Technical-Contributions" data-toc-modified-id="Technical-contributions-1.3"><span class="toc-item-num">1.3&nbsp;&nbsp;</span>Technical Contributions</a></span></li>
        <li><span><a href="#Methodology" data-toc-modified-id="Methodology-1.4"><span class="toc-item-num">1.4&nbsp;&nbsp;</span>Methodology</a></span></li>
        <li><span><a href="#Data" data-toc-modified-id="Data-1.45"><span class="toc-item-num">1.5&nbsp;&nbsp;</span>Data</a></span></li>
        <li><span><a href="#Results" data-toc-modified-id="Results-1.5"><span class="toc-item-num">1.5&nbsp;&nbsp;</span>Results</a></span></li>
        <li><span><a href="#Funding" data-toc-modified-id="Funding-1.6"><span class="toc-item-num">1.6&nbsp;&nbsp;</span>Funding</a></span></li>
        <li><span><a href="#Keywords" data-toc-modified-id="Keywords-1.7"><span class="toc-item-num">1.7&nbsp;&nbsp;</span>Keywords</a></span></li>
        <li><span><a href="#Citation" data-toc-modified-id="Citation-1.8"><span class="toc-item-num">1.8&nbsp;&nbsp;</span>Citation</a></span></li>
        <li><span><a href="#Acknowledgements" data-toc-modified-id="Acknowledgements-1.11"><span class="toc-item-num">1.11&nbsp;&nbsp;</span>Acknowledgements</a></span></li>
      </ul>
    </li>
    <li>
      <span><a href="#Setup" data-toc-modified-id="Setup-2"><span class="toc-item-num">2&nbsp;&nbsp;</span>Setup</a></span>
    </li>
    <li><span><a href="#Parameter-Definitions" data-toc-modified-id="Parameter-definitions-3"><span class="toc-item-num">3&nbsp;&nbsp;</span>Parameter Definitions</a></span></li>
    <li><span><a href="#Data-Import" data-toc-modified-id="Data-import-4"><span class="toc-item-num">4&nbsp;&nbsp;</span>Data Import</a></span></li>
    <li>
      <span><a href="#Data-Analysis" data-toc-modified-id="Data-processing-and-analysis-5"><span class="toc-item-num">5&nbsp;&nbsp;</span>Data Analysis</a></span>
      <ul class="toc-item">
        <li><span><a href="#Ensemble-Visualization" data-toc-modified-id="The-10-rules-5.1"><span class="toc-item-num">5.1&nbsp;&nbsp;</span>Ensemble Visualization</a></span></li>
        <li><span><a href="#Latent-Feature-Visualization" data-toc-modified-id="The-10-rules-5.2"><span class="toc-item-num">5.1&nbsp;&nbsp;</span>Latent Feature Visualization</a></span></li>
      </ul>
    </li>
    <li><span><a href="#Summary-and-Future-Work" data-toc-modified-id="Summary-6"><span class="toc-item-num">6&nbsp;&nbsp;</span>Summary and Future Work</a></span></li>
    <li><span><a href="#References" data-toc-modified-id="References-7"><span class="toc-item-num">7&nbsp;&nbsp;</span>References</a></span></li>
  </ul>
</div>
<div class="section" id="wh-01-spatio-temporal-deep-analogs-2021">
<h1>WH_01_Spatio-Temporal_Deep_Analogs_2021<a class="headerlink" href="#wh-01-spatio-temporal-deep-analogs-2021" title="Permalink to this headline">¶</a></h1>
<div class="section" id="authors">
<h2>Authors<a class="headerlink" href="#authors" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Author1 = {“name”: “Weiming Hu”, “affiliation”: “Department of Geography, The Pennsylvania State University”, “email”: “<a class="reference external" href="mailto:weiming&#37;&#52;&#48;psu&#46;edu">weiming<span>&#64;</span>psu<span>&#46;</span>edu</a>”, “orcid”: “0000-0003-4501-1435”}</p></li>
<li><p>Author2 = {“name”: “Guido Cervone”, “affiliation”: “Department of Geography, The Pennsylvania State University”, “email”: “<a class="reference external" href="mailto:cervone&#37;&#52;&#48;psu&#46;edu">cervone<span>&#64;</span>psu<span>&#46;</span>edu</a>”}</p></li>
<li><p>Author3 = {“name”: “George S. Young”, “affiliation”: “Department of Meteorology and Atmospheric Science, The Pennsylvania State University”, “email”: “<a class="reference external" href="mailto:g3y&#37;&#52;&#48;psu&#46;edu">g3y<span>&#64;</span>psu<span>&#46;</span>edu</a>”}</p></li>
<li><p>Author4 = {“name”: “Luca Delle Monache”, “affiliation”: “Scripps Institution of Oceanography, University of California, San Diego”, “email”: “<a class="reference external" href="mailto:ldellemonache&#37;&#52;&#48;ucsd&#46;edu">ldellemonache<span>&#64;</span>ucsd<span>&#46;</span>edu</a>”}</p></li>
</ul>
</div>
<div class="section" id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<p>This notebook presents the <strong>Spatio-Temporal Deep Analog</strong>, an <a class="reference external" href="https://weiming-hu.github.io/AnalogsEnsemble/">Analog Ensemble</a> (AnEn) technique with Machine Learning powered weather similarity metric.</p>
<p>It, for the first time, integrates Machine Learning techniques with the Analog Ensemble technique. While the Analog Ensemble uses a multivariate distance function to define weather similarity, it has several limitation regarding weight optimization and model updates in the search history. This notebook showcases how a neural network can be trained and used as a powerful weather similarity metric that leads to an increased flexibility and an improved accuracy compared to the original weather similarity.</p>
<p>This work has been inspired by the recent progress in Computer Vision, especially in face recognition and identification like the <a class="reference external" href="https://www.cv-foundation.org/openaccess/content_cvpr_2015/html/Schroff_FaceNet_A_Unified_2015_CVPR_paper.html">FaceNet</a> from Google.</p>
</div>
<div class="section" id="technical-contributions">
<h2>Technical Contributions<a class="headerlink" href="#technical-contributions" title="Permalink to this headline">¶</a></h2>
<p>The development of Deep Analog (DA) spans across multiple years of research and several projects. A summary of the technical contributions is provided below:</p>
<ol class="simple">
<li><p><a class="reference external" href="https://weiming-hu.github.io/AnalogsEnsemble">Parallel Analog Ensemble</a>: This open-source project aims to make the generation of weather analogs faster and easier. It is implemented in C++ and it provides documented interface for development.</p></li>
<li><p><a class="reference external" href="https://weiming-hu.github.io/AnalogsEnsemble/R/">RAnEn</a>: The R package is implemented on top of the PAnEn. This package is mainly developed for researchers familiar with R and who want to quickly prototype a research idea.</p></li>
<li><p><a class="reference external" href="https://github.com/Weiming-Hu/PyAnEn">PyAnEn</a>: The Python package is developed mainly for post processing predictions generated from the PAnEn. It aims at providing the functionality to analyze and verify large weather prediction data on supercomputers utilizing distributed computing and parallel processing.</p></li>
<li><p><a class="reference external" href="https://github.com/Weiming-Hu/DeepAnalogs">Deep Analog</a>: The Python package is developed for building and training a neural network to be used as the weather similarity metric with the PAnEn.</p></li>
</ol>
</div>
<div class="section" id="methodology">
<h2>Methodology<a class="headerlink" href="#methodology" title="Permalink to this headline">¶</a></h2>
<div class="section" id="analog-ensemble">
<h3>Analog Ensemble<a class="headerlink" href="#analog-ensemble" title="Permalink to this headline">¶</a></h3>
<p>Analog Ensemble is a technique to generate ensemble forecasts from a single run of deterministic weather model and the corresponding historical observations. It has several major advantages:</p>
<ol class="simple">
<li><p><strong>Computation</strong>: Only a single run of a deterministic model is needed to generate ensembles.</p></li>
<li><p><strong>Uncertainty Quantification</strong>: The spread of the generated ensemble is well correlated with the prediction accuracy, providing a good estimate of forecast uncertainty.</p></li>
<li><p><strong>Decoupled Prediction</strong>: The AnEn can be extended to predict variables that are not directly modeled by weather models, as long as an observation history is obtained, e.g., the power generation from a solar farm.</p></li>
</ol>
<p>It is assumed that, given a static weather model, similar forecasts are associated with similar errors. Therefore, by using the associated historical observations for the most similar forecasts, the error of the target forecast can be effectively corrected. The key issue is how we can identify good-quality weather analogs.</p>
<p>The core to Analog Ensemble is a weather similarity metric:</p>
<p><span class="math notranslate nohighlight">\(\left \| F_{t},A_{{t}'} \right \| = \sum_{i=1}^{N_{v}} {\frac{\omega_{i}}{\sigma_{f_{i}}} \sqrt{\sum_{j = -\tilde{t}}^{\tilde{t}} {\left ( F_{i,t+j}-A_{i,{t}'+j} \right )^{2}}}}\)</span>,</p>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(F_{t}\)</span> is the model prediction valid at the weather model initialization time stamp <span class="math notranslate nohighlight">\(t\)</span> at a specific location and lead time.</p></li>
<li><p><span class="math notranslate nohighlight">\(A_{{t}'}\)</span> is the historical repository of the weather model from the search space at the same location and lead time, but with a different model initialization time <span class="math notranslate nohighlight">\({t}'\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(N_{v}\)</span> is the number of physical variables used during forecast similarity calculation.</p></li>
<li><p><span class="math notranslate nohighlight">\(\omega_{i}\)</span> is the weight for each physical variable which suggests the relevant importance of the physical variable with respect to the others.</p></li>
<li><p><span class="math notranslate nohighlight">\(\sigma_{f_{i}}\)</span> is the standard deviation for the physical variable <span class="math notranslate nohighlight">\(i\)</span> calculated from the historical forecasts at the same location and Forecast Lead Time (FLT).</p></li>
<li><p><span class="math notranslate nohighlight">\(\tilde{t}\)</span> equals to half of the time window size of the FLTs to be compared so that weather analogs are identified within a very small time window.</p></li>
<li><p><span class="math notranslate nohighlight">\(F_{i,t+j}\)</span> is the value of the current forecast for the physical variable <span class="math notranslate nohighlight">\(i\)</span> at the valid time <span class="math notranslate nohighlight">\(t+j\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(A_{i,{t}'+j}\)</span> is the value of the historical forecast for the physical variable <span class="math notranslate nohighlight">\(i\)</span> at the valid time <span class="math notranslate nohighlight">\({t}'+j\)</span>.</p></li>
</ul>
<img src="figures/AnEn-schema.png" alt="AnEn Schema" style="width: 600px;"/>
<p>The above sketch provides a pictorial representation of generating a four-member forecast ensemble.</p>
<ul class="simple">
<li><p>The top arrow represents an operational run of a deterministic weather model with the grey shaded area representing the history.</p></li>
<li><p>The bottom arrow represents the historical observations of the variable of prediction, associated with the model. For example, the bottom arrow would represents surface temperature records if the predictand is temperature. Since it is the historical archive of observations, it only overlaps with the grey shaded area from the first arrow.</p></li>
</ul>
<p>Generating a four-member ensemble with the AnEn consists of four steps:</p>
<ol class="simple">
<li><p>A multi-variate target forecast is retrieved from the deterministic model.</p></li>
<li><p>The similarity measure is calculated between the target forecast and each of the historical forecasts based on the weather similarity metric. Four candidate forecasts with the highest similarity (the lowest distances) are identified as weather analogs to the target forecasts.</p></li>
<li><p>Observations associated with the four candidate forecasts are retrieved.</p></li>
<li><p>The historical observations become forecast ensemble members in the final analog ensemble.</p></li>
</ol>
<p>However, as many scientific toolbox, Analog Ensemble has its own challenges and limitation:</p>
<ol class="simple">
<li><p><strong>Grid-to-Grid Comparison</strong>: Weather similarity is defined on a single grid basis, meaning that forecasts are compared independently at each grid. It limits the weather analogs from detecting spatial patterns.</p></li>
<li><p><strong>Model Updates</strong>: An important assumption of the Analog Ensemble is that similar weather forecasts have similar forecast errors. Thus, using the observations can effectively correct for this error. However, operational models are constantly changing and upgrading. Model behaviors are subject to changes across time which could negatively affect the correction.</p></li>
<li><p><strong>Weight Optimization</strong>: Predictor weights, <span class="math notranslate nohighlight">\(\omega_{i}\)</span>, needs to be determined as priori. This is usually done via extensive grid search which is computational expensive and error-prone. It also limits the number of predictors used from the weather model to only a few while, in practice, many more variables are modeled by weather models.</p></li>
</ol>
</div>
<div class="section" id="deep-analog">
<h3>Deep Analog<a class="headerlink" href="#deep-analog" title="Permalink to this headline">¶</a></h3>
<p>To address the above challenges, we propose a renovated weather similarity metric by using Machine Learning, specifically a Convolutional Long Short-Term Memory neural network as the weather similarity metric.</p>
<img src="figures/DA_Structure.png" alt="ConvLSTM" style="width: 1200px;"/><p>The above figure shows the structure of a particular embedding network designed for <a class="reference external" href="https://www.ncdc.noaa.gov/data-access/model-data/model-datasets/north-american-mesoscale-forecast-system-nam">WRF NAM NMM</a>.</p>
<ul class="simple">
<li><p>The input is a four-dimensional data structure with [height x width x variables x Time window]. The color coded image is an example of the solar irradiance field from the weather model.</p></li>
<li><p>The embedding model has two convolutional layers and one convolutional LSTM layer, each one followed by a max-pooling layer.</p></li>
<li><p>The output of the embedding network is a one-dimensional vector with a length of 120 values, referred to as the latent features or the hidden features.</p></li>
</ul>
<p>The embedding network is applied to the entire forecast dataset to transform all forecast variables into a latent space, specifically a 120-dimensional latent space. Finally, forecast clusters, calculated based on the Euclidean distance, identified in the latent space is treated as weather analogs.</p>
</div>
<div class="section" id="reverse-analog-as-training">
<h3>Reverse Analog as Training<a class="headerlink" href="#reverse-analog-as-training" title="Permalink to this headline">¶</a></h3>
<img src="figures/ReverseAnalogs.png" alt="Reverse Analog" style="width: 700px;"/>
<p>How do we train an effective Machine Learning similarity metric?</p>
<p>We propose the Reverse Analog procedure in order to train an effective embedding network.</p>
<p>We <strong>ARE NOT</strong>:</p>
<ol class="simple">
<li><p>training a neural network that directly predict a variable of interest;</p></li>
<li><p>training a compression neural network that only seeks to compress the original forecasts with fewer variables.</p></li>
</ol>
<p>Instead, we <strong>ARE</strong>:</p>
<ol class="simple">
<li><p>training a neural network that transform the forecasts into a latent space so that analogs can be more effectively found with better accuracy;</p></li>
<li><p>training a neural network that learns a relationship between a spatial forecasts and the corresponding observations;</p></li>
<li><p>training a neural network that, by looking at the forecasts, it learns whether the observations are actually similar.</p></li>
</ol>
<p>The training process is illustrated below:</p>
<ol class="simple">
<li><p>Given an observation, e.g., the observed solar irradiance, from a target date, find the historical dates that have the most similar observations.</p></li>
<li><p>The associated forecasts on those most similar dates are queried.</p></li>
<li><p>The network is trained to produce a latent space that places similar forecasts closer to each other, dissimilar forecasts further away from each other. Specifically, the blue pairs are more similar than the grey pairs.</p></li>
</ol>
<p>The core idea is that, the neural network is trained with <strong>both forecasts and observations</strong> in order to generate effective embeddings.</p>
</div>
</div>
<div class="section" id="data">
<h2>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h2>
<p>A summmar of the research data is provided below:</p>
<ul class="simple">
<li><p><strong>Weather Model</strong>: <a class="reference external" href="https://www.ncdc.noaa.gov/data-access/model-data/model-datasets/global-forcast-system-gfs">GFS</a> with 3 different resolutions, 1°, 0.50°, and 0.25°, and <a class="reference external" href="https://www.ncdc.noaa.gov/data-access/model-data/model-datasets/north-american-mesoscale-forecast-system-nam">WRF NAM NMM</a> with 12 km resolution. Results from WRF NAM NMM is the focus of this notebook.</p></li>
<li><p><strong>Observation</strong>: Solar irradiance reaching the surface. Observations are collectecd from the <a class="reference external" href="https://www.ncei.noaa.gov/access/metadata/landing-page/bin/iso?id=gov.noaa.ncdc:C00540">Surface Radiation Budget Network</a>.</p></li>
<li><p><strong>Geographic Location</strong>: Center Pensylvania</p></li>
<li><p><strong>Prediction Period</strong>: 2018/01/01 to 2019/10/31</p></li>
<li><p><strong>Search Period</strong>: 2015/01/01 to 2017/12/31</p></li>
</ul>
</div>
<div class="section" id="results">
<h2>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h2>
<img src="figures/SingleStation_MAE_Bias_CRPS.png" alt="ConvLSTM" style="width: 700px;"/><p>The above figure shows the prediction error of solar irradiance from various configurations of Analog Ensemble and weather models. Specifically,</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">NWP</span></code> stands for Numerical Weather Prediction, namely the uncalibrated prediction from the numerical weather prediction model.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AnEn</span> <span class="pre">Spatial</span></code> stands for the Analog Ensemble with nearby forecasts as additional predictors.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AnEn</span></code> stands for the conventional Analog Ensemble with forecasts on a single grid.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DA</span> <span class="pre">IS</span></code> stands for the Deep Analog with no convolutional layers (spatial information) and trained on forecasts from only one grid.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DA</span> <span class="pre">SSE</span></code> stands for the Deep Analog with no convolutional layers (spatial information) and trained on forecasts from nearby grids.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DA</span> <span class="pre">Spatial</span></code> stands for the Deep Analog with convolutional layers (spatial information).</p></li>
</ul>
<p>The verification metrics include Mean Absolute Error (MAE), Bias, and Continuous Ranked Probability Score (CRPS). CRPS can be understood as the ensemble version of Root-Mean-Square Error (RMSE). It is calculated using the package <a class="reference external" href="https://pypi.org/project/properscoring/">properscoring</a>.</p>
<p>Several key observations:</p>
<ol class="simple">
<li><p>AnEn and its variants all outperforms the baseline forecasts demonstrating its capability in correcting weather models.</p></li>
<li><p>Comparing <code class="docutils literal notranslate"><span class="pre">AnEn</span> <span class="pre">Spatial</span></code> and <code class="docutils literal notranslate"><span class="pre">AnEn</span></code>, it suggests that simply using forecasts from nearby locations as additional predictors is not an effective way of exploiting spatial information.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DA</span> <span class="pre">Spatial</span></code> outperforms <code class="docutils literal notranslate"><span class="pre">AnEn</span></code> demonstrating the added capability to correct weather forecasts with a Machine Learning simialrity metric.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DA</span> <span class="pre">Spatial</span></code> outperforms other variants of DA, suggesting the convolutional layers are essential to extract spatial information.</p></li>
</ol>
<img src="figures/MultiStation_NAM_NMM.png" alt="ConvLSTM" style="width: 900px;"/><p>The above figures visualize the spatial error when searching nearby forecasts. The question they try to address is, can you find better analogs with nearby points. By applying a spatial mask. <code class="docutils literal notranslate"><span class="pre">DA</span> <span class="pre">Spatial</span> <span class="pre">shows</span></code> a much smoother error surface when nearby forecasts are compared. In the other cases, forecasts are compared on a single grid, therefore the error surface is more disjointed. The red <code class="docutils literal notranslate"><span class="pre">x</span></code> indicates the best search grid, meaning that if you compare the analog selected across all the grids in the domain, they will be the best grids to search.</p>
<p>Specifically,</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">AnEn</span></code> and <code class="docutils literal notranslate"><span class="pre">DA</span> <span class="pre">IS</span></code> both do not exploit spatial information. Prediction error drastically increases when forecasts from distant regions are used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DA</span> <span class="pre">SSE</span></code> tries to train an embedding model using data from nearby forecasts, but it is shown that simply adding to the training data without a change in the model architecture is not enough to achieve effective improvement in prediction accuracy.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DA</span> <span class="pre">Spatial</span></code>, by far, shows the best prediction accuracy. The smooth error surface centered at the close vincinity of the location of interest suggest its capability of capturing the spatial features.</p></li>
</ul>
<img src="figures/MAE_vs_Distance.png" alt="ConvLSTM" style="width: 800px;"/><p>The above figure assesses the effectiveness of different similarity metrics when a distant forecasts is used. It is desired to observe a trend that, while the error should increase as the compared forecasts comes from a more distant location, the speed of the increase is low so that the AnEn can benefit from searching nearby locations.</p>
<p>In all four panels of the above figure, <code class="docutils literal notranslate"><span class="pre">DA</span> <span class="pre">Spatial</span></code> (shown in red) always has the lowest prediction error across all bins whereas the alternatives typically show a faster increase of error when nearby forecasts are compared. This is due to the grid-by-grid comparison without any spatial information. As for <code class="docutils literal notranslate"><span class="pre">DA</span> <span class="pre">Spatial</span></code>, the nearby forecasts over a spatial mask still appears largely similar to the target forecast when there is only a small geographic offset. This is similar to the sliding windows at two consecutive steps.</p>
</div>
<div class="section" id="funding">
<h2>Funding<a class="headerlink" href="#funding" title="Permalink to this headline">¶</a></h2>
<p>Include references to awards that supported this research. Add as many award references as you need.</p>
<ul class="simple">
<li><p>Award1 = {“agency”: “US National Science Foundation”, “award_code”: “1639707”, “award_URL”: “<a class="reference external" href="https://www.nsf.gov/awardsearch/showAward?AWD_ID=1639707">https://www.nsf.gov/awardsearch/showAward?AWD_ID=1639707</a>”}</p></li>
<li><p>Award2 = {“agency”: “Department of Geography, The Pennsylvania State University”}</p></li>
</ul>
</div>
<div class="section" id="keywords">
<h2>Keywords<a class="headerlink" href="#keywords" title="Permalink to this headline">¶</a></h2>
<p>keywords=[“Ensemble Forecast”, “Analog Ensemble”, “Machine Learning”, “Renewable Energy”, “Solar Irradiance”]</p>
</div>
<div class="section" id="citation">
<h2>Citation<a class="headerlink" href="#citation" title="Permalink to this headline">¶</a></h2>
<p>Hu, W., Cervone, G., Young, G., Delle Monache, L., 2021. Machine Learning Guided Weather Analogs. Jupyter Notebook. Accessed on 2021/6/11 from <a class="reference external" href="https://github.com/Weiming-Hu/EarthCube2021">https://github.com/Weiming-Hu/EarthCube2021</a></p>
</div>
<div class="section" id="acknowledgements">
<h2>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Permalink to this headline">¶</a></h2>
<p>We thank the support from the <a class="reference external" href="http://radical.rutgers.edu/">RADICAL group</a> at Rutgers Univeristy through their <a class="reference external" href="https://radical-cybertools.github.io/entk/index.html">Ensemble Toolkit</a>, which makes generating analog ensembles on supercomputers possible.</p>
<p>The notebook is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License.</a></p>
</div>
</div>
<div class="section" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<p><strong>Only run the following cell if you are on Binder!</strong></p>
<p>Some packages are not properly set up on Binder. Therefore, I need to manually fix them. The following cell only needs to be run <strong>once</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
pip uninstall pillow -y
pip install pillow
</pre></div>
</div>
</div>
</div>
<p>The following libraries are needed to run the cells. Please see comments for their purposes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Numpy is a very common package for handling high-dimensional data structure.</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Pandas is a very common package for dealing with tables.</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># PyAnEn is the package to help reading analog results.</span>
<span class="kn">import</span> <span class="nn">PyAnEn.IO</span> <span class="k">as</span> <span class="nn">AnEnIO</span>

<span class="c1"># The script provides mostly visualization functions.</span>
<span class="kn">from</span> <span class="nn">functions</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Autoreload extension. This force the session to reload the package in case of code changes.</span>
<span class="k">if</span> <span class="s1">&#39;autoreload&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">extension_manager</span><span class="o">.</span><span class="n">loaded</span><span class="p">:</span>
    <span class="o">%</span><span class="k">load_ext</span> autoreload
    
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="parameter-definitions">
<h1>Parameter Definitions<a class="headerlink" href="#parameter-definitions" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is the NetCDF file that has DA predictions.</span>
<span class="n">da_file</span> <span class="o">=</span> <span class="s1">&#39;data/DA_Spatial.nc&#39;</span>

<span class="c1"># This is the NetCDF file that has AnEn predictions.</span>
<span class="n">anen_file</span> <span class="o">=</span> <span class="s1">&#39;data/AnEn.nc&#39;</span>

<span class="c1"># This is the NetCDF file that has WRF NAM NMM predictions.</span>
<span class="c1">#</span>
<span class="c1"># There were original 48 parameters. Due to file size limit, only 2 parameters have been kept in the sample data file.</span>
<span class="c1">#</span>
<span class="c1"># They are</span>
<span class="c1">#</span>
<span class="c1"># 1. downward shortwave radiation flux [260087_0_surface_dswrf]</span>
<span class="c1"># 2. total cloud cover [228164_0_atmosphere_tcc].</span>
<span class="c1">#</span>
<span class="n">fcst_file</span> <span class="o">=</span> <span class="s1">&#39;data/NAM_NMM.nc&#39;</span>

<span class="c1"># This is the observations for solar irradiance.</span>
<span class="n">obs_file</span> <span class="o">=</span> <span class="s1">&#39;data/SURFRAD_PennState.nc&#39;</span>

<span class="c1"># This is the latent features for WRF NAM NMM forecasts.</span>
<span class="n">embedding_file</span> <span class="o">=</span> <span class="s1">&#39;data/NAM_NMM_Spatial.nc&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="data-import">
<h1>Data Import<a class="headerlink" href="#data-import" title="Permalink to this headline">¶</a></h1>
<p>The rest of the notebook visualizes already generated analog ensembles. Training the deep network and generating analog ensembles are skipped because of the computational cost. Typically, I used <a class="reference external" href="https://github.com/Weiming-Hu/DeepAnalogs">Deep Analog</a> to train the network and used <a class="reference external" href="https://weiming-hu.github.io/AnalogsEnsemble/">Parallel Analog Ensemble</a> to generate analog ensembles. Please feel free to contact Weiming if you are interested in integrating the methodology to your scientific workflow.</p>
<p>Please run the following cell to download a sample of the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
if test -f &quot;EarthCube2021.tar.gz&quot;; then
    echo &quot;Tarball exists. Skip downloading.&quot;
else
    echo &quot;Downloading data tarball from https://prosecco.geog.psu.edu/EarthCube2021/EarthCube2021.tar.gz ...&quot;
    wget https://prosecco.geog.psu.edu/EarthCube2021/EarthCube2021.tar.gz 1&gt; log 2&gt; log
fi

tar xf EarthCube2021.tar.gz
echo &quot;Done!&quot;
</pre></div>
</div>
</div>
</div>
<p>In the following cell, data are loaded into memory. Please read the comments for detailed explanations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">da_ds</span> <span class="o">=</span> <span class="n">AnEnIO</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">da_file</span><span class="p">,</span> <span class="n">decode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">da_ds</span>
</pre></div>
</div>
</div>
</div>
<p>Internally, <code class="docutils literal notranslate"><span class="pre">PyAnEn.IO</span></code> uses <a class="reference external" href="http://xarray.pydata.org/en/stable/">xarray</a> which is a labeled data structure for NetCDF data. It is very intuitive to use. The above cell prints a description of the loaded data. The most important information shown above is:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">analogs</span></code>: A four-dimensional array for analog predictions generated by Deep Analog. There are 21 ensemble member and 647 test times. There are three lead times, but all our subsequent analysis is only for the second lead time, as an example. There is only one station, which is at the center Pennsylvania.</p></li>
</ul>
<p>Please note the naming convention: the first part, <code class="docutils literal notranslate"><span class="pre">da</span></code> stands for the prediction technqiue, and the second part, <code class="docutils literal notranslate"><span class="pre">ds</span></code> standards for <code class="docutils literal notranslate"><span class="pre">xarray</span></code> dataset.</p>
<p>The following code snippet plots the location of the station as an example to show how one would typically access the data in an <code class="docutils literal notranslate"><span class="pre">xarray</span></code> dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">cartopy</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()})</span>

<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">OCEAN</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">LAKES</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">STATES</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">da_ds</span><span class="p">[</span><span class="s1">&#39;Xs&#39;</span><span class="p">],</span> <span class="n">da_ds</span><span class="p">[</span><span class="s1">&#39;Ys&#39;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SURFRAD&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Similarly, we load the other datasets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This dataset stores analog predictions from AnEn</span>
<span class="n">anen_ds</span> <span class="o">=</span> <span class="n">AnEnIO</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">anen_file</span><span class="p">,</span> <span class="n">decode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># This dataset stores WRF NAM NMM forecasts</span>
<span class="n">fcst_ds</span> <span class="o">=</span> <span class="n">AnEnIO</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">fcst_file</span><span class="p">,</span> <span class="n">decode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># This dataset stores SURFRAD observations</span>
<span class="n">obs_ds</span> <span class="o">=</span> <span class="n">AnEnIO</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">obs_file</span><span class="p">,</span> <span class="n">decode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># This dataset stores the transformed WRF NAM NMM forecasts, namely the 120 latent features generated from DA Spatial</span>
<span class="n">embeddings_ds</span> <span class="o">=</span> <span class="n">AnEnIO</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">embedding_file</span><span class="p">,</span> <span class="n">decode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="s1">&#39;num_stations&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">num_flts</span><span class="o">=</span><span class="mi">3600</span> <span class="o">*</span> <span class="mi">18</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There are </span><span class="si">{}</span><span class="s1"> features in the transformed latest space for WRF NAM NMM.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">embeddings_ds</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="s1">&#39;num_parameters&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<p>These latent features are generated by running each individual forecasts into a trained Deep Analog embedding network.</p>
<p>Since the training of such a network and the generation of the embeddings are very time consuming, the results are simply provided here and we will only be looking at forecasts at 1 PM which typically correspond to the highest solar irradiance throughout the day.</p>
</div>
<div class="section" id="data-analysis">
<h1>Data Analysis<a class="headerlink" href="#data-analysis" title="Permalink to this headline">¶</a></h1>
<div class="section" id="ensemble-visualization">
<h2>Ensemble Visualization<a class="headerlink" href="#ensemble-visualization" title="Permalink to this headline">¶</a></h2>
<p>In this section, we focus on visualizing ensembles generated from <code class="docutils literal notranslate"><span class="pre">AnEn</span></code> and <code class="docutils literal notranslate"><span class="pre">DA</span> <span class="pre">Spatial</span></code>.</p>
<p>Several key differences between <code class="docutils literal notranslate"><span class="pre">AnEn</span></code> and <code class="docutils literal notranslate"><span class="pre">DA</span> <span class="pre">Spatial</span></code> to keep in mind while reading the figures:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">AnEn</span></code> determines similar weather by looking at WRF NAM NMM forecasts at a single grid location.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DA</span> <span class="pre">Spatial</span></code> determines similar weather by looking at WRF NAM NMM forecasts with a spatial domain. The network is also trained with observations so that <code class="docutils literal notranslate"><span class="pre">DA</span> <span class="pre">Spatial</span></code> is designed to learn what the observations would be given a spatial forecasts and trying to cluster forecasts based on the associated observations.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select a date for which the forecast ensemble will be plotted.</span>
<span class="c1">#</span>
<span class="c1"># The date must be between 2018/01/01 and 2019/10/31.</span>
<span class="c1">#</span>
<span class="n">target_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2019/05/05&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If you want to extract the dates of similar weather from AnEn, use this code</span>
<span class="c1"># anen_times = get_analog_forecast_times(anen_ds, time=target_date)[:21]</span>

<span class="c1"># If you want to extract the dates of similar weather from DA Spatial, use this code</span>
<span class="n">anen_times</span> <span class="o">=</span> <span class="n">get_analog_forecast_times</span><span class="p">(</span><span class="n">da_ds</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">target_date</span><span class="p">)[:</span><span class="mi">21</span><span class="p">]</span>

<span class="c1">################################################################################</span>
<span class="c1"># 21 is the number of analog members, namely the number of most similar dates. #</span>
<span class="c1"># It is better not to change this number as it might affect visualization.     #</span>
<span class="c1">################################################################################</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is most similar to the following dates:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">anen_times</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Combine the target date and all the similar dates. The first date is plotted in a slightly bigger panel.</span>
<span class="n">plot_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">target_date</span><span class="p">]),</span> <span class="n">anen_times</span><span class="p">])</span>

<span class="n">plot_analog_forecasts</span><span class="p">(</span><span class="n">obs_ds</span><span class="p">,</span> <span class="n">fcst_ds</span><span class="p">,</span> <span class="n">plot_times</span><span class="p">,</span> <span class="n">obs_ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The above figure shows the following information:</p>
<ul class="simple">
<li><p>Each panel is a WRF NAM NMM forecasts from a particular date labeled at the uppper left of each panel.</p></li>
<li><p>The observed solar irradiance is shown following the date.</p></li>
<li><p>Points are color coded with WRF NAM NMM predictions for solar irradiance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AnEn</span></code> determines weather similarity based on a single grid point from WRF NAM NMM (shown in star). However, <code class="docutils literal notranslate"><span class="pre">DA</span> <span class="pre">Spatial</span></code> determines weather similarity based on a spatial domain and the associated observations.</p></li>
</ul>
</div>
<div class="section" id="latent-feature-visualization">
<h2>Latent Feature Visualization<a class="headerlink" href="#latent-feature-visualization" title="Permalink to this headline">¶</a></h2>
<p>In this section, we visualize the latent features in its relationship with the original forecast variable. We try to see correlation between the learned features and the original weather variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the time range to plot.</span>
<span class="c1"># We are plotting the entire test period.</span>
<span class="c1">#</span>
<span class="n">datetimes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2018/01/01&#39;</span><span class="p">,</span> <span class="s1">&#39;2019/10/31&#39;</span><span class="p">)</span>

<span class="c1"># Some dates are missing from the WRF NAM NMM, so we need to make sure only plot dates that exist.</span>
<span class="n">datetimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dt</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">datetimes</span> <span class="k">if</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">embeddings_ds</span><span class="p">[</span><span class="s1">&#39;Times&#39;</span><span class="p">]])</span>

<span class="c1"># Query the embeddings</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings_ds</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">num_times</span><span class="o">=</span><span class="n">datetimes</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You have extracted embeddings on </span><span class="si">{}</span><span class="s1"> dates.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">embeddings</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Each embedding has </span><span class="si">{}</span><span class="s1"> latent features.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">embeddings</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select which latent feature to use when creating the scatter plot</span>
<span class="n">latent_feature</span> <span class="o">=</span> <span class="mi">115</span>

<span class="c1"># The point index of cluster centers to create in the scatter plot.</span>
<span class="c1"># The visualization function supports three cluster centers.</span>
<span class="c1">#</span>
<span class="n">center1</span> <span class="o">=</span> <span class="mi">170</span>
<span class="n">center2</span> <span class="o">=</span> <span class="mi">190</span>
<span class="n">center3</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># The number of nearest neighbors to visualize</span>
<span class="n">n_nbs</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plot_feature</span><span class="p">(</span><span class="n">latent_feature</span><span class="p">,</span> <span class="n">center1</span><span class="p">,</span> <span class="n">center2</span><span class="p">,</span> <span class="n">center3</span><span class="p">,</span> <span class="n">n_nbs</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">,</span> <span class="n">datetimes</span><span class="p">,</span> <span class="n">fcst_ds</span><span class="p">,</span> <span class="n">obs_ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The above figure shows the following information:</p>
<ul class="simple">
<li><p>The left panel shows the scatter plot of the selected latent feature with respect to the observed solar irradiance. It is a good visual diagnosis of the correlation between a single latent feature and the predictand.</p></li>
<li><p>Each point in the scatter plot represent a embedding WRF NAM NMM forecast on a particular date.</p></li>
<li><p>Three clusters are created based on the scatter plot, controlled by <code class="docutils literal notranslate"><span class="pre">center1</span></code>, <code class="docutils literal notranslate"><span class="pre">center2</span></code>, and <code class="docutils literal notranslate"><span class="pre">center3</span></code>.</p></li>
<li><p>Panels on the right are WRF NAM NMM associated with the clustered points. Please note the corresponding labels in the legend.</p></li>
</ul>
</div>
</div>
<div class="section" id="summary-and-future-work">
<h1>Summary and Future Work<a class="headerlink" href="#summary-and-future-work" title="Permalink to this headline">¶</a></h1>
<p>This notebook has proposed the Deep Analog, a weather similarity metric driven by a Conv-LSTM neural network. Results show that Deep Analog outperforms Analog Ensemble when predicting solar irradiance. The integration of spatial information allows Deep Analog to be associated with a smoother error surface. Weight optimization is also significantly faster while, with Analog Ensemble, weight optimization would be almost impossible for more than a dozen predictors.</p>
<p>We suggest future research should further investigate the efficacy of such a Machine Learning guided technique on other meteorological variables, for example wind. Analog forecasting is also helpful in downscaling climate and reginal models. It would be interesting to study how this architecture can be used for model downscaling.</p>
</div>
<div class="section" id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h1>
<ol class="simple">
<li><p>Delle Monache, Luca, et al. “Probabilistic weather prediction with an analog ensemble.” Monthly Weather Review 141.10 (2013): 3498-3516.</p></li>
<li><p>Hu, Weiming, and Guido Cervone. “Dynamically Optimized Unstructured Grid (DOUG) for Analog Ensemble of numerical weather predictions using evolutionary algorithms.” Computers &amp; Geosciences 133 (2019): 104299.</p></li>
<li><p>Hu, Weiming, et al. “PARALLEL ANALOG ENSEMBLE–THE POWER OF WEATHER ANALOGS.” NCAR Technical Notes NCAR/TN-564+ PROC: 1.</p></li>
<li><p>Schroff, Florian, Dmitry Kalenichenko, and James Philbin. “Facenet: A unified embedding for face recognition and clustering.” Proceedings of the IEEE conference on computer vision and pattern recognition. 2015.</p></li>
<li><p>Shi, Xingjian, et al. “Convolutional LSTM network: A machine learning approach for precipitation nowcasting.” arXiv preprint arXiv:1506.04214 (2015).</p></li>
<li><p>Hu, Weiming, et al. “Weather Analogs with a Machine Learning Similarity Metric for Renewable Resource Forecasting.” arXiv preprint arXiv:2103.04530 (2021).</p></li>
</ol>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "sapphire"
        },
        kernelOptions: {
            kernelName: "sapphire",
            path: "./notebooks/ec21_hu_etal"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'sapphire'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="README.html" title="previous page"><span class="section-number">10. </span>Machine Learning Guided Weather Analogs</a>
    <a class='right-next' id="next-link" href="../ec21_lopez_etal/README.html" title="next page"><span class="section-number">11. </span>ITS_LIVE Explorer</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By EarthCube Office<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>