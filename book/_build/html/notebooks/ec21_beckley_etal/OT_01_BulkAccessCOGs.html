
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Programmatic Access to OpenTopography’s Cloud Optimized GeoTIFF (COG) Global Datasets &#8212; EarthCube 2021 Call for Notebooks</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="xclim : Software ecosystem for climate services" href="../ec21_bourgault_etal/README.html" />
    <link rel="prev" title="Programmatic Access to OpenTopography’s Cloud Optimized Geotiff (COG) Global Datasets" href="README.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      <img src="../../_static/logo.webp" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">EarthCube 2021 Call for Notebooks</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../docs/about.html">
   Call for Notebooks
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Notebooks
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../ec21_anil_etal/README.html">
     ec21_binder_anil
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../ec21_anil_etal/SA_01_Argo_Data_Exploration.html">
       Interactive Jupyter notebook for hydrographic ocean data exploration, retrieval and visualization via the Argovis API
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../ec21_balwada_etal/README.html">
     ec2021_balwada_etal
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../ec21_balwada_etal/DB_01_Glider_Viz_Panel.html">
       Glider Viz Panel
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="README.html">
     Programmatic Access to OpenTopography’s Cloud Optimized Geotiff (COG) Global Datasets
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Programmatic Access to OpenTopography’s Cloud Optimized GeoTIFF (COG) Global Datasets
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../ec21_bourgault_etal/README.html">
     xclim : Software ecosystem for climate services
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../ec21_bourgault_etal/PB_02_xclim_Software_ecosystem_for_climate_services.html">
       xclim: Software ecosystem for climate services
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_cherian_etal/DC_01_cf-xarray.html">
     cf-xarray: Scale your analysis across datasets with less data wrangling and more metadata handling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_cych_etal/BC_01%20Bias%20Corrected%20Estimation%20of%20Paleointensity.html">
     BC_01 Bias Corrected Estimation of Paleointensity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_dye_etal/README.html">
     Toward autonomous detection of anomalous GNSS data via applied unsupervised artificial intelligence
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../ec21_garzon_etal/README.html">
     Exploring Research Data Repositories with geoextent.
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../ec21_garzon_etal/showcase/SG_01_Exploring_Research_Data_Repositories_with_geoextent.html">
       Exploring Research Data Repositories with geoextent
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../ec21_gray_etal/README.html">
     Leveraging satellite data and pangeo to investigate the role of Gulf Stream frontal dynamics in ocean productivity
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../ec21_gray_etal/PG_01_gulf_stream_dynamics_role_in_productivity.html">
       Leveraging satellite data and pangeo to investigate the role of Gulf Stream frontal dynamics in ocean productivity
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../ec21_hu_etal/README.html">
     Machine Learning Guided Weather Analogs
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../ec21_hu_etal/WH_01_Spatio-Temporal_Deep_Analogs_2021.html">
       WH_01_Spatio-Temporal_Deep_Analogs_2021
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../ec21_lopez_etal/README.html">
     ITS_LIVE Explorer
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../ec21_lopez_etal/notebooks/itslive-notebook-rendered.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ec21_lopez_etal/notebooks/itslive-notebook.html">
       Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ec21_lopez_etal/notebooks/LL_01_ITS_LIVE_global_glacier_velocity_exploration_and_analysis.html">
       <strong>
        ITS_LIVE
       </strong>
       Global Glacier Velocity Exploration and Analysis
       <a class="anchor" id="chapter_1">
       </a>
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../ec21_martin_etal/README.html">
     Frequency-domain analysis of large datasets
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../ec21_martin_etal/PM_01_Frequency-Domain_Analysis_of_Large_Datasets.html">
       Frequency-Domain Analysis of Large Datasets
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../ec21_maussion_etal/README.html">
     OGGM-edu EarthCube notebook
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
    <label for="toctree-checkbox-11">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../ec21_maussion_etal/FM_01_OGGM-Edu_learn_and_teach_about_glaciers.html">
       OGGM-Edu - Jupyter notebooks to learn and teach about glaciers
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../ec21_potnis_etal/README.html">
     JP_01_Real_Time_Alignment_and_Distribution_of_Weather_Radar_Data_with_Rain_Gauge_Data_for_Deep_Learn
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../ec21_potnis_etal/JP_01_Real_Time_Alignment_and_Distribution_of_Weather_Radar_Data_with_Rain_Gauge_Data_for_Deep_Learning_using_CHORDS.html">
       Real Time Alignment and Distribution of Weather Radar Data with Rain Gauge Data for Deep Learning using CHORDS
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_seijo_etal/README.html">
     click Binder badge to launch notebook on Binder (no need to install environment):
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../ec21_shi_etal/README.html">
     EC2021: Automated Machine Learning for Earth Science via AutoGluon
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
    <label for="toctree-checkbox-13">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../ec21_shi_etal/Xingjian_Shi_01_Automated_Machine_Learning_for_Earth_Science_via_AutoGluon.html">
       Automated Machine Learning for Earth Science via AutoGluon
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_uchida_etal/notebooks/TU_05_Diagnosing-the-Eliassen-Palm-flux-from-a-quasi-geostrophic-double-gyre-ensemble.html">
     Diagnosing the Eliassen-Palm flux from a quasi-geostrophic double gyre ensemble
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../ec21_zheng_etal/README.html">
     EZ-FeatureTrack
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
    <label for="toctree-checkbox-14">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../ec21_zheng_etal/notebooks/WZ_01_mapping_ice_flow_velocity.html">
       Mapping ice flow velocity using an easy and interactive feature tracking workflow
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/notebooks/ec21_beckley_etal/OT_01_BulkAccessCOGs.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/earthcube2021/ec21_book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/earthcube2021/ec21_book/issues/new?title=Issue%20on%20page%20%2Fnotebooks/ec21_beckley_etal/OT_01_BulkAccessCOGs.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/earthcube2021/ec21_book/master?urlpath=lab/tree/book/notebooks/ec21_beckley_etal/OT_01_BulkAccessCOGs.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/earthcube2021/ec21_book/blob/master/book/notebooks/ec21_beckley_etal/OT_01_BulkAccessCOGs.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#authors">
   Authors
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#purpose">
   Purpose
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#funding">
   Funding
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#keywords">
   Keywords
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#citation">
   Citation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#library-imports">
     Library Imports
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-access-and-visualization">
   Data Access and Visualization
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#access-srtm-tiles-with-aws-cli">
     Access SRTM Tiles with AWS CLI
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-srtm-tiles">
     Plot SRTM Tiles
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#srtm-bulk-access-via-gdal-vrts">
     SRTM Bulk Access via GDAL VRTs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-srtm-mosaic">
     Plot SRTM Mosaic
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#srtm-access-via-opentopography-s-api">
     SRTM Access via OpenTopography’s API
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-processing">
   Data Processing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-colorado-river-vector-data">
     Download Colorado River Vector Data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#clip-river-data">
     Clip River Data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#buffer-river-centerline">
     Buffer River Centerline
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dissolve-river-buffer-polygon">
     Dissolve River Buffer Polygon
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overplot-river-shapefiles-on-dem">
     Overplot River Shapefiles on DEM
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculate-projected-bounds-of-river-polygon">
     Calculate Projected Bounds of River Polygon
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#clip-projected-river-polygon">
     Clip Projected River Polygon
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-clipped-river-buffer-on-dem">
     Plot Clipped River Buffer on DEM
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extracting-and-masking-srtm-data-in-one-step">
     Extracting and Masking SRTM Data in One Step
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resources">
   Resources
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="programmatic-access-to-opentopographys-cloud-optimized-geotiff-cog-global-datasets">
<h1>Programmatic Access to OpenTopography’s Cloud Optimized GeoTIFF (COG) Global Datasets<a class="headerlink" href="#programmatic-access-to-opentopographys-cloud-optimized-geotiff-cog-global-datasets" title="Permalink to this headline">¶</a></h1>
<h1>Table of Contents<span class="tocSkip"></span></h1>
<div class="toc"><ul class="toc-item"><li><span><a href="#Authors" data-toc-modified-id="Authors-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>Authors</a></span></li><li><span><a href="#Purpose" data-toc-modified-id="Purpose-2"><span class="toc-item-num">2&nbsp;&nbsp;</span>Purpose</a></span></li><li><span><a href="#Funding" data-toc-modified-id="Funding-3"><span class="toc-item-num">3&nbsp;&nbsp;</span>Funding</a></span></li><li><span><a href="#Keywords" data-toc-modified-id="Keywords-4"><span class="toc-item-num">4&nbsp;&nbsp;</span>Keywords</a></span></li><li><span><a href="#Citation" data-toc-modified-id="Citation-5"><span class="toc-item-num">5&nbsp;&nbsp;</span>Citation</a></span></li><li><span><a href="#Setup" data-toc-modified-id="Setup-6"><span class="toc-item-num">6&nbsp;&nbsp;</span>Setup</a></span><ul class="toc-item"><li><span><a href="#Library-Imports" data-toc-modified-id="Library-Imports-6.1"><span class="toc-item-num">6.1&nbsp;&nbsp;</span>Library Imports</a></span></li></ul></li><li><span><a href="#Data-Access-and-Visualization" data-toc-modified-id="Data-Access-and-Visualization-7"><span class="toc-item-num">7&nbsp;&nbsp;</span>Data Access and Visualization</a></span><ul class="toc-item"><li><span><a href="#Access-SRTM-Tiles-with-AWS-CLI" data-toc-modified-id="Access-SRTM-Tiles-with-AWS-CLI-7.1"><span class="toc-item-num">7.1&nbsp;&nbsp;</span>Access SRTM Tiles with AWS CLI</a></span></li><li><span><a href="#Plot-SRTM-Tiles" data-toc-modified-id="Plot-SRTM-Tiles-7.2"><span class="toc-item-num">7.2&nbsp;&nbsp;</span>Plot SRTM Tiles</a></span></li><li><span><a href="#SRTM-Bulk-Access-via-GDAL-VRTs" data-toc-modified-id="SRTM-Bulk-Access-via-GDAL-VRTs-7.3"><span class="toc-item-num">7.3&nbsp;&nbsp;</span>SRTM Bulk Access via GDAL VRTs</a></span></li><li><span><a href="#Plot-SRTM-Mosaic" data-toc-modified-id="Plot-SRTM-Mosaic-7.4"><span class="toc-item-num">7.4&nbsp;&nbsp;</span>Plot SRTM Mosaic</a></span></li><li><span><a href="#SRTM-Access-via-OpenTopography's-API" data-toc-modified-id="SRTM-Access-via-OpenTopography's-API-7.5"><span class="toc-item-num">7.5&nbsp;&nbsp;</span>SRTM Access via OpenTopography's API</a></span></li></ul></li><li><span><a href="#Data-Processing" data-toc-modified-id="Data-Processing-8"><span class="toc-item-num">8&nbsp;&nbsp;</span>Data Processing</a></span><ul class="toc-item"><li><span><a href="#Download-Colorado-River-Vector-Data" data-toc-modified-id="Download-Colorado-River-Vector-Data-8.1"><span class="toc-item-num">8.1&nbsp;&nbsp;</span>Download Colorado River Vector Data</a></span></li><li><span><a href="#Clip-River-Data" data-toc-modified-id="Clip-River-Data-8.2"><span class="toc-item-num">8.2&nbsp;&nbsp;</span>Clip River Data</a></span></li><li><span><a href="#Buffer-River-Centerline" data-toc-modified-id="Buffer-River-Centerline-8.3"><span class="toc-item-num">8.3&nbsp;&nbsp;</span>Buffer River Centerline</a></span></li><li><span><a href="#Dissolve-River-Buffer-Polygon" data-toc-modified-id="Dissolve-River-Buffer-Polygon-8.4"><span class="toc-item-num">8.4&nbsp;&nbsp;</span>Dissolve River Buffer Polygon</a></span></li><li><span><a href="#Overplot-River-Shapefiles-on-DEM" data-toc-modified-id="Overplot-River-Shapefiles-on-DEM-8.5"><span class="toc-item-num">8.5&nbsp;&nbsp;</span>Overplot River Shapefiles on DEM</a></span></li><li><span><a href="#Calculate-Projected-Bounds-of-River-Polygon" data-toc-modified-id="Calculate-Projected-Bounds-of-River-Polygon-8.6"><span class="toc-item-num">8.6&nbsp;&nbsp;</span>Calculate Projected Bounds of River Polygon</a></span></li><li><span><a href="#Clip-Projected-River-Polygon" data-toc-modified-id="Clip-Projected-River-Polygon-8.7"><span class="toc-item-num">8.7&nbsp;&nbsp;</span>Clip Projected River Polygon</a></span></li><li><span><a href="#Plot-Clipped-River-Buffer-on-DEM" data-toc-modified-id="Plot-Clipped-River-Buffer-on-DEM-8.8"><span class="toc-item-num">8.8&nbsp;&nbsp;</span>Plot Clipped River Buffer on DEM</a></span></li><li><span><a href="#Extracting-and-Masking-SRTM-Data-in-One-Step" data-toc-modified-id="Extracting-and-Masking-SRTM-Data-in-One-Step-8.9"><span class="toc-item-num">8.9&nbsp;&nbsp;</span>Extracting and Masking SRTM Data in One Step</a></span></li></ul></li><li><span><a href="#Conclusion" data-toc-modified-id="Conclusion-9"><span class="toc-item-num">9&nbsp;&nbsp;</span>Conclusion</a></span></li><li><span><a href="#Resources" data-toc-modified-id="Resources-10"><span class="toc-item-num">10&nbsp;&nbsp;</span>Resources</a></span></li></ul></div><div class="section" id="authors">
<h2>Authors<a class="headerlink" href="#authors" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Author1 = {“name”: “Matthew Beckley”, “affiliation”: “UNAVCO, Inc.”, “email”: “<a class="reference external" href="mailto:beckley&#37;&#52;&#48;unavco&#46;org">beckley<span>&#64;</span>unavco<span>&#46;</span>org</a>”, “orcid”:””}</p></li>
<li><p>Author2 = {“name”: “Christopher Crosby”, “affiliation”: “UNAVCO, Inc.”, “email”: “<a class="reference external" href="mailto:crosby&#37;&#52;&#48;unavco&#46;org">crosby<span>&#64;</span>unavco<span>&#46;</span>org</a>”, “orcid”: “<a class="reference external" href="https://orcid.org/0000-0003-2522-4193">https://orcid.org/0000-0003-2522-4193</a>”}</p></li>
<li><p>Author3 = {“name”: “Viswanath Nandigam”, “affiliation”: “San Diego Supercomputer Center, UC San Diego”, “email”: “<a class="reference external" href="mailto:viswanat&#37;&#52;&#48;sdsc&#46;edu">viswanat<span>&#64;</span>sdsc<span>&#46;</span>edu</a>”, “orcid”: “<a class="reference external" href="https://orcid.org/0000-0003-0928-9851">https://orcid.org/0000-0003-0928-9851</a>”}</p></li>
<li><p>Author4 = {“name”: “Minh Phan”, “affiliation”: “San Diego Supercomputer Center, UC San Diego”, “email”: “<a class="reference external" href="mailto:mnphan&#37;&#52;&#48;sdsc&#46;edu">mnphan<span>&#64;</span>sdsc<span>&#46;</span>edu</a>”,”orcid”:”<a class="reference external" href="https://orcid.org/0000-0002-2806-5450">https://orcid.org/0000-0002-2806-5450</a>”}</p></li>
</ul>
</div>
<div class="section" id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://opentopography.org/">OpenTopography</a> strives to provide a variety of access methods to our datasets to address the varying needs of our users. While most users access data through the web map interface, others prefer to programmatically access data from our cloud-based storage. In this tutorial we will explore a couple of different methods of accessing data over the Grand Canyon from the cloud-based <a class="reference external" href="https://doi.org/10.5069/G9445JDF">NASA Shuttle Radar Topography Mission (SRTM) catalog in OpenTopography</a>.  We will also demonstrate how we can use open-source, command line tools to programmatically access data without the need for a web-map interface.</p>
<p>In addition, this tutorial should highlight the power of <a class="reference external" href="https://www.cogeo.org/">Cloud Optimized GeoTIFFs (COGs),</a> and how they can be used to reduce download file sizes as well as increase data access speeds.  COGs are quickly becoming a standard format for hosting raster data in the cloud due to its optimized file structure to enable faster access and subsetting. In order to take advantage of this benefit, <a class="reference external" href="https://opentopography.org/">OpenTopography</a> has recently converted its entire global dataset collection to COGs. With the COG format, programs and web requests can read the top-level header and quickly extract data for a region of interest as opposed to having to read the entire file.  This drastically reduces file read-time as well as reducing the number of http GET requests to access the data.  For a more detailed discussion on COGs and their benefits see the resources section at the bottom of this page.</p>
</div>
<div class="section" id="funding">
<h2>Funding<a class="headerlink" href="#funding" title="Permalink to this headline">¶</a></h2>
<p>OpenTopography is supported by the National Science Foundation under Award Numbers 1948997, 1948994 &amp; 1948857</p>
</div>
<div class="section" id="keywords">
<h2>Keywords<a class="headerlink" href="#keywords" title="Permalink to this headline">¶</a></h2>
<p>keywords=[“COG”, “OpenTopography”, “SRTM”, “GDAL”, “VRT”]</p>
</div>
<div class="section" id="citation">
<h2>Citation<a class="headerlink" href="#citation" title="Permalink to this headline">¶</a></h2>
<p>To cite this notebook:  Beckley, M., Crosby, C., Nandigam, V. &amp; Phan, M. (2021). Programmatic Access to OpenTopography’s Cloud Optimized GeoTIFF (COG) Global Datasets (Version v1.0). <a class="reference external" href="https://doi.org/10.5069/G9BC3WRK">https://doi.org/10.5069/G9BC3WRK</a> Accessed: MM/DD/YYYY</p>
</div>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>If running this tutorial locally: set up a new conda environment with GDAL 3.2 and AWS CLI tools installed:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">Create</span> <span class="pre">a</span> <span class="pre">conda</span> <span class="pre">environment</span> <span class="pre">called,</span> <span class="pre">'COGS',</span> <span class="pre">and</span> <span class="pre">install</span> <span class="pre">GDAL</span> <span class="pre">v</span> <span class="pre">3.2:</span>&#160; <span class="pre">conda</span> <span class="pre">create</span> <span class="pre">-n</span> <span class="pre">COGS</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">gdal==3.2.0</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">#Activate</span> <span class="pre">your</span> <span class="pre">new</span> <span class="pre">environment</span>&#160; <span class="pre">conda</span> <span class="pre">activate</span> <span class="pre">COGS</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">#install</span> <span class="pre">AWS</span> <span class="pre">command</span> <span class="pre">line</span> <span class="pre">tools</span> <span class="pre">in</span> <span class="pre">your</span> <span class="pre">environment</span>&#160; <span class="pre">conda</span> <span class="pre">install</span> <span class="pre">--yes</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">awscli</span></code></p>
<p>We will also be using the following python libraries:</p>
<ul class="simple">
<li><p>rasterio</p></li>
<li><p>fiona</p></li>
<li><p>wget</p></li>
<li><p>pyproj</p></li>
<li><p>geopandas</p></li>
</ul>
<p>Within this conda environment, install these libraries with pip:
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">rasterio</span> <span class="pre">fiona</span> <span class="pre">wget</span> <span class="pre">geopandas</span> <span class="pre">pyproj</span> <span class="pre">matplotlib</span></code></p>
<p>If you are having difficulties getting the environment set up, you can always run the notebook from <a class="reference external" href="https://mybinder.org/v2/gh/OpenTopography/Jupyter/main?filepath=OT_01_BulkAccessCOGs.ipynb">Binder</a></p>
<div class="section" id="library-imports">
<h3>Library Imports<a class="headerlink" href="#library-imports" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Visualization</span>
<span class="kn">import</span> <span class="nn">rasterio</span> <span class="k">as</span> <span class="nn">rio</span>                                                                                                                  
<span class="kn">from</span> <span class="nn">rasterio.plot</span> <span class="kn">import</span> <span class="n">show</span>  
<span class="kn">import</span> <span class="nn">rasterio.mask</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>                                                                                                         

<span class="c1">#Working with Shapefiles</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span> 
<span class="kn">import</span> <span class="nn">fiona</span>

<span class="c1">#Projections and Transformations</span>
<span class="kn">from</span> <span class="nn">pyproj</span> <span class="kn">import</span> <span class="n">Transformer</span>

<span class="c1">#Downloads</span>
<span class="kn">import</span> <span class="nn">wget</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success! Imported all necessary libraries.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="data-access-and-visualization">
<h2>Data Access and Visualization<a class="headerlink" href="#data-access-and-visualization" title="Permalink to this headline">¶</a></h2>
<p>Below is a Google Earth image of a section of the Grand Canyon, AZ where we will extract data and do some data processing:</p>
<p><img alt="GrandCanyon" src="../../_images/GC_Basemap.png" /></p>
<hr class="docutils" />
<div class="section" id="access-srtm-tiles-with-aws-cli">
<h3>Access SRTM Tiles with AWS CLI<a class="headerlink" href="#access-srtm-tiles-with-aws-cli" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://doi.org/10.5069/G9445JDF">SRTM catalog in OpenTopography</a> is organized into tiled COGs where each tile is named after its lower left corner (e.g. N35W112.tif is the tile that has its South-West corner at 35 Degrees North, 112 degrees West).</p>
<p>For this exercise we will gather data around the Grand Canyon with a lat/lon bounds of [-114, 35, -111, 37].</p>
<p>Using this Area of Interest (AOI) information we can grab the tiles that cover this region.  OpenTopography users can access all hosted data via AWS Command Line Tools.  So, knowing the lat/lon bounds of our area of interest, we can download just the tiles for this region using <a class="reference external" href="https://anaconda.org/conda-forge/awscli">aws command line tools</a>.</p>
<p>It is useful to incorporate wildcards to limit the data you need to download.  The example belows downloads all files that match: N35W112.tif, N35W113.tif, N35W114.tif, N36W114.tif, N36W112.tif, &amp; N36W113.tif</p>
<p>Within Jupyter Notebooks, shell commands can be executed by starting the command with an exclamation mark (“!”). In this notebook, we will explore a variety of tools - using both shell and python commands to demonstrate different methods to complete common geoprocessing tasks.</p>
<p><strong>NOTE:  The AWS copy command may take up to a minute to complete depending on your internet connection.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloading files from AWS S3...&quot;</span><span class="p">)</span>
<span class="o">!</span>aws s3 cp s3://raster/SRTM_GL1/SRTM_GL1_srtm/ . --recursive --exclude <span class="s2">&quot;*&quot;</span> --include <span class="s2">&quot;N3[56]W11[234].tif&quot;</span> --endpoint-url https://opentopography.s3.sdsc.edu --no-sign-request
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success!  Download complete.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-srtm-tiles">
<h3>Plot SRTM Tiles<a class="headerlink" href="#plot-srtm-tiles" title="Permalink to this headline">¶</a></h3>
<p>Now that we have downloaded the SRTM tiles that cover the Grand Canyon, we can plot them using the Python Library, <a class="reference external" href="https://rasterio.readthedocs.io/en/latest/">Rasterio:</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">images</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;N35W112.tif&#39;</span><span class="p">,</span><span class="s1">&#39;N35W113.tif&#39;</span><span class="p">,</span><span class="s1">&#39;N35W114.tif&#39;</span><span class="p">,</span><span class="s1">&#39;N36W112.tif&#39;</span><span class="p">,</span><span class="s1">&#39;N36W113.tif&#39;</span><span class="p">,</span><span class="s1">&#39;N36W114.tif&#39;</span><span class="p">]</span> 
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">114</span><span class="p">,</span> <span class="o">-</span><span class="mi">111</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">35</span><span class="p">,</span> <span class="mi">37</span><span class="p">])</span>

<span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>                                                                                                                       
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;loading: &#39;</span><span class="p">,</span><span class="n">im</span><span class="p">)</span>
    <span class="n">raster</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
    <span class="n">show</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success! Plotted SRTM Tiles.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Downloading the data in this manner, we end up with 6 tifs that broadly cover our area. But what if we wanted to confine our search area around the Colorado River, and reduce time spent on post processing of the data?  GDAL’s <a class="reference external" href="https://gdal.org/programs/gdalbuildvrt.html">Virtual Raster Datasets (VRT)</a> can help in this regard.</p>
</div>
<div class="section" id="srtm-bulk-access-via-gdal-vrts">
<h3>SRTM Bulk Access via GDAL VRTs<a class="headerlink" href="#srtm-bulk-access-via-gdal-vrts" title="Permalink to this headline">¶</a></h3>
<p>As part of our ingest process, OpenTopography builds GDAL <a class="reference external" href="https://gdal.org/programs/gdalbuildvrt.html">Virtual Raster Datasets (VRTs)</a> for all its rasters to enable faster and more efficient data access. With GDAL and VRTs, users can extract a specific area of interest and obtain a merged, clipped raster all in one operation. For example, by using the vsicurl command with a targeted bounding box, we can extract a raster that covers the area of the Grand Canyon around the Colorado River.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>!time gdal_translate /vsicurl/https://opentopography.s3.sdsc.edu/raster/SRTM_GL1/SRTM_GL1_srtm.vrt -projwin -113.98 36.563 -111.777 35.7 -co\
 COMPRESS=deflate srtm_GC.tif
print(&quot;Success!  Downloaded SRTM from VRT.&quot;)
    
</pre></div>
</div>
</div>
</div>
<p>So the above command runs pretty quickly, and if using GDAL version 3.2, which has native COG support, we are able to output a COG-formatted mosaic of SRTM data over our area of interest.  Note the ‘-co COMPRESS-deflate’ command additionally compresses the output file using the ‘deflate’ algorithm to reduce the output filesize.</p>
</div>
<div class="section" id="plot-srtm-mosaic">
<h3>Plot SRTM Mosaic<a class="headerlink" href="#plot-srtm-mosaic" title="Permalink to this headline">¶</a></h3>
<p>Using the same plotting commands as earlier, we can plot the single, mosaiced image to see that we now have a single image that is clipped to the portion of the Grand Canyon that is of interest.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span><span class="s1">&#39;srtm_GC.tif&#39;</span> 
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">114</span><span class="p">,</span> <span class="o">-</span><span class="mi">111</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">35</span><span class="p">,</span> <span class="mi">37</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;loading: &#39;</span><span class="p">,</span><span class="n">image</span><span class="p">)</span>
<span class="n">raster</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success! Plotted SRTM Mosaic.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="srtm-access-via-opentopography-s-api">
<h3>SRTM Access via OpenTopography’s API<a class="headerlink" href="#srtm-access-via-opentopography-s-api" title="Permalink to this headline">¶</a></h3>
<p>Users can get the same data product by using <a class="reference external" href="https://opentopography.org/developers">OpenTopography’s API</a>.  Users can <a class="reference external" href="https://portal.opentopography.org/apidocs/#/Public/getGlobalDem">build the REST API call</a> and it will output the appropriate request to use in a curl command, or a http GET request.  Here is the URL request that can be used via https for SRTM GL1 data over the GrandCanyon:</p>
<p><code class="docutils literal notranslate"><span class="pre">https://portal.opentopography.org/API/globaldem?demtype=SRTMGL1&amp;south=35.7&amp;north=36.54&amp;west=-114&amp;east=-111.7&amp;outputFormat=GTiff</span></code></p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="data-processing">
<h2>Data Processing<a class="headerlink" href="#data-processing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="download-colorado-river-vector-data">
<h3>Download Colorado River Vector Data<a class="headerlink" href="#download-colorado-river-vector-data" title="Permalink to this headline">¶</a></h3>
<p>By using the SRTM VRT, we have now have a single, mosaiced GeoTIFF that is much smaller in size than the original tiled images. But we can take this further by using the power of COGs and other Python libraries. So, let’s say we really only want data around the Colorado River. To do this, we first need to get a vector representation of the Colorado River. Luckily, there is a fantastic site called, <a class="reference external" href="https://www.naturalearthdata.com/">Natural Earth Data</a> that has a wealth of vector and raster map data at a variety of scales.  For this example, we’ll use the rivers and lakes centerlines file. You can download the data from the <a class="reference external" href="https://www.naturalearthdata.com/downloads/10m-physical-vectors/">Natural Earth Data Download site</a> or you can use wget.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/physical/ne_10m_rivers_lake_centerlines.zip&#39;</span><span class="p">,</span><span class="s1">&#39;rivers.zip&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success! Downloaded river vector data.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>unzip -o rivers.zip
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success! Extracted river shapefiles from archive.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="clip-river-data">
<h3>Clip River Data<a class="headerlink" href="#clip-river-data" title="Permalink to this headline">¶</a></h3>
<p>Now we have river data, but it is for the entire world. Next we’ll clip the river dataset to our area of interest using <a class="reference external" href="https://gdal.org/programs/ogr2ogr.html#ogr2ogr">GDAL’s vector toolkit</a>. We also want to create a buffer around the river, but in order to do that we need to project the data. As downloaded, the river data is in a Geographic Coordinate System, so we will need to output the data in a projected coordinate system in order to do the buffering operation. Arizona is in UTM zone 12N, so we’ll use <a class="reference external" href="https://epsg.io/32612">EPSG:32612</a> for the output projection. Using the ogr2ogr tool we can output a projected, clipped version of the river shapefile with the following command:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>ogr2ogr ColoradoRiver_AOI.shp ne_10m_rivers_lake_centerlines.shp -t_srs EPSG:32612 -spat -113.98 <span class="m">35</span>.7 -111.777 <span class="m">36</span>.563 -clipsrc spat_extent
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success! Clip global river data to Grand Canyon.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="buffer-river-centerline">
<h3>Buffer River Centerline<a class="headerlink" href="#buffer-river-centerline" title="Permalink to this headline">¶</a></h3>
<p>Next we need to create a buffer around the Colorado River.  We’ll make a buffer that is 10km around either side so that we include the interesting features of the Grand Canyon.  With OGR you can pass in <a class="reference external" href="https://gdal.org/user/sql_sqlite_dialect.html">SQLite commands</a>. In this example we will use the ST_Buffer command to create a 10km buffer around the Colorado River.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>ogr2ogr ColoradoRiver_AOI_10kmBuffer.shp ColoradoRiver_AOI.shp -dialect sqlite -sql <span class="s2">&quot;select ST_buffer(geometry,10000) as geometry from ColoradoRiver_AOI&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success! Created buffer from river centerline.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="dissolve-river-buffer-polygon">
<h3>Dissolve River Buffer Polygon<a class="headerlink" href="#dissolve-river-buffer-polygon" title="Permalink to this headline">¶</a></h3>
<p>Since the river shapefile had segments, we should dissolve the buffer so that we end up with a single dissolved polygon that covers the buffer region of the river. To do this, we can once again use the “ST_Union” command with sqlite:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>ogr2ogr ColoradoRiver_AOI_Buffer_Dissolved.shp ColoradoRiver_AOI_10kmBuffer.shp -dialect sqlite -sql <span class="s2">&quot;select ST_Union(geometry) as geometry from ColoradoRiver_AOI_10kmBuffer&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success! Dissolved buffer polygon.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="overplot-river-shapefiles-on-dem">
<h3>Overplot River Shapefiles on DEM<a class="headerlink" href="#overplot-river-shapefiles-on-dem" title="Permalink to this headline">¶</a></h3>
<p>Using the GeoPandas library, we can easily read in the buffered river shapefile.  Note we are plotting in lat/lon space, so we will need to reproject the shapefile coordinates to latitude and longitude. This code shows yet another way of how you could reproject your coordinates - this time using the GeoPandas library:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span><span class="s1">&#39;srtm_GC.tif&#39;</span>                                                                                                                    
<span class="n">river_buffered</span> <span class="o">=</span> <span class="s1">&#39;ColoradoRiver_AOI_Buffer_Dissolved.shp&#39;</span>                                                                               
<span class="n">river</span> <span class="o">=</span> <span class="s1">&#39;ColoradoRiver_AOI.shp&#39;</span>                                                                                                         
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>                                                                                                   
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">114</span><span class="p">,</span> <span class="o">-</span><span class="mi">111</span><span class="p">])</span>                                                                                                                  
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">35</span><span class="p">,</span> <span class="mi">37</span><span class="p">])</span>                                                                                                                      
                                                                                                                                        
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;loading: &#39;</span><span class="p">,</span><span class="n">image</span><span class="p">)</span>                                                                                                                
<span class="n">raster</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>                                                                                                                
<span class="n">show</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>                                                                                                                                                                                  

<span class="c1">#get the coordinate system of the raster</span>
<span class="n">raster_CRS</span> <span class="o">=</span> <span class="n">raster</span><span class="o">.</span><span class="n">crs</span>                 

<span class="c1">#Read in the river centerline shapefile with geopandas</span>
<span class="n">river</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">river</span><span class="p">)</span>                          

<span class="c1">#Convert the river centerline to the same coordinate system as the DEM (Lat/Lon)</span>
<span class="n">river_LL</span> <span class="o">=</span> <span class="n">river</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">raster_CRS</span><span class="p">)</span>                                            


<span class="c1">#perform the same operations for the buffered river shapefile                                                                                                                                        </span>
<span class="n">river_buffered</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">river_buffered</span><span class="p">)</span>                                                                                          
<span class="n">river_buffered_LL</span> <span class="o">=</span> <span class="n">river_buffered</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">raster_CRS</span><span class="p">)</span>                                                                                   
                                                                                                                                        
<span class="c1">#Overplot the river centerline and the river buffer on the SRTM DEM</span>
<span class="n">river_LL</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>                                                                                                                    
<span class="n">river_buffered_LL</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>  

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success! Plotted river data on SRTM DEM.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="calculate-projected-bounds-of-river-polygon">
<h3>Calculate Projected Bounds of River Polygon<a class="headerlink" href="#calculate-projected-bounds-of-river-polygon" title="Permalink to this headline">¶</a></h3>
<p>Since we buffered the data, it now extends outside our AOI. We can clip it to the bounds, but the buffered shapefile is now in UTM 12N projected coordinates, so we need to find what the bounding box coordinates are in UTM 12N coordinates. There are many different libraries that can perform this operation, but for this step, we’ll highlight using pyproj Python library and OGR to do this tranformation and clipping. First we will get the UTM bounds of our area of interest by converting the lat/lon bounds to UTM coordinates with a simple pyproj script:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#set up the transformation in pyproj</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="n">Transformer</span><span class="o">.</span><span class="n">from_crs</span><span class="p">(</span><span class="s2">&quot;epsg:4326&quot;</span><span class="p">,</span> <span class="s2">&quot;epsg:32612&quot;</span><span class="p">)</span>

<span class="c1">#Convert lower-left corner of AOI</span>
<span class="n">LL_lon</span><span class="p">,</span><span class="n">LL_lat</span> <span class="o">=</span> <span class="o">-</span><span class="mf">113.98</span><span class="p">,</span><span class="mf">35.7</span>
<span class="n">LL_x</span><span class="p">,</span><span class="n">LL_y</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">LL_lat</span><span class="p">,</span><span class="n">LL_lon</span><span class="p">)</span>

<span class="c1">#Convert upper-right corner of AOI</span>
<span class="n">UR_lon</span><span class="p">,</span><span class="n">UR_lat</span> <span class="o">=</span> <span class="o">-</span><span class="mf">111.777</span><span class="p">,</span><span class="mf">36.563</span>
<span class="n">UR_x</span><span class="p">,</span><span class="n">UR_y</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">UR_lat</span><span class="p">,</span><span class="n">UR_lon</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lower Left Corner in UTM X,Y is: </span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="se">\n</span><span class="s1">Upper Right Corner in UTM X,Y is: </span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LL_x</span><span class="p">,</span><span class="n">LL_y</span><span class="p">,</span><span class="n">UR_x</span><span class="p">,</span><span class="n">UR_y</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success! Extracted UTM coordinates for river bounds.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="clip-projected-river-polygon">
<h3>Clip Projected River Polygon<a class="headerlink" href="#clip-projected-river-polygon" title="Permalink to this headline">¶</a></h3>
<p>Now we can feed these UTM bounding coordinates back into a ogr to clip the river polygon to the area of interest:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>ogr2ogr ColoradoRiver_AOI_Final.shp ColoradoRiver_AOI_Buffer_Dissolved.shp -clipdst <span class="m">230367</span>.047752107 <span class="m">3954768</span>.801329 <span class="m">430471</span>.347916117 <span class="m">4046677</span>.17926595
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success! Clipped river buffer to area of interest.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-clipped-river-buffer-on-dem">
<h3>Plot Clipped River Buffer on DEM<a class="headerlink" href="#plot-clipped-river-buffer-on-dem" title="Permalink to this headline">¶</a></h3>
<p>Now that we have a clipped river buffer, we can plot it, and the river centerline on top of the SRTM DEM to verify that the polygon has been clipped:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span><span class="s1">&#39;srtm_GC.tif&#39;</span> 
<span class="n">river</span> <span class="o">=</span> <span class="s1">&#39;ColoradoRiver_AOI.shp&#39;</span>
<span class="n">river_buffered</span> <span class="o">=</span> <span class="s1">&#39;ColoradoRiver_AOI_Final.shp&#39;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">114</span><span class="p">,</span> <span class="o">-</span><span class="mi">111</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">35</span><span class="p">,</span> <span class="mi">37</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;loading: &#39;</span><span class="p">,</span><span class="n">image</span><span class="p">)</span>
<span class="n">raster</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

<span class="n">raster_CRS</span> <span class="o">=</span> <span class="n">raster</span><span class="o">.</span><span class="n">crs</span>                                                                                                                 
<span class="n">river</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">river</span><span class="p">)</span>                                                                                                            
<span class="n">river_LL</span> <span class="o">=</span> <span class="n">river</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">raster_CRS</span><span class="p">)</span>                                                                                                     
                                                                                                                                        
<span class="n">river_buffered</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">river_buffered</span><span class="p">)</span>                                                                                          
<span class="n">river_buffered_LL</span> <span class="o">=</span> <span class="n">river_buffered</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">raster_CRS</span><span class="p">)</span>                                                                                   
                                                                                                                                        
                                                                                                                                        
<span class="n">river_LL</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>                                                                                                                    
<span class="n">river_buffered_LL</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span> 

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success! Plotted clipped river data on SRTM DEM..&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="extracting-and-masking-srtm-data-in-one-step">
<h3>Extracting and Masking SRTM Data in One Step<a class="headerlink" href="#extracting-and-masking-srtm-data-in-one-step" title="Permalink to this headline">¶</a></h3>
<p>Many applications can now take advantage of COGs. <a class="reference external" href="https://rasterio.readthedocs.io/en/latest/">Rasterio</a> is a Python library that takes advantage of COGs ability to use the vsis3 and vsicurl file system handlers to perform HTTP read operations in a more efficient way. Ultimately, this benefit is passed on to the user by providing faster downloads that take up less disk space. As an example, we will use <a class="reference external" href="https://pypi.org/project/Fiona/">Fiona</a> and <a class="reference external" href="https://rasterio.readthedocs.io/en/latest/">Rasterio</a> to download only the SRTM data that fits within our 10km Colorado River buffer.</p>
<p>Because we are ultimately going to intersect this boundary with the SRTM VRT, they both need to be in the same coordinate system.  So, we need to re-project this final boundary back to Geographic Coordinates so that it is compatible with the SRTM dataset. We can do this with a ogr2ogr command:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>ogr2ogr ColoradoRiver_AOI_Final_WGSLatLon.shp ColoradoRiver_AOI_Final.shp -s_srs <span class="s2">&quot;EPSG:32612&quot;</span> -t_srs <span class="s2">&quot;EPSG:4326&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success! Reprojected river buffer to WGS84 Lat/Lon&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have a mask in the same coordinate system as the SRTM VRT, we can read, mask, and plot the data with a few lines of code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inshp</span> <span class="o">=</span> <span class="s1">&#39;ColoradoRiver_AOI_Final_WGSLatLon.shp&#39;</span>                                                         
<span class="n">fp</span> <span class="o">=</span> <span class="s1">&#39;https://opentopography.s3.sdsc.edu/raster/SRTM_GL1/SRTM_GL1_srtm.vrt&#39;</span>                                                                                     

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading Mask...&quot;</span><span class="p">)</span>
<span class="c1">#read in the buffered shapefile using fiona</span>
<span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">inshp</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">shapefile</span><span class="p">:</span>                                                                                                                       
    <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">shapefile</span><span class="p">]</span>                                                                                                     
                                                                                                                                                                
<span class="c1">#Using rasterio, read directly from the SRTM VRT of COGs, and crop</span>
<span class="c1"># data to the buffer polygon</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Extracting SRTM to mask...&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>                                                                                                                                  
    <span class="n">out_image</span><span class="p">,</span> <span class="n">out_transform</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">crop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                                                                       
    <span class="n">out_meta</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">meta</span>                                                                                                                                         

<span class="c1">#set up the output parameters</span>
<span class="n">out_meta</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;driver&quot;</span><span class="p">:</span> <span class="s2">&quot;GTiff&quot;</span><span class="p">,</span>                                                                                                                             
                 <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">out_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>                                                                                                                  
                 <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">out_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                 <span class="s2">&quot;compress&quot;</span><span class="p">:</span> <span class="s2">&quot;LZW&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;tiled&quot;</span><span class="p">:</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> 
                 <span class="s2">&quot;blockxsize&quot;</span><span class="p">:</span><span class="s2">&quot;256&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;blockysize&quot;</span><span class="p">:</span><span class="s2">&quot;256&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;transform&quot;</span><span class="p">:</span> <span class="n">out_transform</span><span class="p">})</span>                                                                                                                   
                                 

<span class="c1">#Write out just the SRTM data that is within the buffer polygon</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Writing out Final SRTM DEM&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;GrandCanyon_masked.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">out_meta</span><span class="p">)</span> <span class="k">as</span> <span class="n">dest</span><span class="p">:</span>                                                                                                   
    <span class="n">dest</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out_image</span><span class="p">)</span>     
    
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">114</span><span class="p">,</span> <span class="o">-</span><span class="mi">111</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">35</span><span class="p">,</span> <span class="mi">37</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting: &#39;</span><span class="p">,</span><span class="s2">&quot;GrandCanyon_masked.tif&quot;</span><span class="p">)</span>
<span class="n">raster</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;GrandCanyon_masked.tif&quot;</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success! Plotted final result&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>Using Rasterio with OpenTopography’s VRT of COGs, we are able to download only the portion of the SRTM data we need. In this example, we downloaded only data that is within our 10 km polygon buffer of the portion of Colorado River around the Grand Canyon. <strong>Our final output raster is only 12MB, versus the 86MB of tiffs we started with at the beginning!!</strong> By putting all these tools together, users can create powerful scripts that automate data access, and ultimately reduce time on data downloads and post-processing.</p>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>Hopefully this tutorial has been helpful, and has demonstrated alternative methods to accessing cloud-based data. There are often many different ways to accomplish the same task, and we highlighted some of the more common tools and methods to perform some basic geospatial operations. We encourage users to explore datasets hosted at OpenTopography with these powerful tools. OpenTopography has various global datasets that are available through our API and/or bulk access as described in this article:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://doi.org/10.5069/G9445JDF">SRTM</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.5069/G94M92HB">ALOS World 3D - 30m</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.5069/G92R3PT9">SRTM15+</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.5069/G93T9FD9">NASADEM</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.5069/G9028PQB">Copernicus</a></p></li>
</ul>
</div>
<div class="section" id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h2>
<p>Check out some of these excellent resources on GDAL, Rasterio, and COGs</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.cogeo.org/">A good introduction to COGs</a></p></li>
<li><p><a class="reference external" href="https://medium.com/planet-stories/a-handy-introduction-to-cloud-optimized-geotiffs-1f2c9e716ec3">Another good intro to COGs</a></p></li>
<li><p><a class="reference external" href="https://trac.osgeo.org/gdal/wiki/CloudOptimizedGeoTIFF">Detailed info about the COG format in GDAL</a></p></li>
<li><p><a class="reference external" href="https://gist.github.com/sgillies/7e5cd548110a5b4d45ac1a1d93cb17a3">Python notebook on how to use Rasterio</a></p></li>
<li><p><a class="reference external" href="https://medium.com/element84/cloud-optimized-geotiff-vs-the-meta-raster-format-d24c1a77dc2e">An excellent explanation of COG file structure</a></p></li>
<li><p><a class="reference external" href="https://automating-gis-processes.github.io/CSC/notebooks/L5/read-cogs.html">Reading COGs with Rasterio (and much more)</a></p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/ec21_beckley_etal"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="README.html" title="previous page">Programmatic Access to OpenTopography’s Cloud Optimized Geotiff (COG) Global Datasets</a>
    <a class='right-next' id="next-link" href="../ec21_bourgault_etal/README.html" title="next page">xclim : Software ecosystem for climate services</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By EarthCube Office<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>