
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>5.1. cf-xarray: Scale your analysis across datasets with less data wrangling and more metadata handling &#8212; EarthCube 2021 Call for Notebooks</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="6. Reanalysis of archived paleointensity data using a new statistical method." href="../ec21_cych_etal/readme.html" />
    <link rel="prev" title="5. cf-xarray-earthcube" href="README.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      <img src="../../_static/logo.webp" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">EarthCube 2021 Call for Notebooks</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  EarthCube 2021 Call
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../docs/about.html">
   Call for Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   2021 Notebooks
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Notebook Submissions
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_anil_etal/README.html">
   1. Hydrographic Ocean Data Exploration
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_anil_etal/SA_01_Argo_Data_Exploration.html">
     1.1. Interactive Jupyter notebook for hydrographic ocean data exploration, retrieval and visualization via the Argovis API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_balwada_etal/README.html">
   2. Interactive Visualization Tools for Ocean Glider Data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_balwada_etal/DB_01_Glider_Viz_Panel.html">
     2.2. Glider Viz Panel
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_beckley_etal/README.html">
   3. Programmatic Access to OpenTopography’s Cloud Optimized Geotiff (COG) Global Datasets
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_beckley_etal/OT_01_BulkAccessCOGs.html">
     3.1. Programmatic Access to OpenTopography’s Cloud Optimized GeoTIFF (COG) Global Datasets
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_bourgault_etal/README.html">
   4. xclim : Software ecosystem for climate services
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_bourgault_etal/PB_02_xclim_Software_ecosystem_for_climate_services.html">
     4.1. xclim: Software ecosystem for climate services
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="README.html">
   5. cf-xarray-earthcube
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     5.1. cf-xarray: Scale your analysis across datasets with less data wrangling and more metadata handling
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_cych_etal/readme.html">
   6. Reanalysis of archived paleointensity data using a new statistical method.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_cych_etal/BC_01%20Bias%20Corrected%20Estimation%20of%20Paleointensity.html">
     6.1. BC_01 Bias Corrected Estimation of Paleointensity
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ec21_dye_etal/README.html">
   7. Toward autonomous detection of anomalous GNSS data via applied unsupervised artificial intelligence
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_garzon_etal/README.html">
   13. Exploring Research Data Repositories with geoextent.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_garzon_etal/showcase/SG_01_Exploring_Research_Data_Repositories_with_geoextent.html">
     13.4. Exploring Research Data Repositories with geoextent
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_gray_etal/README.html">
   14. Leveraging satellite data and pangeo to investigate the role of Gulf Stream frontal dynamics in ocean productivity
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_gray_etal/PG_01_gulf_stream_dynamics_role_in_productivity.html">
     14.3. Leveraging satellite data and pangeo to investigate the role of Gulf Stream frontal dynamics in ocean productivity
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_hu_etal/README.html">
   15. Machine Learning Guided Weather Analogs
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_hu_etal/WH_01_Spatio-Temporal_Deep_Analogs_2021.html">
     15.5. WH_01_Spatio-Temporal_Deep_Analogs_2021
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_lopez_etal/README.html">
   16. ITS_LIVE Explorer
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_lopez_etal/notebooks/itslive-notebook-rendered.html">
     16.7. Introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_lopez_etal/notebooks/LL_01_ITS_LIVE_global_glacier_velocity_exploration_and_analysis.html">
     16.8.
     <strong>
      ITS_LIVE
     </strong>
     Global Glacier Velocity Exploration and Analysis
     <a class="anchor" id="chapter_1">
     </a>
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_martin_etal/README.html">
   17. Frequency-domain analysis of large datasets
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_martin_etal/PM_01_Frequency-Domain_Analysis_of_Large_Datasets.html">
     17.1. Frequency-Domain Analysis of Large Datasets
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ec21_mason_etal/README.html">
   18. Volcanic Activity Detection
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_maussion_etal/README.html">
   20. OGGM-edu EarthCube notebook
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_maussion_etal/FM_01_OGGM-Edu_learn_and_teach_about_glaciers.html">
     20.3. OGGM-Edu - Jupyter notebooks to learn and teach about glaciers
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_potnis_etal/README.html">
   21. JP 01 Real Time Alignment and Distribution of Weather Radar Data with Rain Gauge Data for Deep Learn
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_potnis_etal/JP_01_Real_Time_Alignment_and_Distribution_of_Weather_Radar_Data_with_Rain_Gauge_Data_for_Deep_Learning_using_CHORDS.html">
     21.1. Real Time Alignment and Distribution of Weather Radar Data with Rain Gauge Data for Deep Learning using CHORDS
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ec21_seijo_etal/README.html">
   22. Notebook: Investigating upper ocean variability during tropical cyclones and seasonal sea ice formation and melting: Argovis APIs exposed to co-locate oceanic and atmospheric datasets
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_shi_etal/README.html">
   29. Automated Machine Learning for Earth Science via AutoGluon
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_shi_etal/Xingjian_Shi_01_Automated_Machine_Learning_for_Earth_Science_via_AutoGluon.html">
     29.1. Automated Machine Learning for Earth Science via AutoGluon
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_uchida_etal/README.html">
   30. QG Eliassen-Palm flux
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_uchida_etal/notebooks/TU_05_Diagnosing-the-Eliassen-Palm-flux-from-a-quasi-geostrophic-double-gyre-ensemble.html">
     30.1. Diagnosing the Eliassen-Palm flux from a quasi-geostrophic double gyre ensemble
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ec21_zheng_etal/README.html">
   31. EZ-FeatureTrack
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ec21_zheng_etal/notebooks/WZ_01_mapping_ice_flow_velocity.html">
     31.3. Mapping ice flow velocity using an easy and interactive feature tracking workflow
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/notebooks/ec21_cherian_etal/DC_01_cf-xarray.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   5.1. cf-xarray: Scale your analysis across datasets with less data wrangling and more metadata handling
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#author-s">
     5.1.1. Author(s)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#purpose">
     5.1.2. Purpose
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#technical-contributions">
     5.1.3. Technical contributions
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#methodology">
     5.1.4. Methodology
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#results">
     5.1.5. Results
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#funding">
     5.1.6. Funding
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#keywords">
     5.1.7. Keywords
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#citation">
     5.1.8. Citation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#work-in-progress-improvements">
     5.1.9. Work In Progress - improvements
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#suggested-next-steps">
     5.1.10. Suggested next steps
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#acknowledgements">
     5.1.11. Acknowledgements
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   5.2. Setup
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#library-import">
     5.2.1. Library import
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#parameter-definitions">
   5.3. Parameter definitions
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-import">
   5.4. Data import
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mom6">
     5.4.1. MOM6
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cmip6-ocean">
     5.4.2. CMIP6 Ocean
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cmip6-ice">
     5.4.3. CMIP6 Ice
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ncep">
     5.4.4. NCEP
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-processing-and-analysis">
   5.5. Data processing and analysis
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overview-of-cf-xarray">
     5.5.1. Overview of cf-xarray
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cf-is-an-entrypoint-for-cf-xarray-functionality">
       5.5.1.1.
       <code class="docutils literal notranslate">
        <span class="pre">
         .cf
        </span>
       </code>
       is an entrypoint for cf-xarray functionality
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#use-cf-metadata-in-standard-xarray-methods">
       5.5.1.2. Use CF metadata in standard xarray methods
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#dictionaries-mapping-cf-keys-to-variable-names">
       5.5.1.3. Dictionaries mapping CF keys to variable names
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#dealing-with-incomplete-metadata">
       5.5.1.4. Dealing with incomplete metadata
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#indexing-using-cf-keys">
       5.5.1.5. Indexing using CF keys
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#automagic-plotting">
       5.5.1.6. Automagic plotting
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cf-keys-expansion">
       5.5.1.7. CF keys expansion
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-case-examples">
     5.5.2. Use case examples
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#seamlessly-extract-statistics-from-cf-compliant-datasets">
       5.5.2.1. Seamlessly extract statistics from CF-compliant datasets
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#access-variables-through-the-cf-interface">
         5.5.2.1.1. Access variables through the
         <code class="docutils literal notranslate">
          <span class="pre">
           .cf
          </span>
         </code>
         interface
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#standardize-datasets-using-cf-xarray">
         5.5.2.1.2. Standardize datasets using cf_xarray
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#regridding-with-xesmf">
       5.5.2.2. Regridding with xESMF
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   5.6. Conclusion
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   5.7. References
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="cf-xarray-scale-your-analysis-across-datasets-with-less-data-wrangling-and-more-metadata-handling">
<h1><span class="section-number">5.1. </span>cf-xarray: Scale your analysis across datasets with less data wrangling and more metadata handling<a class="headerlink" href="#cf-xarray-scale-your-analysis-across-datasets-with-less-data-wrangling-and-more-metadata-handling" title="Permalink to this headline">¶</a></h1>
<img src="https://github.com/xarray-contrib/cf-xarray/blob/main/doc/_static/full-logo.png?raw=true" width="40%" align="center">
<div class="section" id="author-s">
<h2><span class="section-number">5.1.1. </span>Author(s)<a class="headerlink" href="#author-s" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Author1 = {“name”: “Mattia Almansi”, “affiliation”: “National Oceanography
Centre”, “email”: “<a class="reference external" href="mailto:mattia&#46;almansi&#37;&#52;&#48;noc&#46;ac&#46;uk">mattia<span>&#46;</span>almansi<span>&#64;</span>noc<span>&#46;</span>ac<span>&#46;</span>uk</a>”, “orcid”: “0000-0001-6849-3647”}</p></li>
<li><p>Author2 = {“name”: “Deepak Cherian”, “affiliation”: “National Center for
Atmospheric Research”, “email”: “<a class="reference external" href="mailto:deepak&#37;&#52;&#48;cherian&#46;net">deepak<span>&#64;</span>cherian<span>&#46;</span>net</a>”, “orcid”:
“0000-0002-6861-8734”}</p></li>
<li><p>Author3 = {“name”: “Pascal Bourgault”, “affiliation”: “Ouranos Inc.”, “email”:
“<a class="reference external" href="mailto:bourgault&#46;pascal&#37;&#52;&#48;ouranos&#46;ca">bourgault<span>&#46;</span>pascal<span>&#64;</span>ouranos<span>&#46;</span>ca</a>”, “orcid”: “0000-0003-1192-0403”}</p></li>
</ul>
<h1>Table of Contents<span class="tocSkip"></span></h1>
<div class="toc"><ul class="toc-item"><li><span><a href="#cf-xarray:-Scale-your-analysis-across-datasets-with-less-data-wrangling-and-more-metadata-handling" data-toc-modified-id="cf-xarray:-Scale-your-analysis-across-datasets-with-less-data-wrangling-and-more-metadata-handling-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>cf-xarray: Scale your analysis across datasets with less data wrangling and more metadata handling</a></span><ul class="toc-item"><li><span><a href="#Author(s)" data-toc-modified-id="Author(s)-1.1"><span class="toc-item-num">1.1&nbsp;&nbsp;</span>Author(s)</a></span></li><li><span><a href="#Purpose" data-toc-modified-id="Purpose-1.2"><span class="toc-item-num">1.2&nbsp;&nbsp;</span>Purpose</a></span></li><li><span><a href="#Technical-contributions" data-toc-modified-id="Technical-contributions-1.3"><span class="toc-item-num">1.3&nbsp;&nbsp;</span>Technical contributions</a></span></li><li><span><a href="#Methodology" data-toc-modified-id="Methodology-1.4"><span class="toc-item-num">1.4&nbsp;&nbsp;</span>Methodology</a></span></li><li><span><a href="#Results" data-toc-modified-id="Results-1.5"><span class="toc-item-num">1.5&nbsp;&nbsp;</span>Results</a></span></li><li><span><a href="#Funding" data-toc-modified-id="Funding-1.6"><span class="toc-item-num">1.6&nbsp;&nbsp;</span>Funding</a></span></li><li><span><a href="#Keywords" data-toc-modified-id="Keywords-1.7"><span class="toc-item-num">1.7&nbsp;&nbsp;</span>Keywords</a></span></li><li><span><a href="#Citation" data-toc-modified-id="Citation-1.8"><span class="toc-item-num">1.8&nbsp;&nbsp;</span>Citation</a></span></li><li><span><a href="#Work-In-Progress---improvements" data-toc-modified-id="Work-In-Progress---improvements-1.9"><span class="toc-item-num">1.9&nbsp;&nbsp;</span>Work In Progress - improvements</a></span></li><li><span><a href="#Suggested-next-steps" data-toc-modified-id="Suggested-next-steps-1.10"><span class="toc-item-num">1.10&nbsp;&nbsp;</span>Suggested next steps</a></span></li><li><span><a href="#Acknowledgements" data-toc-modified-id="Acknowledgements-1.11"><span class="toc-item-num">1.11&nbsp;&nbsp;</span>Acknowledgements</a></span></li></ul></li><li><span><a href="#Setup" data-toc-modified-id="Setup-2"><span class="toc-item-num">2&nbsp;&nbsp;</span>Setup</a></span><ul class="toc-item"><li><span><a href="#Library-import" data-toc-modified-id="Library-import-2.1"><span class="toc-item-num">2.1&nbsp;&nbsp;</span>Library import</a></span></li></ul></li><li><span><a href="#Parameter-definitions" data-toc-modified-id="Parameter-definitions-3"><span class="toc-item-num">3&nbsp;&nbsp;</span>Parameter definitions</a></span></li><li><span><a href="#Data-import" data-toc-modified-id="Data-import-4"><span class="toc-item-num">4&nbsp;&nbsp;</span>Data import</a></span><ul class="toc-item"><li><span><a href="#MOM6" data-toc-modified-id="MOM6-4.1"><span class="toc-item-num">4.1&nbsp;&nbsp;</span>MOM6</a></span></li><li><span><a href="#CMIP6-Ocean" data-toc-modified-id="CMIP6-Ocean-4.2"><span class="toc-item-num">4.2&nbsp;&nbsp;</span>CMIP6 Ocean</a></span></li><li><span><a href="#CMIP6-Ice" data-toc-modified-id="CMIP6-Ice-4.3"><span class="toc-item-num">4.3&nbsp;&nbsp;</span>CMIP6 Ice</a></span></li><li><span><a href="#NCEP" data-toc-modified-id="NCEP-4.4"><span class="toc-item-num">4.4&nbsp;&nbsp;</span>NCEP</a></span></li></ul></li><li><span><a href="#Data-processing-and-analysis" data-toc-modified-id="Data-processing-and-analysis-5"><span class="toc-item-num">5&nbsp;&nbsp;</span>Data processing and analysis</a></span><ul class="toc-item"><li><span><a href="#Overview-of-cf-xarray" data-toc-modified-id="Overview-of-cf-xarray-5.1"><span class="toc-item-num">5.1&nbsp;&nbsp;</span>Overview of cf-xarray</a></span><ul class="toc-item"><li><span><a href="#.cf-is-an-entrypoint-for-cf-xarray-functionality" data-toc-modified-id=".cf-is-an-entrypoint-for-cf-xarray-functionality-5.1.1"><span class="toc-item-num">5.1.1&nbsp;&nbsp;</span><code>.cf</code> is an entrypoint for cf-xarray functionality</a></span></li><li><span><a href="#Use-CF-metadata-in-standard-xarray-methods" data-toc-modified-id="Use-CF-metadata-in-standard-xarray-methods-5.1.2"><span class="toc-item-num">5.1.2&nbsp;&nbsp;</span>Use CF metadata in standard xarray methods</a></span></li><li><span><a href="#Dictionaries-mapping-CF-keys-to-variable-names" data-toc-modified-id="Dictionaries-mapping-CF-keys-to-variable-names-5.1.3"><span class="toc-item-num">5.1.3&nbsp;&nbsp;</span>Dictionaries mapping CF keys to variable names</a></span></li><li><span><a href="#Dealing-with-incomplete-metadata" data-toc-modified-id="Dealing-with-incomplete-metadata-5.1.4"><span class="toc-item-num">5.1.4&nbsp;&nbsp;</span>Dealing with incomplete metadata</a></span></li><li><span><a href="#Indexing-using-CF-keys" data-toc-modified-id="Indexing-using-CF-keys-5.1.5"><span class="toc-item-num">5.1.5&nbsp;&nbsp;</span>Indexing using CF keys</a></span></li><li><span><a href="#Automagic-plotting" data-toc-modified-id="Automagic-plotting-5.1.6"><span class="toc-item-num">5.1.6&nbsp;&nbsp;</span>Automagic plotting</a></span></li><li><span><a href="#CF-keys-expansion" data-toc-modified-id="CF-keys-expansion-5.1.7"><span class="toc-item-num">5.1.7&nbsp;&nbsp;</span>CF keys expansion</a></span></li></ul></li><li><span><a href="#Use-case-examples" data-toc-modified-id="Use-case-examples-5.2"><span class="toc-item-num">5.2&nbsp;&nbsp;</span>Use case examples</a></span><ul class="toc-item"><li><span><a href="#Seamlessly-extract-statistics-from-CF-compliant-datasets" data-toc-modified-id="Seamlessly-extract-statistics-from-CF-compliant-datasets-5.2.1"><span class="toc-item-num">5.2.1&nbsp;&nbsp;</span>Seamlessly extract statistics from CF-compliant datasets</a></span></li><li><span><a href="#Standardize-datasets" data-toc-modified-id="Standardize-datasets-5.2.2"><span class="toc-item-num">5.2.2&nbsp;&nbsp;</span>Standardize datasets</a></span></li><li><span><a href="#Regridding-with-xESMF" data-toc-modified-id="Regridding-with-xESMF-5.2.3"><span class="toc-item-num">5.2.3&nbsp;&nbsp;</span>Regridding with xESMF</a></span></li></ul></li></ul></li></ul></div>
</div>
<div class="section" id="purpose">
<h2><span class="section-number">5.1.2. </span>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<p>This notebook demonstrates how the <strong>cf-xarray</strong> Python package (Cherian et
al, 2021) helps climate data scientists to process several CF-compliant datasets
from a variety of sources. Under the hood, CF-xarray decodes and makes use of
the widely adopted <span class="xref myst">Climate and Forecast (CF) conventions</span>.
Therefore, workflows integrating cf-xarray do not need knowledge of arbitrary
dataset-specific metadata such as variable names.</p>
<p>Xarray (Hoyer et al, 2021) is a Python package that enables easy and convenient
labelled data analytics by allowing users to leverage metadata such as dimension
names and coordinate labels. Xarray provides two core data structures:</p>
<ul class="simple">
<li><p>DataArray: a container wrapping a single multidimensional array with metadata.</p></li>
<li><p>Dataset: a dict-like container of multiple DataArrays.</p></li>
</ul>
<p>cf-xarray uses Xarray’s plugin interface, or “accessor”, to provide extensive
functionality on both Datasets and DataArrays under the <code class="docutils literal notranslate"><span class="pre">.cf</span></code> namespace.</p>
<p>For example, the zonal average of an Xarray Dataset <code class="docutils literal notranslate"><span class="pre">ds</span></code> is seamlessly
calculated as <code class="docutils literal notranslate"><span class="pre">ds.cf.mean(&quot;longitude&quot;)</span></code> on any CF-compliant dataset, regardless
of the actual name of the “longitude” variable (e.g., <code class="docutils literal notranslate"><span class="pre">&quot;lon&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;lon_rho&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;long&quot;</span></code>, …).</p>
</div>
<div class="section" id="technical-contributions">
<h2><span class="section-number">5.1.3. </span>Technical contributions<a class="headerlink" href="#technical-contributions" title="Permalink to this headline">¶</a></h2>
<p>Development of cf-xarray, an extension library that</p>
<ol class="simple">
<li><p>adds awareness of the Climate and Forecast (CF) conventions to core Xarray
functionality.</p></li>
<li><p>Provides utility functions with minimal dependencies, allowing easy
integration of CF-aware functionality in other packages such as xesmf (for
regridding).</p></li>
</ol>
</div>
<div class="section" id="methodology">
<h2><span class="section-number">5.1.4. </span>Methodology<a class="headerlink" href="#methodology" title="Permalink to this headline">¶</a></h2>
<p>This notebook can be executed in a pre-configured interactive environment at:
<a class="reference external" href="https://binder.pangeo.io/v2/gh/malmans2/cf-xarray-earthcube/main?filepath=DC_01_cf-xarray.ipynb">https://binder.pangeo.io/v2/gh/malmans2/cf-xarray-earthcube/main?filepath=DC_01_cf-xarray.ipynb</a></p>
</div>
<div class="section" id="results">
<h2><span class="section-number">5.1.5. </span>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h2>
<p>This notebook contains use case examples demonstrating the following
functionalities of cf-xarray:</p>
<ol class="simple">
<li><p>Seamless analysis of various CF-compliant datasets.</p></li>
<li><p>Standardization of datasets to comply with CF conventions.</p></li>
<li><p>Inference of grid-cell coordinates and bounds using CF conventions.</p></li>
<li><p>Integration with other libraries (xESMF).</p></li>
</ol>
</div>
<div class="section" id="funding">
<h2><span class="section-number">5.1.6. </span>Funding<a class="headerlink" href="#funding" title="Permalink to this headline">¶</a></h2>
<p>N/A</p>
</div>
<div class="section" id="keywords">
<h2><span class="section-number">5.1.7. </span>Keywords<a class="headerlink" href="#keywords" title="Permalink to this headline">¶</a></h2>
<p>Include up to 5 keywords, using the template below.</p>
<p>keywords=[“cf-conventions”, “xarray”, “netcdf”]</p>
</div>
<div class="section" id="citation">
<h2><span class="section-number">5.1.8. </span>Citation<a class="headerlink" href="#citation" title="Permalink to this headline">¶</a></h2>
<p>Almansi, M. and Cherian, D. and Bourgault, P. (2021). cf-xarray: Scale your
analysis across datasets with less data wrangling and more metadata handling.
<em>2021 EarthCube Annual Meeting</em>. Accessed 14/5/2021 at
<a class="reference external" href="https://github.com/malmans2/cf-xarray-earthcube">https://github.com/malmans2/cf-xarray-earthcube</a></p>
</div>
<div class="section" id="work-in-progress-improvements">
<h2><span class="section-number">5.1.9. </span>Work In Progress - improvements<a class="headerlink" href="#work-in-progress-improvements" title="Permalink to this headline">¶</a></h2>
<p>N/A</p>
</div>
<div class="section" id="suggested-next-steps">
<h2><span class="section-number">5.1.10. </span>Suggested next steps<a class="headerlink" href="#suggested-next-steps" title="Permalink to this headline">¶</a></h2>
<p>It is common for datasets to not be perfectly CF-compliant. Here we work around
these deficiencies using <code class="docutils literal notranslate"><span class="pre">assign_coordinates_and_cell_measures</span></code>. <code class="docutils literal notranslate"><span class="pre">cf_xarray</span></code> is
considering adding heuristics to guess such metadata attributes, possibly using
other metadata conventions such as SGRID.</p>
</div>
<div class="section" id="acknowledgements">
<h2><span class="section-number">5.1.11. </span>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Permalink to this headline">¶</a></h2>
<p>We acknowledge contributions from all cf-xarray contributors:
<a class="reference external" href="https://github.com/xarray-contrib/cf-xarray/graphs/contributors">https://github.com/xarray-contrib/cf-xarray/graphs/contributors</a>. We also
acknowledge MetPy for providing inspiration and various criteria for identifying
CF variables. Discussion with Jon Thielen was instrumental in development of
cf-xarray. We also acknowledge the Pangeo project for collating and providing an
immense amount of datasets on the cloud that motivated this work, as well as
provoking, enabling, and fostering discussions that led to the development of
this project.</p>
</div>
</div>
<div class="section" id="setup">
<h1><span class="section-number">5.2. </span>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<div class="section" id="library-import">
<h2><span class="section-number">5.2.1. </span>Library import<a class="headerlink" href="#library-import" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The package demonstrated here</span>
<span class="kn">import</span> <span class="nn">cf_xarray</span> <span class="k">as</span> <span class="nn">cfxr</span>

<span class="c1"># For parallelization</span>
<span class="kn">import</span> <span class="nn">dask</span>

<span class="c1"># For loading shared data</span>
<span class="kn">import</span> <span class="nn">intake</span>

<span class="c1"># Visualizations</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># For basic data manipulation</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

<span class="c1"># For regridding</span>
<span class="kn">import</span> <span class="nn">xesmf</span> <span class="k">as</span> <span class="nn">xe</span>

<span class="c1"># silence a minor warning</span>
<span class="n">dask</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;array.slicing.split_large_chunks&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="parameter-definitions">
<h1><span class="section-number">5.3. </span>Parameter definitions<a class="headerlink" href="#parameter-definitions" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Paths and urls pointing to data</span>
<span class="n">MOM6_GRID_PATH</span> <span class="o">=</span> <span class="s2">&quot;./data/ocean_grid_sym_OM4_05.nc&quot;</span>
<span class="n">MOM6_DATA_URL</span> <span class="o">=</span> <span class="s2">&quot;http://35.188.34.63:8080/thredds/dodsC/OM4p5/ocean_monthly_z.200301-200712.nc4&quot;</span>
<span class="n">CMIP6_OCE_CATALOG</span> <span class="o">=</span> <span class="s2">&quot;https://storage.googleapis.com/cmip6/pangeo-cmip6.json&quot;</span>
<span class="n">CMIP6_OCE_EXPERIMENT</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">table_id</span><span class="o">=</span><span class="s2">&quot;Omon&quot;</span><span class="p">,</span>
    <span class="n">grid_label</span><span class="o">=</span><span class="s2">&quot;gn&quot;</span><span class="p">,</span>
    <span class="n">source_id</span><span class="o">=</span><span class="s2">&quot;ACCESS-CM2&quot;</span><span class="p">,</span>
    <span class="c1"># source_id=&quot;GFDL-CM4&quot;,</span>
    <span class="n">member_id</span><span class="o">=</span><span class="s2">&quot;r1i1p1f1&quot;</span><span class="p">,</span>
    <span class="n">experiment_id</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;historical&quot;</span><span class="p">],</span>
    <span class="n">variable_id</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;thetao&quot;</span><span class="p">,</span> <span class="s2">&quot;volcello&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">CMIP6_ICE_PATH</span> <span class="o">=</span> <span class="s2">&quot;data/sic_SImon_CCCma-CanESM5_ssp245_r13i1p2f1_2020.nc&quot;</span>
<span class="n">NCEP_PATH</span> <span class="o">=</span> <span class="s2">&quot;data/air_temperature.nc&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="data-import">
<h1><span class="section-number">5.4. </span>Data import<a class="headerlink" href="#data-import" title="Permalink to this headline">¶</a></h1>
<p>This notebook uses a variety of publicly available data:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ds_mom6</span></code>: Data from the Modular Ocean Model - v6 (Adcroft et al, 2019)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ds_cmip6_oce</span></code>: Ocean Data from the Climate Model Intercomparison Project -
Phase 6</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ds_cmip6_ice_ice</span></code>: Ice Data from the Climate Model Intercomparison Project -
Phase 6</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ds_ncep</span></code>: Data from the National Centers for Atmospheric Prediction
Reanalysis (Kalnay et al, 1996)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">assign_coordinates_and_cell_measures</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Functions to add missing CF metadata (coordinates and cell measures).</span>
<span class="sd">    Fully CF-compliant datasets do not need this pre-processing.</span>
<span class="sd">    Functions to automatically assign missing coordinates</span>
<span class="sd">    and measures metadata will be implemented in cf_xarray.</span>
<span class="sd">    See https://github.com/xarray-contrib/cf-xarray/issues/201</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds: xarray.Dataset</span>
<span class="sd">        Dataset to modify</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">varname</span><span class="p">,</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

        <span class="c1"># Add coordinates attribute when the dimensions</span>
        <span class="c1"># of a coordinate variable are a subset of those of</span>
        <span class="c1"># a variable</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="p">[]):</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">dims</span><span class="p">):</span>
                <span class="n">coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
        <span class="c1"># sets an attribute like &quot;geolon geolat&quot;</span>
        <span class="k">if</span> <span class="n">coordinates</span><span class="p">:</span>
            <span class="n">variable</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">variable</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;coordinates&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Add cell_measures attribute when appropriate measures are available</span>
        <span class="n">cell_measures</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">possible_measures</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;cell_thickness&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cell_area&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ocean_volume&quot;</span><span class="p">,</span>
        <span class="p">}</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">standard_names</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">stdname</span> <span class="ow">in</span> <span class="n">possible_measures</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">stdname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">standard_names</span><span class="p">[</span><span class="n">stdname</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">measure</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">measure</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">measure</span> <span class="o">!=</span> <span class="n">varname</span>
                <span class="p">):</span>
                    <span class="n">cell_measures</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">measure</span>

        <span class="k">if</span> <span class="n">cell_measures</span><span class="p">:</span>
            <span class="c1"># sets an attribute like &quot;area: areacello volume: volcello&quot;</span>
            <span class="n">variable</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;cell_measures&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cell_measures</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">variable</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cell_measures&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mom6">
<h2><span class="section-number">5.4.1. </span>MOM6<a class="headerlink" href="#mom6" title="Permalink to this headline">¶</a></h2>
<p>Read grid and data variables for a MOM6 ocean model simulation</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Open grid and data variables, then merge them together to one dataset</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">MOM6_GRID_PATH</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="p">{})</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
    <span class="n">MOM6_DATA_URL</span><span class="p">,</span>
    <span class="n">chunks</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">ds_mom6</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">grid</span><span class="p">,</span> <span class="n">ds</span><span class="p">],</span> <span class="n">compat</span><span class="o">=</span><span class="s2">&quot;override&quot;</span><span class="p">)</span>

<span class="c1"># Illustrate the equivalent of a curvilinear grid case,</span>
<span class="c1"># where axes and coordinates are different</span>
<span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;xh&quot;</span><span class="p">,</span> <span class="s2">&quot;xq&quot;</span><span class="p">,</span> <span class="s2">&quot;yh&quot;</span><span class="p">,</span> <span class="s2">&quot;yq&quot;</span><span class="p">]</span>
<span class="n">ds_mom6</span> <span class="o">=</span> <span class="n">ds_mom6</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
<span class="n">ds_mom6</span> <span class="o">=</span> <span class="n">ds_mom6</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="n">axis</span><span class="p">:</span> <span class="n">ds_mom6</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">})</span>
<span class="n">ds_mom6</span> <span class="o">=</span> <span class="n">ds_mom6</span><span class="o">.</span><span class="n">set_coords</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">var</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ds_mom6</span><span class="o">.</span><span class="n">variables</span>
        <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;geo&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">assign_coordinates_and_cell_measures</span><span class="p">(</span><span class="n">ds_mom6</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="cmip6-ocean">
<h2><span class="section-number">5.4.2. </span>CMIP6 Ocean<a class="headerlink" href="#cmip6-ocean" title="Permalink to this headline">¶</a></h2>
<p>Read a historical CMIP6 simulation from the ACCESS-OM2 climate modelling system.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use intake-esm to access data on Pangeo Cloud</span>
<span class="n">col</span> <span class="o">=</span> <span class="n">intake</span><span class="o">.</span><span class="n">open_esm_datastore</span><span class="p">(</span><span class="n">CMIP6_OCE_CATALOG</span><span class="p">)</span>
<span class="n">cat</span> <span class="o">=</span> <span class="n">col</span><span class="p">()</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="o">**</span><span class="n">CMIP6_OCE_EXPERIMENT</span><span class="p">)</span>

<span class="n">ddict</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">to_dataset_dict</span><span class="p">(</span>
    <span class="n">zarr_kwargs</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;consolidated&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;decode_times&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;use_cftime&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">ds_cmip6_oce</span> <span class="o">=</span> <span class="n">ddict</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
<span class="n">assign_coordinates_and_cell_measures</span><span class="p">(</span><span class="n">ds_cmip6_oce</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="cmip6-ice">
<h2><span class="section-number">5.4.3. </span>CMIP6 Ice<a class="headerlink" href="#cmip6-ice" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_cmip6_ice</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">CMIP6_ICE_PATH</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="ncep">
<h2><span class="section-number">5.4.4. </span>NCEP<a class="headerlink" href="#ncep" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ncep</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">tutorial</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">NCEP_PATH</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="data-processing-and-analysis">
<h1><span class="section-number">5.5. </span>Data processing and analysis<a class="headerlink" href="#data-processing-and-analysis" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview-of-cf-xarray">
<h2><span class="section-number">5.5.1. </span>Overview of cf-xarray<a class="headerlink" href="#overview-of-cf-xarray" title="Permalink to this headline">¶</a></h2>
<p>cf-xarray uses Xarray’s plugin interface, or “accessors”, to provide extensive
functionality on both Datasets and DataArrays under the <code class="docutils literal notranslate"><span class="pre">.cf</span></code> namespace.</p>
<div class="section" id="cf-is-an-entrypoint-for-cf-xarray-functionality">
<h3><span class="section-number">5.5.1.1. </span><code class="docutils literal notranslate"><span class="pre">.cf</span></code> is an entrypoint for cf-xarray functionality<a class="headerlink" href="#cf-is-an-entrypoint-for-cf-xarray-functionality" title="Permalink to this headline">¶</a></h3>
<p>When <code class="docutils literal notranslate"><span class="pre">cf_xarray</span></code> is imported, the <code class="docutils literal notranslate"><span class="pre">cf</span></code> accessor is automatically added to any
<code class="docutils literal notranslate"><span class="pre">xarray</span></code> object. cf-xarray is able to wrap most of Xarray’s functions. The repr
for <code class="docutils literal notranslate"><span class="pre">Dataset.cf</span></code> prints out a list of detected “CF names” and the corresponding
dataset-specific variable names. cf-xarray parses the attributes associated with
each variable in the Dataset to build these mappings</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># After `import cf_xarray`, the cf_xarray accessor has been added to the xarray object</span>
<span class="n">ds_mom6</span><span class="o">.</span><span class="n">cf</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="use-cf-metadata-in-standard-xarray-methods">
<h3><span class="section-number">5.5.1.2. </span>Use CF metadata in standard xarray methods<a class="headerlink" href="#use-cf-metadata-in-standard-xarray-methods" title="Permalink to this headline">¶</a></h3>
<p>With standard <code class="docutils literal notranslate"><span class="pre">xarray</span></code> syntax, one would specify the variable names on the
right-hand side of the mappings printed above. With cf_xarray, one can instead
use the standardized “CF names” on the left-hand side.</p>
<p>For example, the next two cells show two ways of calculating an average along
the vertical dimension</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># xarray way:</span>
<span class="n">ds_mom6</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="s2">&quot;z_i&quot;</span><span class="p">,</span> <span class="s2">&quot;z_l&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># cf_xarray way:</span>
<span class="c1"># By calling .cf.mean we can provide &quot;Z&quot; which is then rewritten to [&quot;z_i&quot;, &quot;z_l&quot;]</span>
<span class="c1"># This statement is entirely equivalent to ds_mom6.mean([&quot;z_i&quot;, &quot;z_l&quot;])</span>
<span class="n">ds_mom6</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">cf_xarray</span></code> knows that <code class="docutils literal notranslate"><span class="pre">z_i</span></code> and <code class="docutils literal notranslate"><span class="pre">z_l</span></code> correspond <code class="docutils literal notranslate"><span class="pre">Z</span></code> axes because the two
variables have a CF-compliant attribute <code class="docutils literal notranslate"><span class="pre">cartesian_axis:</span> <span class="pre">Z</span></code>. A full list of
criteria used by cf-xarray is documented
<a class="reference external" href="https://cf-xarray.readthedocs.io/en/latest/criteria.html">here</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;z_i&quot;</span><span class="p">,</span> <span class="s2">&quot;z_l&quot;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ds_mom6</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;cartesian_axis&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="dictionaries-mapping-cf-keys-to-variable-names">
<h3><span class="section-number">5.5.1.3. </span>Dictionaries mapping CF keys to variable names<a class="headerlink" href="#dictionaries-mapping-cf-keys-to-variable-names" title="Permalink to this headline">¶</a></h3>
<p>The example object contains variables lying on staggered grids. Therefore, a CF
key can be associated with multiple variables. <code class="docutils literal notranslate"><span class="pre">cf_xarray</span></code> provides several
properties that return dictionaries mapping CF keys to lists of variable names,
such as:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.cf.axes</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.cf.coordinates</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.cf.cell_measures</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.cf.standard_names</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.cf.bounds</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># maps &quot;axes&quot; to variable names</span>
<span class="n">ds_mom6</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">axes</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># maps CF standard name to variable name</span>
<span class="n">ds</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">standard_names</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="dealing-with-incomplete-metadata">
<h3><span class="section-number">5.5.1.4. </span>Dealing with incomplete metadata<a class="headerlink" href="#dealing-with-incomplete-metadata" title="Permalink to this headline">¶</a></h3>
<p>The usefulness of cf-xarray fully depends on the amount of CF-compliant metadata
present in a dataset. Although many datasets have incomplete metadata, in most
cases one can guess appropriate metadata by looking at variable names.</p>
<p>We can use <code class="docutils literal notranslate"><span class="pre">Dataset.cf.guess_coord_axis</span></code> to identify, guess, and add missing CF
metadata for “axes” (“X”, “Y”, “Z”, “T”) and “coordinates” (“latitude”,
“longitude”, “time”). It does so by using regular expressions to parse variable
names and make reasonable guesses.</p>
<p>We also demonstrate the <code class="docutils literal notranslate"><span class="pre">verbose</span></code> mode so that the user can double check
cf-xarray’s inferences.</p>
<p>First, note that no <code class="docutils literal notranslate"><span class="pre">X</span></code> or <code class="docutils literal notranslate"><span class="pre">Y</span></code> axes variables have been detected in the current
dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The &quot;axes&quot; property maps axes names &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;, &#39;T&#39; to variable names in the dataset</span>
<span class="c1"># here the metadata only identify &#39;Z&#39; and &#39;T&#39;</span>
<span class="n">ds_mom6</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">axes</span>
</pre></div>
</div>
</div>
</div>
<p>Now we will ask <code class="docutils literal notranslate"><span class="pre">cf_xarray</span></code> to autoguess more axes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_mom6</span> <span class="o">=</span> <span class="n">ds_mom6</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">guess_coord_axis</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The `X` and `Y` axes variables that have been detected are sensible!</span>
<span class="n">ds_mom6</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">axes</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="indexing-using-cf-keys">
<h3><span class="section-number">5.5.1.5. </span>Indexing using CF keys<a class="headerlink" href="#indexing-using-cf-keys" title="Permalink to this headline">¶</a></h3>
<p>CF metadata precisely describes the physical quantities being represented by all
variables. More importantly, CF conventions also describe links between
different variables in a dataset.</p>
<p>Here we examine the “sea floor depth” variable. First, we pick it out using
standard xarray syntax:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xr_da</span> <span class="o">=</span> <span class="n">ds_mom6</span><span class="p">[</span><span class="s2">&quot;deptho&quot;</span><span class="p">]</span>
<span class="n">xr_da</span>
</pre></div>
</div>
</div>
</div>
<p>Note that, in the output above, the <code class="docutils literal notranslate"><span class="pre">cell_methods</span></code> attribute indicates that the
<code class="docutils literal notranslate"><span class="pre">areacello</span></code> variable contains the appopriate “cell area” for this variable (see
under “Attributes”). However, this variable is not associated with the DataArray
(see under “Coordinates”).</p>
<p>Now we pick out the variable using the <code class="docutils literal notranslate"><span class="pre">cf</span></code> accessor and the appropriate
standard name:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cf_da</span> <span class="o">=</span> <span class="n">ds_mom6</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="s2">&quot;sea_floor_depth_below_geoid&quot;</span><span class="p">]</span>
<span class="n">cf_da</span>
</pre></div>
</div>
</div>
</div>
<p>Now notice that <code class="docutils literal notranslate"><span class="pre">areacello</span></code> is present under “Coordinates”. This is because
<code class="docutils literal notranslate"><span class="pre">cf_xarray</span></code> decodes CF metadata linking variables with each other (e.g.,
<code class="docutils literal notranslate"><span class="pre">coordinates</span></code>, <code class="docutils literal notranslate"><span class="pre">cell_measures</span></code>, <code class="docutils literal notranslate"><span class="pre">ancillary_variables</span></code>).</p>
<p>As opposed to <code class="docutils literal notranslate"><span class="pre">xr_da</span></code>, <code class="docutils literal notranslate"><span class="pre">cf_da</span></code> extracted in the previous cell contains all
<code class="docutils literal notranslate"><span class="pre">cell_measures</span></code> associated with the variable extracted.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">additional_coords</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cf_da</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">xr_da</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cell measure extracted by cf_xarray:&quot;</span><span class="p">,</span> <span class="n">additional_coords</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="automagic-plotting">
<h3><span class="section-number">5.5.1.6. </span>Automagic plotting<a class="headerlink" href="#automagic-plotting" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">cf_xarray</span></code> automagically sets some optional keyword arguments for plotting
functions. As opposed to <code class="docutils literal notranslate"><span class="pre">xarray</span></code>, in the example below <code class="docutils literal notranslate"><span class="pre">cf_xarray</span></code> assigns the
appropriate coordinates to the plot axes (i.e., longitude and latitude).
<code class="docutils literal notranslate"><span class="pre">cf_xarray</span></code> does so by parsing the <code class="docutils literal notranslate"><span class="pre">&quot;coordinates&quot;</span></code> attribute to identify the
appropriate latitude and longitude variables:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">xr_ax</span><span class="p">,</span> <span class="n">cf_ax</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># left: xarray plot</span>
<span class="n">xr_da</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">xr_ax</span><span class="p">)</span>
<span class="n">xr_ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;xarray&quot;</span><span class="p">)</span>

<span class="c1"># right: cf_xarray plot</span>
<span class="n">cf_da</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">cf_ax</span><span class="p">)</span>
<span class="n">cf_ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;cf_xarray&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="cf-keys-expansion">
<h3><span class="section-number">5.5.1.7. </span>CF keys expansion<a class="headerlink" href="#cf-keys-expansion" title="Permalink to this headline">¶</a></h3>
<p>As mentioned above, the example dataset is characterized by multiple dimensions
associated with the same spatial axes. Such information is decoded by
<code class="docutils literal notranslate"><span class="pre">cf_xarray</span></code> and is used under the hood of wrapped functions. In the example
below, the CF Axes keys (i.e., “X”, “Y”, and “Z”) are expanded and multiple
dimensions are sliced at once:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_mom6_sliced</span> <span class="o">=</span> <span class="n">ds_mom6</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span>
    <span class="n">X</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">Y</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">Z</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">T</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Original dataset sizes:&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">ds_mom6</span><span class="o">.</span><span class="n">sizes</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Sliced dataset sizes:&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">ds_mom6_sliced</span><span class="o">.</span><span class="n">sizes</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="use-case-examples">
<h2><span class="section-number">5.5.2. </span>Use case examples<a class="headerlink" href="#use-case-examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="seamlessly-extract-statistics-from-cf-compliant-datasets">
<h3><span class="section-number">5.5.2.1. </span>Seamlessly extract statistics from CF-compliant datasets<a class="headerlink" href="#seamlessly-extract-statistics-from-cf-compliant-datasets" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">cf_xarray</span></code> allows one to use the same code on a wide variety of CF-compliant
objects that each has their own nomenclature.</p>
<p>There are two approaches to leveraging cf-xarray in applications.</p>
<div class="section" id="access-variables-through-the-cf-interface">
<h4><span class="section-number">5.5.2.1.1. </span>Access variables through the <code class="docutils literal notranslate"><span class="pre">.cf</span></code> interface<a class="headerlink" href="#access-variables-through-the-cf-interface" title="Permalink to this headline">¶</a></h4>
<p>In the example below, we define a function that uses many <code class="docutils literal notranslate"><span class="pre">cf_xarray</span></code> features,
then we apply to objects with different dimension and coordinate names. All
cf_xarray functionality is accessed using the <code class="docutils literal notranslate"><span class="pre">.cf</span></code> accessor</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_top_10m_temp_anomaly</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the volume weighted temperature anomaly from the climatology.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds: xarray.Dataset</span>
<span class="sd">        Dataset to analyze</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DataArray</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Compute and plot line</span>
    <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># Extract ocean potential temperature</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="s2">&quot;sea_water_potential_temperature&quot;</span><span class="p">]</span>
        <span class="c1"># Fill missing cell volumes with zeros</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">da</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="c1"># Select temperature in the top 10m in 2003</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="s2">&quot;2003&quot;</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="c1"># Compute volume-weighted mean temperature</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="s2">&quot;volume&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">])</span>
        <span class="c1"># Calculate an anomaly relative to the time mean</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">da</span> <span class="o">-</span> <span class="n">da</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>

    <span class="c1"># Update metadata</span>
    <span class="n">da</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;standard_name&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot;_anomaly&quot;</span>
    <span class="n">da</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; Anomaly&quot;</span>

    <span class="k">return</span> <span class="n">da</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="c1"># Run the function on two different datasets and compare the results</span>
<span class="n">compute_top_10m_temp_anomaly</span><span class="p">(</span><span class="n">ds_mom6</span><span class="p">)</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;ds_mom6&quot;</span><span class="p">)</span>
<span class="n">compute_top_10m_temp_anomaly</span><span class="p">(</span><span class="n">ds_cmip6_oce</span><span class="p">)</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;ds_cmip6_oce&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="standardize-datasets-using-cf-xarray">
<h4><span class="section-number">5.5.2.1.2. </span>Standardize datasets using cf_xarray<a class="headerlink" href="#standardize-datasets-using-cf-xarray" title="Permalink to this headline">¶</a></h4>
<p>Alternatively, <code class="docutils literal notranslate"><span class="pre">cf_xarray</span></code> provides utility functions to rename variables and
dimensions in one object to match another object. Matching variables/dimensions
are determined using CF metadata. One might choose to use this approach of
standardizing datasets prior to passing them through a data processing pipeline.</p>
<p>Here we illustrate the <code class="docutils literal notranslate"><span class="pre">rename_like</span></code>
<a class="reference external" href="https://cf-xarray.readthedocs.io/en/latest/generated/xarray.DataArray.cf.rename_like.html#xarray.DataArray.cf.rename_like">feature</a>.
cf_xarray also supports renaming datasets through <code class="docutils literal notranslate"><span class="pre">.cf.rename</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mom6_da</span> <span class="o">=</span> <span class="n">ds_mom6</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="s2">&quot;sea_water_potential_temperature&quot;</span><span class="p">]</span>
<span class="n">cmip6_da</span> <span class="o">=</span> <span class="n">ds_cmip6_oce</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="s2">&quot;sea_water_potential_temperature&quot;</span><span class="p">]</span>
<span class="n">renamed_mom6_da</span> <span class="o">=</span> <span class="n">mom6_da</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">rename_like</span><span class="p">(</span><span class="n">cmip6_da</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        MOM6 dimensions:&quot;</span><span class="p">,</span> <span class="n">mom6_da</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;       CMIP6 dimensions:&quot;</span><span class="p">,</span> <span class="n">cmip6_da</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;renamed MOM6 dimensions:&quot;</span><span class="p">,</span> <span class="n">renamed_mom6_da</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="regridding-with-xesmf">
<h3><span class="section-number">5.5.2.2. </span>Regridding with xESMF<a class="headerlink" href="#regridding-with-xesmf" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">cf-xarray</span></code> is used by <a class="reference external" href="https://pangeo-xesmf.readthedocs.io">xESMF</a>, a
regridding package wrapping the powerful Fortran libray “ESMF”. This example
will regrid sea ice concentration data extracted from the CCCma-CanESM5 model, a
participant in the CMIP6 experiment.</p>
<p>Our original sea ice data is on a tripolar grid. The target grid is a regular
grid used by the NCEP reanalysis dataset that ships with Xarray. This regridding
problem requires providing grid cell corners to xESMF in a specific
CF-compatible format. Here we illustrate utility functions provided by cf_xarray
to make this task easy and convenient.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s look at the grid shape itself and the data for one time step</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># Notice how with .cf we will use the same keyword arguments</span>
<span class="c1"># Although here we explicitely pass the coordinate standard names for the plot axes,</span>
<span class="c1"># cf_xarray default scatter plot would produce the same results.</span>
<span class="n">scatter_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># CMIP6: Input grid</span>
<span class="n">ds_cmip6_ice</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">**</span><span class="n">scatter_kwargs</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
    <span class="s2">&quot;The input horizontal grid points as seen on a lat/lon map.&quot;</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Only the northern hemisphere is shown.&quot;</span>
<span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>

<span class="c1"># NCEP: Target grid</span>
<span class="n">ds_ncep</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">**</span><span class="n">scatter_kwargs</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;The target horizontal grid points&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We will regrid the sea ice data using the “conservative” method. Please refer to
the xESMF documentation for details about the
<a class="reference external" href="https://xesmf.readthedocs.io/en/latest/notebooks/Compare_algorithms.html">different algorithms</a>.
The important information here is that the “conservative” regridding algorithms
requires the grid points coordinates, but also the grid <em>corners</em> coordinates.
While the target grid doesn’t provide them, they are easily computable with the
help of <code class="docutils literal notranslate"><span class="pre">cf_xarray</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a reasonable guess of the bounds of the spatial coordinates:</span>
<span class="n">ds_ncep</span> <span class="o">=</span> <span class="n">ds_ncep</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">add_bounds</span><span class="p">([</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">])</span>
<span class="n">ds_ncep</span>
</pre></div>
</div>
</div>
</div>
<p>This was easy since the grid is regular (i.e., latitude and longitude are 1D).
Inferring bounds of 2D grids is
<a class="reference external" href="https://github.com/xarray-contrib/cf-xarray/issues/163">not yet supported</a> by
cf-xarray.</p>
<p>Luckily, our sea ice data includes the corner coordinates in the
<code class="docutils literal notranslate"><span class="pre">vertices_latitude</span></code> and <code class="docutils literal notranslate"><span class="pre">vertices_longitude</span></code> variables. However, xESMF expects a
format that is different from the CF convention followed here. No worries,
<code class="docutils literal notranslate"><span class="pre">cf_xarray</span></code> has an helper method just for this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the bounds variable and convert them to &quot;vertices&quot; format</span>
<span class="c1"># Order=None, means that we do not know if the bounds are</span>
<span class="c1"># listed clockwise or counterclockwise, so we ask cf_xarray to try both.</span>
<span class="n">lat_corners</span> <span class="o">=</span> <span class="n">cfxr</span><span class="o">.</span><span class="n">bounds_to_vertices</span><span class="p">(</span>
    <span class="n">ds_cmip6_ice</span><span class="o">.</span><span class="n">vertices_latitude</span><span class="p">,</span> <span class="s2">&quot;vertices&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
<span class="n">lon_corners</span> <span class="o">=</span> <span class="n">cfxr</span><span class="o">.</span><span class="n">bounds_to_vertices</span><span class="p">(</span>
    <span class="n">ds_cmip6_ice</span><span class="o">.</span><span class="n">vertices_longitude</span><span class="p">,</span> <span class="s2">&quot;vertices&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="c1"># We are using special variable names &quot;lon_b&quot; and &quot;lat_b&quot; for easier detection by xESMF</span>
<span class="n">ds_in</span> <span class="o">=</span> <span class="n">ds_cmip6_ice</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">lon_b</span><span class="o">=</span><span class="n">lon_corners</span><span class="p">,</span> <span class="n">lat_b</span><span class="o">=</span><span class="n">lat_corners</span><span class="p">)</span>
<span class="n">ds_in</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, the regridding is performed with xESMF. Under the hood, it uses
cf-xarray to get the coordinates and their bounds, so we do not need to worry
about renaming. The only exception is the input grid’s corners, where we used
hardcoded variable names because of the difference between xESMF’s and CF’s
syntaxes for 2D grid bounds.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Regrid</span>
<span class="n">regridder</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">Regridder</span><span class="p">(</span><span class="n">ds_in</span><span class="p">,</span> <span class="n">ds_ncep</span><span class="p">,</span> <span class="s2">&quot;conservative&quot;</span><span class="p">)</span>
<span class="n">sic_reg</span> <span class="o">=</span> <span class="n">regridder</span><span class="p">(</span><span class="n">ds_in</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="s2">&quot;sea_ice_area_fraction&quot;</span><span class="p">])</span>

<span class="c1"># Plot the results</span>
<span class="n">sic_reg</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Regridded sic data (Jan 2020)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="conclusion">
<h1><span class="section-number">5.6. </span>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h1>
<p>This notebook was a quick walkthrough of a few core cf-xarray features that
enable scaling analysis pipelines <em>across</em> datasets. It is fairly common for
datasets to not have consistent terminology, and be imperfectly tagged with CF
attributes. cf_xaray both allows you to leverage the presence of attributes, and
provides utility functions to quickly fix imperfect tagging. For more see the
<a class="reference external" href="https://cf-xarray.readthedocs.io/en/latest/">documentation</a>, specifically the
<a class="reference external" href="https://cf-xarray.readthedocs.io/en/latest/examples/introduction.html">introductory notebook</a>.</p>
</div>
<div class="section" id="references">
<h1><span class="section-number">5.7. </span>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h1>
<p>Adcroft, Alistair, Whit G Anderson, V Balaji, Chris Blanton, Mitchell Bushuk,
Carolina O Dufour, John P Dunne, Stephen M Griffies, Robert Hallberg, Matthew J
Harrison, Isaac M Held, Malte Jansen, Jasmin G John, John P Krasting, Amy R
Langenhorst, Sonya Legg, Zhi Liang, Colleen McHugh, Aparna Radhakrishnan,
Brandon G Reichl, Anthony Rosati, Bonita L Samuels, Andrew Shao, Ronald J
Stouffer, Michael Winton, Andrew T Wittenberg, Baoqiang Xiang, Niki Zadeh, and
Rong Zhang, October 2019: The GFDL Global Ocean and Sea Ice Model OM4.0: Model
Description and Simulation Features. Journal of Advances in Modeling Earth
Systems, 11(10), DOI:10.1029/2019MS001726.</p>
<p>Cherian, Deepak, Almansi, Mattia, Bourgault, Pascal, keewis, Kent, Julia, Thyng,
Kristen, … Chauhan, Subhendra Singh. (2021, May 11). xarray-contrib/cf-xarray:
(Version v0.5.2). Zenodo. <a class="reference external" href="http://doi.org/10.5281/zenodo.4749736">http://doi.org/10.5281/zenodo.4749736</a></p>
<p>Hoyer, Stephan, Hamman, Joe, Roos, Maximilian, keewis, Cherian, Deepak,
Fitzgerald, Clark … Bovy, Benoit. (2021, May 19). pydata/xarray: v0.18.2
(Version v0.18.2). Zenodo. <a class="reference external" href="http://doi.org/10.5281/zenodo.4774304">http://doi.org/10.5281/zenodo.4774304</a></p>
<p>Kalnay, E., Kanamitsu, M., Kistler, R., Collins, W., Deaven, D., Gandin, L.,
Iredell, M., Saha, S., White, G., Woollen, J., Zhu, Y., Chelliah, M., Ebisuzaki,
W., Higgins, W., Janowiak, J., Mo, K. C., Ropelewski, C., Wang, J., Leetmaa, A.,
Reynolds, R., Jenne, R., &amp; Joseph, D. (1996). The NCEP/NCAR 40-Year Reanalysis
Project, Bulletin of the American Meteorological Society, 77(3), 437-472.</p>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/ec21_cherian_etal"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="README.html" title="previous page"><span class="section-number">5. </span>cf-xarray-earthcube</a>
    <a class='right-next' id="next-link" href="../ec21_cych_etal/readme.html" title="next page"><span class="section-number">6. </span>Reanalysis of archived paleointensity data using a new statistical method.</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By EarthCube Office<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>